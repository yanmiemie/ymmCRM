{"remainingRequest":"/Users/qiushunqun/Desktop/射箭專案/GitHub/17soooo/17soooo/node_modules/babel-loader/lib/index.js!/Users/qiushunqun/Desktop/射箭專案/GitHub/17soooo/17soooo/node_modules/eslint-loader/index.js??ref--13-0!/Users/qiushunqun/Desktop/射箭專案/GitHub/17soooo/17soooo/src/utils/container/mediator.js","dependencies":[{"path":"/Users/qiushunqun/Desktop/射箭專案/GitHub/17soooo/17soooo/src/utils/container/mediator.js","mtime":1634663364000},{"path":"/Users/qiushunqun/Desktop/射箭專案/GitHub/17soooo/17soooo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/qiushunqun/Desktop/射箭專案/GitHub/17soooo/17soooo/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/qiushunqun/Desktop/射箭專案/GitHub/17soooo/17soooo/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmRleC1vZiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNwbGljZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci5jb25zdHJ1Y3RvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci5tYXgtc2FmZS1pbnRlZ2VyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaCI7CmltcG9ydCAqIGFzIGNvbnN0YW50cyBmcm9tICcuL2NvbnN0YW50cyc7CmltcG9ydCB7IGRlZmF1bHRPcHRpb25zIH0gZnJvbSAnLi9kZWZhdWx0cyc7CmltcG9ydCBkcmFnU2Nyb2xsZXIgZnJvbSAnLi9zY3JvbGxlcic7CmltcG9ydCAnLi9wb2x5ZmlsbHMnOwppbXBvcnQgeyBhZGRDdXJzb3JTdHlsZVRvQm9keSwgYWRkU3R5bGVUb0hlYWQsIHJlbW92ZVN0eWxlIH0gZnJvbSAnLi9zdHlsZXMnOwppbXBvcnQgKiBhcyBVdGlscyBmcm9tICcuL3V0aWxzJzsKdmFyIGdyYWJFdmVudHMgPSBbJ21vdXNlZG93bicsICd0b3VjaHN0YXJ0J107CnZhciBtb3ZlRXZlbnRzID0gWydtb3VzZW1vdmUnLCAndG91Y2htb3ZlJ107CnZhciByZWxlYXNlRXZlbnRzID0gWydtb3VzZXVwJywgJ3RvdWNoZW5kJ107CnZhciBkcmFnTGlzdGVuaW5nQ29udGFpbmVycyA9IG51bGw7CnZhciBncmFiYmVkRWxlbWVudCA9IG51bGw7CnZhciBnaG9zdEluZm8gPSBudWxsOwp2YXIgZHJhZ2dhYmxlSW5mbyA9IG51bGw7CnZhciBjb250YWluZXJzID0gW107CnZhciBfaXNEcmFnZ2luZyA9IGZhbHNlOwp2YXIgaXNDYW5jZWxpbmcgPSBmYWxzZTsKdmFyIGRyb3BBbmltYXRpb25TdGFydGVkID0gZmFsc2U7CnZhciBtaXNzZWREcmFnID0gZmFsc2U7CnZhciBoYW5kbGVEcmFnID0gbnVsbDsKdmFyIGhhbmRsZVNjcm9sbCA9IG51bGw7CnZhciBzb3VyY2VDb250YWluZXJMb2NrQXhpcyA9IG51bGw7CnZhciBjdXJzb3JTdHlsZUVsZW1lbnQgPSBudWxsOwp2YXIgY29udGFpbmVyUmVjdGFibGVXYXRjaGVyID0gd2F0Y2hSZWN0YW5nbGVzKCk7CnZhciBpc01vYmlsZSA9IFV0aWxzLmlzTW9iaWxlKCk7CgpmdW5jdGlvbiBsaXN0ZW5FdmVudHMoKSB7CiAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7CiAgICBhZGRHcmFiTGlzdGVuZXJzKCk7CiAgfQp9CgpmdW5jdGlvbiBhZGRHcmFiTGlzdGVuZXJzKCkgewogIGdyYWJFdmVudHMuZm9yRWFjaChmdW5jdGlvbiAoZSkgewogICAgd2luZG93LmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoZSwgb25Nb3VzZURvd24sIHsKICAgICAgcGFzc2l2ZTogZmFsc2UKICAgIH0pOwogIH0pOwp9CgpmdW5jdGlvbiBhZGRNb3ZlTGlzdGVuZXJzKCkgewogIG1vdmVFdmVudHMuZm9yRWFjaChmdW5jdGlvbiAoZSkgewogICAgd2luZG93LmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoZSwgb25Nb3VzZU1vdmUsIHsKICAgICAgcGFzc2l2ZTogZmFsc2UKICAgIH0pOwogIH0pOwp9CgpmdW5jdGlvbiByZW1vdmVNb3ZlTGlzdGVuZXJzKCkgewogIG1vdmVFdmVudHMuZm9yRWFjaChmdW5jdGlvbiAoZSkgewogICAgd2luZG93LmRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoZSwgb25Nb3VzZU1vdmUsIHsKICAgICAgcGFzc2l2ZTogZmFsc2UKICAgIH0pOwogIH0pOwp9CgpmdW5jdGlvbiBhZGRSZWxlYXNlTGlzdGVuZXJzKCkgewogIHJlbGVhc2VFdmVudHMuZm9yRWFjaChmdW5jdGlvbiAoZSkgewogICAgd2luZG93LmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoZSwgb25Nb3VzZVVwLCB7CiAgICAgIHBhc3NpdmU6IGZhbHNlCiAgICB9KTsKICB9KTsKfQoKZnVuY3Rpb24gcmVtb3ZlUmVsZWFzZUxpc3RlbmVycygpIHsKICByZWxlYXNlRXZlbnRzLmZvckVhY2goZnVuY3Rpb24gKGUpIHsKICAgIHdpbmRvdy5kb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKGUsIG9uTW91c2VVcCwgewogICAgICBwYXNzaXZlOiBmYWxzZQogICAgfSk7CiAgfSk7Cn0KCmZ1bmN0aW9uIGdldEdob3N0UGFyZW50KCkgewogIGlmIChkcmFnZ2FibGVJbmZvICYmIGRyYWdnYWJsZUluZm8uZ2hvc3RQYXJlbnQpIHsKICAgIHJldHVybiBkcmFnZ2FibGVJbmZvLmdob3N0UGFyZW50OwogIH0KCiAgaWYgKGdyYWJiZWRFbGVtZW50KSB7CiAgICByZXR1cm4gZ3JhYmJlZEVsZW1lbnQucGFyZW50RWxlbWVudCB8fCB3aW5kb3cuZG9jdW1lbnQuYm9keTsKICB9IGVsc2UgewogICAgcmV0dXJuIHdpbmRvdy5kb2N1bWVudC5ib2R5OwogIH0KfQoKZnVuY3Rpb24gZ2V0R2hvc3RFbGVtZW50KHdyYXBwZXJFbGVtZW50LCBfcmVmLCBjb250YWluZXIsIGN1cnNvcikgewogIHZhciB4ID0gX3JlZi54LAogICAgICB5ID0gX3JlZi55OwogIHZhciB3cmFwcGVyUmVjdCA9IHdyYXBwZXJFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogIHZhciBsZWZ0ID0gd3JhcHBlclJlY3QubGVmdCwKICAgICAgdG9wID0gd3JhcHBlclJlY3QudG9wLAogICAgICByaWdodCA9IHdyYXBwZXJSZWN0LnJpZ2h0LAogICAgICBib3R0b20gPSB3cmFwcGVyUmVjdC5ib3R0b207CiAgdmFyIHdyYXBwZXJWaXNpYmxlUmVjdCA9IFV0aWxzLmdldEludGVyc2VjdGlvbihjb250YWluZXIubGF5b3V0LmdldENvbnRhaW5lclJlY3RhbmdsZXMoKS52aXNpYmxlUmVjdCwgd3JhcHBlclJlY3QpOwogIHZhciBtaWRYID0gd3JhcHBlclZpc2libGVSZWN0LmxlZnQgKyAod3JhcHBlclZpc2libGVSZWN0LnJpZ2h0IC0gd3JhcHBlclZpc2libGVSZWN0LmxlZnQpIC8gMjsKICB2YXIgbWlkWSA9IHdyYXBwZXJWaXNpYmxlUmVjdC50b3AgKyAod3JhcHBlclZpc2libGVSZWN0LmJvdHRvbSAtIHdyYXBwZXJWaXNpYmxlUmVjdC50b3ApIC8gMjsKICB2YXIgZ2hvc3QgPSB3cmFwcGVyRWxlbWVudC5jbG9uZU5vZGUodHJ1ZSk7CiAgZ2hvc3Quc3R5bGUuekluZGV4ID0gJzEwMDAnOwogIGdob3N0LnN0eWxlLmJveFNpemluZyA9ICdib3JkZXItYm94JzsKICBnaG9zdC5zdHlsZS5wb3NpdGlvbiA9ICdmaXhlZCc7CiAgZ2hvc3Quc3R5bGUudG9wID0gJzBweCc7CiAgZ2hvc3Quc3R5bGUubGVmdCA9ICcwcHgnOwogIGdob3N0LnN0eWxlLnRyYW5zZm9ybSA9ICdub25lJzsKICBnaG9zdC5zdHlsZS5yZW1vdmVQcm9wZXJ0eSgndHJhbnNmb3JtJyk7CgogIGlmIChjb250YWluZXIuc2hvdWxkVXNlVHJhbnNmb3JtRm9yR2hvc3QoKSkgewogICAgZ2hvc3Quc3R5bGUudHJhbnNmb3JtID0gInRyYW5zbGF0ZTNkKCIuY29uY2F0KGxlZnQsICJweCwgIikuY29uY2F0KHRvcCwgInB4LCAwKSIpOwogIH0gZWxzZSB7CiAgICBnaG9zdC5zdHlsZS50b3AgPSAiIi5jb25jYXQodG9wLCAicHgiKTsKICAgIGdob3N0LnN0eWxlLmxlZnQgPSAiIi5jb25jYXQobGVmdCwgInB4Iik7CiAgfQoKICBnaG9zdC5zdHlsZS53aWR0aCA9IHJpZ2h0IC0gbGVmdCArICdweCc7CiAgZ2hvc3Quc3R5bGUuaGVpZ2h0ID0gYm90dG9tIC0gdG9wICsgJ3B4JzsKICBnaG9zdC5zdHlsZS5vdmVyZmxvdyA9ICd2aXNpYmxlJzsKICBnaG9zdC5zdHlsZS50cmFuc2l0aW9uID0gbnVsbDsKICBnaG9zdC5zdHlsZS5yZW1vdmVQcm9wZXJ0eSgndHJhbnNpdGlvbicpOwogIGdob3N0LnN0eWxlLnBvaW50ZXJFdmVudHMgPSAnbm9uZSc7CiAgZ2hvc3Quc3R5bGUudXNlclNlbGVjdCA9ICdub25lJzsKCiAgaWYgKGNvbnRhaW5lci5nZXRPcHRpb25zKCkuZHJhZ0NsYXNzKSB7CiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgVXRpbHMuYWRkQ2xhc3MoZ2hvc3QuZmlyc3RFbGVtZW50Q2hpbGQsIGNvbnRhaW5lci5nZXRPcHRpb25zKCkuZHJhZ0NsYXNzKTsKICAgICAgdmFyIGRyYWdDdXJzb3IgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShnaG9zdC5maXJzdEVsZW1lbnRDaGlsZCkuY3Vyc29yOwogICAgICBjdXJzb3JTdHlsZUVsZW1lbnQgPSBhZGRDdXJzb3JTdHlsZVRvQm9keShkcmFnQ3Vyc29yKTsKICAgIH0pOwogIH0gZWxzZSB7CiAgICBjdXJzb3JTdHlsZUVsZW1lbnQgPSBhZGRDdXJzb3JTdHlsZVRvQm9keShjdXJzb3IpOwogIH0KCiAgVXRpbHMuYWRkQ2xhc3MoZ2hvc3QsIGNvbnRhaW5lci5nZXRPcHRpb25zKCkub3JpZW50YXRpb24gfHwgJ3ZlcnRpY2FsJyk7CiAgVXRpbHMuYWRkQ2xhc3MoZ2hvc3QsIGNvbnN0YW50cy5naG9zdENsYXNzKTsKICByZXR1cm4gewogICAgZ2hvc3Q6IGdob3N0LAogICAgY2VudGVyRGVsdGE6IHsKICAgICAgeDogbWlkWCAtIHgsCiAgICAgIHk6IG1pZFkgLSB5CiAgICB9LAogICAgcG9zaXRpb25EZWx0YTogewogICAgICBsZWZ0OiBsZWZ0IC0geCwKICAgICAgdG9wOiB0b3AgLSB5CiAgICB9LAogICAgdG9wTGVmdDogewogICAgICB4OiBsZWZ0LAogICAgICB5OiB0b3AKICAgIH0KICB9Owp9CgpmdW5jdGlvbiBnZXREcmFnZ2FibGVJbmZvKGRyYWdnYWJsZUVsZW1lbnQpIHsKICB2YXIgY29udGFpbmVyID0gY29udGFpbmVycy5maWx0ZXIoZnVuY3Rpb24gKHApIHsKICAgIHJldHVybiBkcmFnZ2FibGVFbGVtZW50LnBhcmVudEVsZW1lbnQgPT09IHAuZWxlbWVudDsKICB9KVswXTsKICB2YXIgZHJhZ2dhYmxlSW5kZXggPSBjb250YWluZXIuZHJhZ2dhYmxlcy5pbmRleE9mKGRyYWdnYWJsZUVsZW1lbnQpOwogIHZhciBnZXRHaG9zdFBhcmVudCA9IGNvbnRhaW5lci5nZXRPcHRpb25zKCkuZ2V0R2hvc3RQYXJlbnQ7CiAgdmFyIGRyYWdnYWJsZVJlY3QgPSBkcmFnZ2FibGVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogIHJldHVybiB7CiAgICBjb250YWluZXI6IGNvbnRhaW5lciwKICAgIGVsZW1lbnQ6IGRyYWdnYWJsZUVsZW1lbnQsCiAgICBzaXplOiB7CiAgICAgIG9mZnNldEhlaWdodDogZHJhZ2dhYmxlUmVjdC5ib3R0b20gLSBkcmFnZ2FibGVSZWN0LnRvcCwKICAgICAgb2Zmc2V0V2lkdGg6IGRyYWdnYWJsZVJlY3QucmlnaHQgLSBkcmFnZ2FibGVSZWN0LmxlZnQKICAgIH0sCiAgICBlbGVtZW50SW5kZXg6IGRyYWdnYWJsZUluZGV4LAogICAgcGF5bG9hZDogY29udGFpbmVyLmdldE9wdGlvbnMoKS5nZXRDaGlsZFBheWxvYWQgPyBjb250YWluZXIuZ2V0T3B0aW9ucygpLmdldENoaWxkUGF5bG9hZChkcmFnZ2FibGVJbmRleCkgOiB1bmRlZmluZWQsCiAgICB0YXJnZXRFbGVtZW50OiBudWxsLAogICAgcG9zaXRpb246IHsKICAgICAgeDogMCwKICAgICAgeTogMAogICAgfSwKICAgIGdyb3VwTmFtZTogY29udGFpbmVyLmdldE9wdGlvbnMoKS5ncm91cE5hbWUsCiAgICBnaG9zdFBhcmVudDogZ2V0R2hvc3RQYXJlbnQgPyBnZXRHaG9zdFBhcmVudCgpIDogbnVsbCwKICAgIGludmFsaWRhdGVTaGFkb3c6IG51bGwsCiAgICBtb3VzZVBvc2l0aW9uOiBudWxsLAogICAgcmVsZXZhbnRDb250YWluZXJzOiBudWxsCiAgfTsKfQoKZnVuY3Rpb24gaGFuZGxlRHJvcEFuaW1hdGlvbihjYWxsYmFjaykgewogIGZ1bmN0aW9uIGVuZERyb3AoKSB7CiAgICBVdGlscy5yZW1vdmVDbGFzcyhnaG9zdEluZm8uZ2hvc3QsICdhbmltYXRlZCcpOwogICAgZ2hvc3RJbmZvLmdob3N0LnN0eWxlLnRyYW5zaXRpb25EdXJhdGlvbiA9IG51bGw7CiAgICBnZXRHaG9zdFBhcmVudCgpLnJlbW92ZUNoaWxkKGdob3N0SW5mby5naG9zdCk7CiAgICBjYWxsYmFjaygpOwogIH0KCiAgZnVuY3Rpb24gYW5pbWF0ZUdob3N0VG9Qb3NpdGlvbihfcmVmMiwgZHVyYXRpb24sIGRyb3BDbGFzcykgewogICAgdmFyIHRvcCA9IF9yZWYyLnRvcCwKICAgICAgICBsZWZ0ID0gX3JlZjIubGVmdDsKICAgIFV0aWxzLmFkZENsYXNzKGdob3N0SW5mby5naG9zdCwgJ2FuaW1hdGVkJyk7CgogICAgaWYgKGRyb3BDbGFzcykgewogICAgICBVdGlscy5hZGRDbGFzcyhnaG9zdEluZm8uZ2hvc3QuZmlyc3RFbGVtZW50Q2hpbGQsIGRyb3BDbGFzcyk7CiAgICB9CgogICAgZ2hvc3RJbmZvLnRvcExlZnQueCA9IGxlZnQ7CiAgICBnaG9zdEluZm8udG9wTGVmdC55ID0gdG9wOwogICAgdHJhbnNsYXRlR2hvc3QoZHVyYXRpb24pOwogICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgIGVuZERyb3AoKTsKICAgIH0sIGR1cmF0aW9uICsgMjApOwogIH0KCiAgZnVuY3Rpb24gc2hvdWxkQW5pbWF0ZURyb3Aob3B0aW9ucykgewogICAgcmV0dXJuIG9wdGlvbnMuc2hvdWxkQW5pbWF0ZURyb3AgPyBvcHRpb25zLnNob3VsZEFuaW1hdGVEcm9wKGRyYWdnYWJsZUluZm8uY29udGFpbmVyLmdldE9wdGlvbnMoKSwgZHJhZ2dhYmxlSW5mby5wYXlsb2FkKSA6IHRydWU7CiAgfQoKICBmdW5jdGlvbiBkaXNhcHBlYXJBbmltYXRpb24oZHVyYXRpb24sIGNsYikgewogICAgVXRpbHMuYWRkQ2xhc3MoZ2hvc3RJbmZvLmdob3N0LCAnYW5pbWF0ZWQnKTsKICAgIHRyYW5zbGF0ZUdob3N0KGR1cmF0aW9uLCAwLjksIHRydWUpOyAvLyBnaG9zdEluZm8uZ2hvc3Quc3R5bGUudHJhbnNpdGlvbkR1cmF0aW9uID0gZHVyYXRpb24gKyAnbXMnOwogICAgLy8gZ2hvc3RJbmZvLmdob3N0LnN0eWxlLm9wYWNpdHkgPSAnMCc7CiAgICAvLyBnaG9zdEluZm8uZ2hvc3Quc3R5bGUudHJhbnNmb3JtID0gJ3NjYWxlKDAuOTApJzsKCiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgY2xiKCk7CiAgICB9LCBkdXJhdGlvbiArIDIwKTsKICB9CgogIGlmIChkcmFnZ2FibGVJbmZvLnRhcmdldEVsZW1lbnQpIHsKICAgIHZhciBjb250YWluZXIgPSBjb250YWluZXJzLmZpbHRlcihmdW5jdGlvbiAocCkgewogICAgICByZXR1cm4gcC5lbGVtZW50ID09PSBkcmFnZ2FibGVJbmZvLnRhcmdldEVsZW1lbnQ7CiAgICB9KVswXTsKCiAgICBpZiAoc2hvdWxkQW5pbWF0ZURyb3AoY29udGFpbmVyLmdldE9wdGlvbnMoKSkpIHsKICAgICAgdmFyIGRyYWdSZXN1bHQgPSBjb250YWluZXIuZ2V0RHJhZ1Jlc3VsdCgpOwogICAgICBhbmltYXRlR2hvc3RUb1Bvc2l0aW9uKGRyYWdSZXN1bHQuc2hhZG93QmVnaW5FbmQucmVjdCwgTWF0aC5tYXgoMTUwLCBjb250YWluZXIuZ2V0T3B0aW9ucygpLmFuaW1hdGlvbkR1cmF0aW9uIC8gMiksIGNvbnRhaW5lci5nZXRPcHRpb25zKCkuZHJvcENsYXNzKTsKICAgIH0gZWxzZSB7CiAgICAgIGVuZERyb3AoKTsKICAgIH0KICB9IGVsc2UgewogICAgdmFyIF9jb250YWluZXIgPSBjb250YWluZXJzLmZpbHRlcihmdW5jdGlvbiAocCkgewogICAgICByZXR1cm4gcCA9PT0gZHJhZ2dhYmxlSW5mby5jb250YWluZXI7CiAgICB9KVswXTsKCiAgICBpZiAoX2NvbnRhaW5lcikgewogICAgICB2YXIgX2NvbnRhaW5lciRnZXRPcHRpb25zID0gX2NvbnRhaW5lci5nZXRPcHRpb25zKCksCiAgICAgICAgICBiZWhhdmlvdXIgPSBfY29udGFpbmVyJGdldE9wdGlvbnMuYmVoYXZpb3VyLAogICAgICAgICAgcmVtb3ZlT25Ecm9wT3V0ID0gX2NvbnRhaW5lciRnZXRPcHRpb25zLnJlbW92ZU9uRHJvcE91dDsKCiAgICAgIGlmICgoYmVoYXZpb3VyID09PSAnbW92ZScgfHwgYmVoYXZpb3VyID09PSAnY29udGFpbicpICYmIChpc0NhbmNlbGluZyB8fCAhcmVtb3ZlT25Ecm9wT3V0KSAmJiBfY29udGFpbmVyLmdldERyYWdSZXN1bHQoKSkgewogICAgICAgIHZhciByZWN0YW5nbGVzID0gX2NvbnRhaW5lci5sYXlvdXQuZ2V0Q29udGFpbmVyUmVjdGFuZ2xlcygpOyAvLyBjb250YWluZXIgaXMgaGlkZGVuIHNvbWVob3cKICAgICAgICAvLyBtb3ZlIGdob3N0IGJhY2sgdG8gbGFzdCBzZWVuIHBvc2l0aW9uCgoKICAgICAgICBpZiAoIVV0aWxzLmlzVmlzaWJsZShyZWN0YW5nbGVzLnZpc2libGVSZWN0KSAmJiBVdGlscy5pc1Zpc2libGUocmVjdGFuZ2xlcy5sYXN0VmlzaWJsZVJlY3QpKSB7CiAgICAgICAgICBhbmltYXRlR2hvc3RUb1Bvc2l0aW9uKHsKICAgICAgICAgICAgdG9wOiByZWN0YW5nbGVzLmxhc3RWaXNpYmxlUmVjdC50b3AsCiAgICAgICAgICAgIGxlZnQ6IHJlY3RhbmdsZXMubGFzdFZpc2libGVSZWN0LmxlZnQKICAgICAgICAgIH0sIF9jb250YWluZXIuZ2V0T3B0aW9ucygpLmFuaW1hdGlvbkR1cmF0aW9uLCBfY29udGFpbmVyLmdldE9wdGlvbnMoKS5kcm9wQ2xhc3MpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgX2NvbnRhaW5lciRnZXREcmFnUmVzID0gX2NvbnRhaW5lci5nZXREcmFnUmVzdWx0KCksCiAgICAgICAgICAgICAgcmVtb3ZlZEluZGV4ID0gX2NvbnRhaW5lciRnZXREcmFnUmVzLnJlbW92ZWRJbmRleCwKICAgICAgICAgICAgICBlbGVtZW50U2l6ZSA9IF9jb250YWluZXIkZ2V0RHJhZ1Jlcy5lbGVtZW50U2l6ZTsKCiAgICAgICAgICB2YXIgbGF5b3V0ID0gX2NvbnRhaW5lci5sYXlvdXQ7IC8vIGRyYWcgZ2hvc3QgdG8gYmFjawoKICAgICAgICAgIF9jb250YWluZXIuZ2V0VHJhbnNsYXRlQ2FsY3VsYXRvcih7CiAgICAgICAgICAgIGRyYWdSZXN1bHQ6IHsKICAgICAgICAgICAgICByZW1vdmVkSW5kZXg6IHJlbW92ZWRJbmRleCwKICAgICAgICAgICAgICBhZGRlZEluZGV4OiByZW1vdmVkSW5kZXgsCiAgICAgICAgICAgICAgZWxlbWVudFNpemU6IGVsZW1lbnRTaXplLAogICAgICAgICAgICAgIHBvczogdW5kZWZpbmVkLAogICAgICAgICAgICAgIHNoYWRvd0JlZ2luRW5kOiB1bmRlZmluZWQKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CgogICAgICAgICAgdmFyIHByZXZEcmFnZ2FibGVFbmQgPSByZW1vdmVkSW5kZXggPiAwID8gbGF5b3V0LmdldEJlZ2luRW5kKF9jb250YWluZXIuZHJhZ2dhYmxlc1tyZW1vdmVkSW5kZXggLSAxXSkuZW5kIDogbGF5b3V0LmdldEJlZ2luRW5kT2ZDb250YWluZXIoKS5iZWdpbjsKICAgICAgICAgIGFuaW1hdGVHaG9zdFRvUG9zaXRpb24obGF5b3V0LmdldFRvcExlZnRPZkVsZW1lbnRCZWdpbihwcmV2RHJhZ2dhYmxlRW5kKSwgX2NvbnRhaW5lci5nZXRPcHRpb25zKCkuYW5pbWF0aW9uRHVyYXRpb24sIF9jb250YWluZXIuZ2V0T3B0aW9ucygpLmRyb3BDbGFzcyk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGRpc2FwcGVhckFuaW1hdGlvbihfY29udGFpbmVyLmdldE9wdGlvbnMoKS5hbmltYXRpb25EdXJhdGlvbiwgZW5kRHJvcCk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIC8vIGNvbnRhaW5lciBpcyBkaXNwb3NlZCBkdWUgdG8gcmVtb3ZhbAogICAgICBkaXNhcHBlYXJBbmltYXRpb24oZGVmYXVsdE9wdGlvbnMuYW5pbWF0aW9uRHVyYXRpb24sIGVuZERyb3ApOwogICAgfQogIH0KfQoKdmFyIGhhbmRsZURyYWdTdGFydENvbmRpdGlvbnMgPSBmdW5jdGlvbiBoYW5kbGVEcmFnU3RhcnRDb25kaXRpb25zKCkgewogIHZhciBzdGFydEV2ZW50OwogIHZhciBkZWxheTsKICB2YXIgY2xiOwogIHZhciB0aW1lciA9IG51bGw7CiAgdmFyIG1vdmVUaHJlc2hvbGQgPSAxOwogIHZhciBtYXhNb3ZlSW5EZWxheSA9IDU7CgogIGZ1bmN0aW9uIG9uTW92ZShldmVudCkgewogICAgdmFyIF9nZXRQb2ludGVyRXZlbnQgPSBnZXRQb2ludGVyRXZlbnQoZXZlbnQpLAogICAgICAgIGN1cnJlbnRYID0gX2dldFBvaW50ZXJFdmVudC5jbGllbnRYLAogICAgICAgIGN1cnJlbnRZID0gX2dldFBvaW50ZXJFdmVudC5jbGllbnRZOwoKICAgIGlmICghZGVsYXkpIHsKICAgICAgaWYgKE1hdGguYWJzKHN0YXJ0RXZlbnQuY2xpZW50WCAtIGN1cnJlbnRYKSA+IG1vdmVUaHJlc2hvbGQgfHwgTWF0aC5hYnMoc3RhcnRFdmVudC5jbGllbnRZIC0gY3VycmVudFkpID4gbW92ZVRocmVzaG9sZCkgewogICAgICAgIHJldHVybiBjYWxsQ2FsbGJhY2soKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgaWYgKE1hdGguYWJzKHN0YXJ0RXZlbnQuY2xpZW50WCAtIGN1cnJlbnRYKSA+IG1heE1vdmVJbkRlbGF5IHx8IE1hdGguYWJzKHN0YXJ0RXZlbnQuY2xpZW50WSAtIGN1cnJlbnRZKSA+IG1heE1vdmVJbkRlbGF5KSB7CiAgICAgICAgZGVyZWdpc3RlckV2ZW50KCk7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIG9uVXAoKSB7CiAgICBkZXJlZ2lzdGVyRXZlbnQoKTsKICB9CgogIGZ1bmN0aW9uIG9uSFRNTERyYWcoKSB7CiAgICBkZXJlZ2lzdGVyRXZlbnQoKTsKICB9CgogIGZ1bmN0aW9uIHJlZ2lzdGVyRXZlbnRzKCkgewogICAgaWYgKGRlbGF5KSB7CiAgICAgIHRpbWVyID0gc2V0VGltZW91dChjYWxsQ2FsbGJhY2ssIGRlbGF5KTsKICAgIH0KCiAgICBtb3ZlRXZlbnRzLmZvckVhY2goZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIHdpbmRvdy5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKGUsIG9uTW92ZSk7CiAgICB9LCB7CiAgICAgIHBhc3NpdmU6IGZhbHNlCiAgICB9KTsKICAgIHJlbGVhc2VFdmVudHMuZm9yRWFjaChmdW5jdGlvbiAoZSkgewogICAgICByZXR1cm4gd2luZG93LmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoZSwgb25VcCk7CiAgICB9LCB7CiAgICAgIHBhc3NpdmU6IGZhbHNlCiAgICB9KTsKICAgIHdpbmRvdy5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdkcmFnJywgb25IVE1MRHJhZywgewogICAgICBwYXNzaXZlOiBmYWxzZQogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBkZXJlZ2lzdGVyRXZlbnQoKSB7CiAgICBjbGVhclRpbWVvdXQodGltZXIpOwogICAgbW92ZUV2ZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7CiAgICAgIHJldHVybiB3aW5kb3cuZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihlLCBvbk1vdmUpOwogICAgfSwgewogICAgICBwYXNzaXZlOiBmYWxzZQogICAgfSk7CiAgICByZWxlYXNlRXZlbnRzLmZvckVhY2goZnVuY3Rpb24gKGUpIHsKICAgICAgcmV0dXJuIHdpbmRvdy5kb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKGUsIG9uVXApOwogICAgfSwgewogICAgICBwYXNzaXZlOiBmYWxzZQogICAgfSk7CiAgICB3aW5kb3cuZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignZHJhZycsIG9uSFRNTERyYWcsIHsKICAgICAgcGFzc2l2ZTogZmFsc2UKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gY2FsbENhbGxiYWNrKCkgewogICAgY2xlYXJUaW1lb3V0KHRpbWVyKTsKICAgIGRlcmVnaXN0ZXJFdmVudCgpOwogICAgY2xiKCk7CiAgfQoKICByZXR1cm4gZnVuY3Rpb24gKF9zdGFydEV2ZW50LCBfZGVsYXksIF9jbGIpIHsKICAgIHN0YXJ0RXZlbnQgPSBnZXRQb2ludGVyRXZlbnQoX3N0YXJ0RXZlbnQpOwogICAgZGVsYXkgPSB0eXBlb2YgX2RlbGF5ID09PSAnbnVtYmVyJyA/IF9kZWxheSA6IGlzTW9iaWxlID8gMjAwIDogMDsKICAgIGNsYiA9IF9jbGI7CiAgICByZWdpc3RlckV2ZW50cygpOwogIH07Cn0oKTsKCmZ1bmN0aW9uIG9uTW91c2VEb3duKGV2ZW50KSB7CiAgdmFyIGUgPSBnZXRQb2ludGVyRXZlbnQoZXZlbnQpOwoKICBpZiAoIV9pc0RyYWdnaW5nICYmIChlLmJ1dHRvbiA9PT0gdW5kZWZpbmVkIHx8IGUuYnV0dG9uID09PSAwKSkgewogICAgZ3JhYmJlZEVsZW1lbnQgPSBVdGlscy5nZXRQYXJlbnQoZS50YXJnZXQsICcuJyArIGNvbnN0YW50cy53cmFwcGVyQ2xhc3MpOwoKICAgIGlmIChncmFiYmVkRWxlbWVudCkgewogICAgICB2YXIgY29udGFpbmVyRWxlbWVudCA9IFV0aWxzLmdldFBhcmVudChncmFiYmVkRWxlbWVudCwgJy4nICsgY29uc3RhbnRzLmNvbnRhaW5lckNsYXNzKTsKICAgICAgdmFyIGNvbnRhaW5lciA9IGNvbnRhaW5lcnMuZmlsdGVyKGZ1bmN0aW9uIChwKSB7CiAgICAgICAgcmV0dXJuIHAuZWxlbWVudCA9PT0gY29udGFpbmVyRWxlbWVudDsKICAgICAgfSlbMF07CiAgICAgIHZhciBkcmFnSGFuZGxlU2VsZWN0b3IgPSBjb250YWluZXIuZ2V0T3B0aW9ucygpLmRyYWdIYW5kbGVTZWxlY3RvcjsKICAgICAgdmFyIG5vbkRyYWdBcmVhU2VsZWN0b3IgPSBjb250YWluZXIuZ2V0T3B0aW9ucygpLm5vbkRyYWdBcmVhU2VsZWN0b3I7CiAgICAgIHZhciBzdGFydERyYWcgPSB0cnVlOwoKICAgICAgaWYgKGRyYWdIYW5kbGVTZWxlY3RvciAmJiAhVXRpbHMuZ2V0UGFyZW50KGUudGFyZ2V0LCBkcmFnSGFuZGxlU2VsZWN0b3IpKSB7CiAgICAgICAgc3RhcnREcmFnID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGlmIChub25EcmFnQXJlYVNlbGVjdG9yICYmIFV0aWxzLmdldFBhcmVudChlLnRhcmdldCwgbm9uRHJhZ0FyZWFTZWxlY3RvcikpIHsKICAgICAgICBzdGFydERyYWcgPSBmYWxzZTsKICAgICAgfQoKICAgICAgaWYgKHN0YXJ0RHJhZykgewogICAgICAgIGNvbnRhaW5lci5sYXlvdXQuaW52YWxpZGF0ZSgpOwogICAgICAgIFV0aWxzLmFkZENsYXNzKHdpbmRvdy5kb2N1bWVudC5ib2R5LCBjb25zdGFudHMuZGlzYmFsZVRvdWNoQWN0aW9ucyk7CiAgICAgICAgVXRpbHMuYWRkQ2xhc3Mod2luZG93LmRvY3VtZW50LmJvZHksIGNvbnN0YW50cy5ub1VzZXJTZWxlY3RDbGFzcyk7CgogICAgICAgIHZhciBfb25Nb3VzZVVwID0gZnVuY3Rpb24gX29uTW91c2VVcCgpIHsKICAgICAgICAgIFV0aWxzLnJlbW92ZUNsYXNzKHdpbmRvdy5kb2N1bWVudC5ib2R5LCBjb25zdGFudHMuZGlzYmFsZVRvdWNoQWN0aW9ucyk7CiAgICAgICAgICBVdGlscy5yZW1vdmVDbGFzcyh3aW5kb3cuZG9jdW1lbnQuYm9keSwgY29uc3RhbnRzLm5vVXNlclNlbGVjdENsYXNzKTsKICAgICAgICAgIHdpbmRvdy5kb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgX29uTW91c2VVcCk7CiAgICAgICAgfTsKCiAgICAgICAgd2luZG93LmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBfb25Nb3VzZVVwKTsKICAgICAgfQoKICAgICAgaWYgKHN0YXJ0RHJhZykgewogICAgICAgIGhhbmRsZURyYWdTdGFydENvbmRpdGlvbnMoZSwgY29udGFpbmVyLmdldE9wdGlvbnMoKS5kcmFnQmVnaW5EZWxheSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgVXRpbHMuY2xlYXJTZWxlY3Rpb24oKTsKICAgICAgICAgIGluaXRpYXRlRHJhZyhlLCBVdGlscy5nZXRFbGVtZW50Q3Vyc29yKGV2ZW50LnRhcmdldCkpOwogICAgICAgICAgYWRkTW92ZUxpc3RlbmVycygpOwogICAgICAgICAgYWRkUmVsZWFzZUxpc3RlbmVycygpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBoYW5kbGVNb3VzZU1vdmVGb3JDb250YWluZXIoX3JlZjMpIHsKICB2YXIgY2xpZW50WCA9IF9yZWYzLmNsaWVudFgsCiAgICAgIGNsaWVudFkgPSBfcmVmMy5jbGllbnRZOwogIHZhciBvcmllbnRhdGlvbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogJ3ZlcnRpY2FsJzsKICB2YXIgYmVnaW5FbmQgPSBkcmFnZ2FibGVJbmZvLmNvbnRhaW5lci5sYXlvdXQuZ2V0QmVnaW5FbmRPZkNvbnRhaW5lclZpc2libGVSZWN0KCk7CiAgdmFyIG1vdXNlUG9zOwogIHZhciBheGlzOwogIHZhciBsZWZ0VG9wOwogIHZhciBzaXplOwoKICBpZiAob3JpZW50YXRpb24gPT09ICd2ZXJ0aWNhbCcpIHsKICAgIG1vdXNlUG9zID0gY2xpZW50WTsKICAgIGF4aXMgPSAneSc7CiAgICBsZWZ0VG9wID0gJ3RvcCc7CiAgICBzaXplID0gZHJhZ2dhYmxlSW5mby5zaXplLm9mZnNldEhlaWdodDsKICB9IGVsc2UgewogICAgbW91c2VQb3MgPSBjbGllbnRYOwogICAgYXhpcyA9ICd4JzsKICAgIGxlZnRUb3AgPSAnbGVmdCc7CiAgICBzaXplID0gZHJhZ2dhYmxlSW5mby5zaXplLm9mZnNldFdpZHRoOwogIH0KCiAgdmFyIGJlZ2luQm91bmRhcnkgPSBiZWdpbkVuZC5iZWdpbjsKICB2YXIgZW5kQm91bmRhcnkgPSBiZWdpbkVuZC5lbmQgLSBzaXplOwogIHZhciBwb3NpdGlvbkluQm91bmRhcnkgPSBNYXRoLm1heChiZWdpbkJvdW5kYXJ5LCBNYXRoLm1pbihlbmRCb3VuZGFyeSwgbW91c2VQb3MgKyBnaG9zdEluZm8ucG9zaXRpb25EZWx0YVtsZWZ0VG9wXSkpOwogIGdob3N0SW5mby50b3BMZWZ0W2F4aXNdID0gcG9zaXRpb25JbkJvdW5kYXJ5OwogIGRyYWdnYWJsZUluZm8ucG9zaXRpb25bYXhpc10gPSBNYXRoLm1heChiZWdpbkVuZC5iZWdpbiwgTWF0aC5taW4oYmVnaW5FbmQuZW5kLCBtb3VzZVBvcyArIGdob3N0SW5mby5jZW50ZXJEZWx0YVtheGlzXSkpOwogIGRyYWdnYWJsZUluZm8ubW91c2VQb3NpdGlvbltheGlzXSA9IE1hdGgubWF4KGJlZ2luRW5kLmJlZ2luLCBNYXRoLm1pbihiZWdpbkVuZC5lbmQsIG1vdXNlUG9zKSk7CgogIGlmIChkcmFnZ2FibGVJbmZvLnBvc2l0aW9uW2F4aXNdIDwgYmVnaW5FbmQuYmVnaW4gKyBzaXplIC8gMikgewogICAgZHJhZ2dhYmxlSW5mby5wb3NpdGlvbltheGlzXSA9IGJlZ2luRW5kLmJlZ2luICsgMjsKICB9CgogIGlmIChkcmFnZ2FibGVJbmZvLnBvc2l0aW9uW2F4aXNdID4gYmVnaW5FbmQuZW5kIC0gc2l6ZSAvIDIpIHsKICAgIGRyYWdnYWJsZUluZm8ucG9zaXRpb25bYXhpc10gPSBiZWdpbkVuZC5lbmQgLSAyOwogIH0KfQoKZnVuY3Rpb24gb25Nb3VzZU1vdmUoZXZlbnQpIHsKICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogIHZhciBlID0gZ2V0UG9pbnRlckV2ZW50KGV2ZW50KTsKCiAgaWYgKCFkcmFnZ2FibGVJbmZvKSB7CiAgICBpbml0aWF0ZURyYWcoZSwgVXRpbHMuZ2V0RWxlbWVudEN1cnNvcihldmVudC50YXJnZXQpKTsKICB9IGVsc2UgewogICAgdmFyIGNvbnRhaW5lck9wdGlvbnMgPSBkcmFnZ2FibGVJbmZvLmNvbnRhaW5lci5nZXRPcHRpb25zKCk7CiAgICB2YXIgaXNDb250YWluRHJhZyA9IGNvbnRhaW5lck9wdGlvbnMuYmVoYXZpb3VyID09PSAnY29udGFpbic7CgogICAgaWYgKGlzQ29udGFpbkRyYWcpIHsKICAgICAgaGFuZGxlTW91c2VNb3ZlRm9yQ29udGFpbmVyKGUsIGNvbnRhaW5lck9wdGlvbnMub3JpZW50YXRpb24pOwogICAgfSBlbHNlIGlmIChzb3VyY2VDb250YWluZXJMb2NrQXhpcykgewogICAgICBpZiAoc291cmNlQ29udGFpbmVyTG9ja0F4aXMgPT09ICd5JykgewogICAgICAgIGdob3N0SW5mby50b3BMZWZ0LnkgPSBlLmNsaWVudFkgKyBnaG9zdEluZm8ucG9zaXRpb25EZWx0YS50b3A7CiAgICAgICAgZHJhZ2dhYmxlSW5mby5wb3NpdGlvbi55ID0gZS5jbGllbnRZICsgZ2hvc3RJbmZvLmNlbnRlckRlbHRhLnk7CiAgICAgICAgZHJhZ2dhYmxlSW5mby5tb3VzZVBvc2l0aW9uLnkgPSBlLmNsaWVudFk7CiAgICAgIH0gZWxzZSBpZiAoc291cmNlQ29udGFpbmVyTG9ja0F4aXMgPT09ICd4JykgewogICAgICAgIGdob3N0SW5mby50b3BMZWZ0LnggPSBlLmNsaWVudFggKyBnaG9zdEluZm8ucG9zaXRpb25EZWx0YS5sZWZ0OwogICAgICAgIGRyYWdnYWJsZUluZm8ucG9zaXRpb24ueCA9IGUuY2xpZW50WCArIGdob3N0SW5mby5jZW50ZXJEZWx0YS54OwogICAgICAgIGRyYWdnYWJsZUluZm8ubW91c2VQb3NpdGlvbi54ID0gZS5jbGllbnRYOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBnaG9zdEluZm8udG9wTGVmdC54ID0gZS5jbGllbnRYICsgZ2hvc3RJbmZvLnBvc2l0aW9uRGVsdGEubGVmdDsKICAgICAgZ2hvc3RJbmZvLnRvcExlZnQueSA9IGUuY2xpZW50WSArIGdob3N0SW5mby5wb3NpdGlvbkRlbHRhLnRvcDsKICAgICAgZHJhZ2dhYmxlSW5mby5wb3NpdGlvbi54ID0gZS5jbGllbnRYICsgZ2hvc3RJbmZvLmNlbnRlckRlbHRhLng7CiAgICAgIGRyYWdnYWJsZUluZm8ucG9zaXRpb24ueSA9IGUuY2xpZW50WSArIGdob3N0SW5mby5jZW50ZXJEZWx0YS55OwogICAgICBkcmFnZ2FibGVJbmZvLm1vdXNlUG9zaXRpb24ueCA9IGUuY2xpZW50WDsKICAgICAgZHJhZ2dhYmxlSW5mby5tb3VzZVBvc2l0aW9uLnkgPSBlLmNsaWVudFk7CiAgICB9CgogICAgdHJhbnNsYXRlR2hvc3QoKTsKCiAgICBpZiAoIWhhbmRsZURyYWcoZHJhZ2dhYmxlSW5mbykpIHsKICAgICAgbWlzc2VkRHJhZyA9IHRydWU7CiAgICB9IGVsc2UgewogICAgICBtaXNzZWREcmFnID0gZmFsc2U7CiAgICB9CgogICAgaWYgKG1pc3NlZERyYWcpIHsKICAgICAgZGVib3VuY2VkSGFuZGxlTWlzc2VkRHJhZ0ZyYW1lKCk7CiAgICB9CiAgfQp9Cgp2YXIgZGVib3VuY2VkSGFuZGxlTWlzc2VkRHJhZ0ZyYW1lID0gVXRpbHMuZGVib3VuY2UoaGFuZGxlTWlzc2VkRHJhZ0ZyYW1lLCAyMCwgZmFsc2UpOwoKZnVuY3Rpb24gaGFuZGxlTWlzc2VkRHJhZ0ZyYW1lKCkgewogIGlmIChtaXNzZWREcmFnKSB7CiAgICBtaXNzZWREcmFnID0gZmFsc2U7CiAgICBoYW5kbGVEcmFnSW1tZWRpYXRlKGRyYWdnYWJsZUluZm8sIGRyYWdMaXN0ZW5pbmdDb250YWluZXJzKTsKICB9Cn0KCmZ1bmN0aW9uIG9uTW91c2VVcCgpIHsKICByZW1vdmVNb3ZlTGlzdGVuZXJzKCk7CiAgcmVtb3ZlUmVsZWFzZUxpc3RlbmVycygpOwogIGlmIChoYW5kbGVTY3JvbGwgJiYgdHlwZW9mIGhhbmRsZVNjcm9sbCA9PT0gJ2Z1bmN0aW9uJykgaGFuZGxlU2Nyb2xsKHsKICAgIHJlc2V0OiB0cnVlCiAgfSk7CgogIGlmIChjdXJzb3JTdHlsZUVsZW1lbnQpIHsKICAgIHJlbW92ZVN0eWxlKGN1cnNvclN0eWxlRWxlbWVudCk7CiAgICBjdXJzb3JTdHlsZUVsZW1lbnQgPSBudWxsOwogIH0KCiAgaWYgKGRyYWdnYWJsZUluZm8pIHsKICAgIGNvbnRhaW5lclJlY3RhYmxlV2F0Y2hlci5zdG9wKCk7CiAgICBoYW5kbGVNaXNzZWREcmFnRnJhbWUoKTsKICAgIGRyb3BBbmltYXRpb25TdGFydGVkID0gdHJ1ZTsKICAgIGhhbmRsZURyb3BBbmltYXRpb24oZnVuY3Rpb24gKCkgewogICAgICBfaXNEcmFnZ2luZyA9IGZhbHNlOwogICAgICBmaXJlT25EcmFnU3RhcnRFbmQoZmFsc2UpOwogICAgICB2YXIgY29udGFpbmVycyA9IGRyYWdMaXN0ZW5pbmdDb250YWluZXJzIHx8IFtdOwogICAgICB2YXIgY29udGFpbmVyVG9DYWxsRHJvcCA9IGNvbnRhaW5lcnMuc2hpZnQoKTsKCiAgICAgIHdoaWxlIChjb250YWluZXJUb0NhbGxEcm9wICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBjb250YWluZXJUb0NhbGxEcm9wLmhhbmRsZURyb3AoZHJhZ2dhYmxlSW5mbyk7CiAgICAgICAgY29udGFpbmVyVG9DYWxsRHJvcCA9IGNvbnRhaW5lcnMuc2hpZnQoKTsKICAgICAgfQoKICAgICAgZHJhZ0xpc3RlbmluZ0NvbnRhaW5lcnMgPSBudWxsOwogICAgICBncmFiYmVkRWxlbWVudCA9IG51bGw7CiAgICAgIGdob3N0SW5mbyA9IG51bGw7CiAgICAgIGRyYWdnYWJsZUluZm8gPSBudWxsOwogICAgICBzb3VyY2VDb250YWluZXJMb2NrQXhpcyA9IG51bGw7CiAgICAgIGhhbmRsZURyYWcgPSBudWxsOwogICAgICBkcm9wQW5pbWF0aW9uU3RhcnRlZCA9IGZhbHNlOwogICAgfSk7CiAgfQp9CgpmdW5jdGlvbiBnZXRQb2ludGVyRXZlbnQoZSkgewogIHJldHVybiBlLnRvdWNoZXMgPyBlLnRvdWNoZXNbMF0gOiBlOwp9CgpmdW5jdGlvbiBoYW5kbGVEcmFnSW1tZWRpYXRlKGRyYWdnYWJsZUluZm8sIGRyYWdMaXN0ZW5pbmdDb250YWluZXJzKSB7CiAgdmFyIGNvbnRhaW5lckJveENoYW5nZWQgPSBmYWxzZTsKICBkcmFnTGlzdGVuaW5nQ29udGFpbmVycy5mb3JFYWNoKGZ1bmN0aW9uIChwKSB7CiAgICB2YXIgZHJhZ1Jlc3VsdCA9IHAuaGFuZGxlRHJhZyhkcmFnZ2FibGVJbmZvKTsKICAgIGNvbnRhaW5lckJveENoYW5nZWQgPSAhIWRyYWdSZXN1bHQuY29udGFpbmVyQm94Q2hhbmdlZCB8fCBmYWxzZTsKICAgIGRyYWdSZXN1bHQuY29udGFpbmVyQm94Q2hhbmdlZCA9IGZhbHNlOwogIH0pOwoKICBpZiAoY29udGFpbmVyQm94Q2hhbmdlZCkgewogICAgY29udGFpbmVyQm94Q2hhbmdlZCA9IGZhbHNlOwogICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uICgpIHsKICAgICAgY29udGFpbmVycy5mb3JFYWNoKGZ1bmN0aW9uIChwKSB7CiAgICAgICAgcC5sYXlvdXQuaW52YWxpZGF0ZVJlY3RzKCk7CiAgICAgICAgcC5vblRyYW5zbGF0ZWQoKTsKICAgICAgfSk7CiAgICB9KTsKICB9Cn0KCmZ1bmN0aW9uIGRyYWdIYW5kbGVyKGRyYWdMaXN0ZW5pbmdDb250YWluZXJzKSB7CiAgdmFyIHRhcmdldENvbnRhaW5lcnMgPSBkcmFnTGlzdGVuaW5nQ29udGFpbmVyczsKICB2YXIgYW5pbWF0aW9uRnJhbWUgPSBudWxsOwogIHJldHVybiBmdW5jdGlvbiAoZHJhZ2dhYmxlSW5mbykgewogICAgaWYgKGFuaW1hdGlvbkZyYW1lID09PSBudWxsICYmIF9pc0RyYWdnaW5nICYmICFkcm9wQW5pbWF0aW9uU3RhcnRlZCkgewogICAgICBhbmltYXRpb25GcmFtZSA9IHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKF9pc0RyYWdnaW5nICYmICFkcm9wQW5pbWF0aW9uU3RhcnRlZCkgewogICAgICAgICAgaGFuZGxlRHJhZ0ltbWVkaWF0ZShkcmFnZ2FibGVJbmZvLCB0YXJnZXRDb250YWluZXJzKTsKICAgICAgICAgIGhhbmRsZVNjcm9sbCh7CiAgICAgICAgICAgIGRyYWdnYWJsZUluZm86IGRyYWdnYWJsZUluZm8KICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgYW5pbWF0aW9uRnJhbWUgPSBudWxsOwogICAgICB9KTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcmV0dXJuIGZhbHNlOwogIH07Cn0KCmZ1bmN0aW9uIGdldFNjcm9sbEhhbmRsZXIoY29udGFpbmVyLCBkcmFnTGlzdGVuaW5nQ29udGFpbmVycykgewogIGlmIChjb250YWluZXIuZ2V0T3B0aW9ucygpLmF1dG9TY3JvbGxFbmFibGVkKSB7CiAgICByZXR1cm4gZHJhZ1Njcm9sbGVyKGRyYWdMaXN0ZW5pbmdDb250YWluZXJzLCBjb250YWluZXIuZ2V0U2Nyb2xsTWF4U3BlZWQoKSk7CiAgfSBlbHNlIHsKICAgIHJldHVybiBmdW5jdGlvbiAocHJvcHMpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9OwogIH0KfQoKZnVuY3Rpb24gZmlyZU9uRHJhZ1N0YXJ0RW5kKGlzU3RhcnQpIHsKICB2YXIgX2RyYWdnYWJsZUluZm8gPSBkcmFnZ2FibGVJbmZvLAogICAgICBjb250YWluZXIgPSBfZHJhZ2dhYmxlSW5mby5jb250YWluZXIsCiAgICAgIHBheWxvYWQgPSBfZHJhZ2dhYmxlSW5mby5wYXlsb2FkOwogIGNvbnRhaW5lcnMuZm9yRWFjaChmdW5jdGlvbiAocCkgewogICAgaWYgKGNvbnRhaW5lci5nZXRPcHRpb25zKCkuZmlyZVJlbGF0ZWRFdmVudHNPbmx5ICYmIHAgIT09IGNvbnRhaW5lcikgcmV0dXJuOwoKICAgIHZhciBfcCRnZXRPcHRpb25zID0gcC5nZXRPcHRpb25zKCksCiAgICAgICAgb25EcmFnU3RhcnQgPSBfcCRnZXRPcHRpb25zLm9uRHJhZ1N0YXJ0LAogICAgICAgIG9uRHJhZ0VuZCA9IF9wJGdldE9wdGlvbnMub25EcmFnRW5kOwoKICAgIHZhciBmbiA9IGlzU3RhcnQgPyBvbkRyYWdTdGFydCA6IG9uRHJhZ0VuZDsKCiAgICBpZiAoZm4pIHsKICAgICAgdmFyIG9wdGlvbnMgPSB7CiAgICAgICAgaXNTb3VyY2U6IHAgPT09IGNvbnRhaW5lciwKICAgICAgICBwYXlsb2FkOiBwYXlsb2FkLAogICAgICAgIHdpbGxBY2NlcHREcm9wOiBmYWxzZQogICAgICB9OwoKICAgICAgaWYgKHAuaXNEcmFnUmVsZXZhbnQoY29udGFpbmVyLCBwYXlsb2FkKSkgewogICAgICAgIG9wdGlvbnMud2lsbEFjY2VwdERyb3AgPSB0cnVlOwogICAgICB9CgogICAgICBmbihvcHRpb25zKTsKICAgIH0KICB9KTsKfQoKZnVuY3Rpb24gaW5pdGlhdGVEcmFnKHBvc2l0aW9uLCBjdXJzb3IpIHsKICBpZiAoZ3JhYmJlZEVsZW1lbnQgIT09IG51bGwpIHsKICAgIGlmIChncmFiYmVkRWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ2RuZHJvcC1ub3QtZHJhZ2dhYmxlJykpIHJldHVybjsKICAgIF9pc0RyYWdnaW5nID0gdHJ1ZTsKICAgIHZhciBjb250YWluZXIgPSBjb250YWluZXJzLmZpbHRlcihmdW5jdGlvbiAocCkgewogICAgICByZXR1cm4gZ3JhYmJlZEVsZW1lbnQucGFyZW50RWxlbWVudCA9PT0gcC5lbGVtZW50OwogICAgfSlbMF07CiAgICBjb250YWluZXIuc2V0RHJhZ2dhYmxlcygpOwogICAgc291cmNlQ29udGFpbmVyTG9ja0F4aXMgPSBjb250YWluZXIuZ2V0T3B0aW9ucygpLmxvY2tBeGlzID8gY29udGFpbmVyLmdldE9wdGlvbnMoKS5sb2NrQXhpcy50b0xvd2VyQ2FzZSgpIDogbnVsbDsKICAgIGRyYWdnYWJsZUluZm8gPSBnZXREcmFnZ2FibGVJbmZvKGdyYWJiZWRFbGVtZW50KTsKICAgIGdob3N0SW5mbyA9IGdldEdob3N0RWxlbWVudChncmFiYmVkRWxlbWVudCwgewogICAgICB4OiBwb3NpdGlvbi5jbGllbnRYLAogICAgICB5OiBwb3NpdGlvbi5jbGllbnRZCiAgICB9LCBkcmFnZ2FibGVJbmZvLmNvbnRhaW5lciwgY3Vyc29yKTsKICAgIGRyYWdnYWJsZUluZm8ucG9zaXRpb24gPSB7CiAgICAgIHg6IHBvc2l0aW9uLmNsaWVudFggKyBnaG9zdEluZm8uY2VudGVyRGVsdGEueCwKICAgICAgeTogcG9zaXRpb24uY2xpZW50WSArIGdob3N0SW5mby5jZW50ZXJEZWx0YS55CiAgICB9OwogICAgZHJhZ2dhYmxlSW5mby5tb3VzZVBvc2l0aW9uID0gewogICAgICB4OiBwb3NpdGlvbi5jbGllbnRYLAogICAgICB5OiBwb3NpdGlvbi5jbGllbnRZCiAgICB9OwogICAgZHJhZ0xpc3RlbmluZ0NvbnRhaW5lcnMgPSBjb250YWluZXJzLmZpbHRlcihmdW5jdGlvbiAocCkgewogICAgICByZXR1cm4gcC5pc0RyYWdSZWxldmFudChjb250YWluZXIsIGRyYWdnYWJsZUluZm8ucGF5bG9hZCk7CiAgICB9KTsKICAgIGRyYWdnYWJsZUluZm8ucmVsZXZhbnRDb250YWluZXJzID0gZHJhZ0xpc3RlbmluZ0NvbnRhaW5lcnM7CiAgICBoYW5kbGVEcmFnID0gZHJhZ0hhbmRsZXIoZHJhZ0xpc3RlbmluZ0NvbnRhaW5lcnMpOwoKICAgIGlmIChoYW5kbGVTY3JvbGwgJiYgdHlwZW9mIGhhbmRsZVNjcm9sbCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICBoYW5kbGVTY3JvbGwoewogICAgICAgIHJlc2V0OiB0cnVlLAogICAgICAgIGRyYWdnYWJsZUluZm86IHVuZGVmaW5lZAogICAgICB9KTsKICAgIH0KCiAgICBoYW5kbGVTY3JvbGwgPSBnZXRTY3JvbGxIYW5kbGVyKGNvbnRhaW5lciwgZHJhZ0xpc3RlbmluZ0NvbnRhaW5lcnMpOwogICAgZHJhZ0xpc3RlbmluZ0NvbnRhaW5lcnMuZm9yRWFjaChmdW5jdGlvbiAocCkgewogICAgICByZXR1cm4gcC5wcmVwYXJlRHJhZyhwLCBkcmFnTGlzdGVuaW5nQ29udGFpbmVycyk7CiAgICB9KTsKICAgIGZpcmVPbkRyYWdTdGFydEVuZCh0cnVlKTsKICAgIGhhbmRsZURyYWcoZHJhZ2dhYmxlSW5mbyk7CiAgICBnZXRHaG9zdFBhcmVudCgpLmFwcGVuZENoaWxkKGdob3N0SW5mby5naG9zdCk7CiAgICBjb250YWluZXJSZWN0YWJsZVdhdGNoZXIuc3RhcnQoKTsKICB9Cn0KCnZhciBnaG9zdEFuaW1hdGlvbkZyYW1lID0gbnVsbDsKCmZ1bmN0aW9uIHRyYW5zbGF0ZUdob3N0KCkgewogIHZhciB0cmFuc2xhdGVEdXJhdGlvbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogMDsKICB2YXIgc2NhbGUgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IDE7CiAgdmFyIGZhZGVPdXQgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IGZhbHNlOwogIHZhciBfZ2hvc3RJbmZvID0gZ2hvc3RJbmZvLAogICAgICBnaG9zdCA9IF9naG9zdEluZm8uZ2hvc3QsCiAgICAgIF9naG9zdEluZm8kdG9wTGVmdCA9IF9naG9zdEluZm8udG9wTGVmdCwKICAgICAgeCA9IF9naG9zdEluZm8kdG9wTGVmdC54LAogICAgICB5ID0gX2dob3N0SW5mbyR0b3BMZWZ0Lnk7CiAgdmFyIHVzZVRyYW5zZm9ybSA9IGRyYWdnYWJsZUluZm8uY29udGFpbmVyID8gZHJhZ2dhYmxlSW5mby5jb250YWluZXIuc2hvdWxkVXNlVHJhbnNmb3JtRm9yR2hvc3QoKSA6IHRydWU7CiAgdmFyIHRyYW5zZm9ybVN0cmluZyA9IHVzZVRyYW5zZm9ybSA/ICJ0cmFuc2xhdGUzZCgiLmNvbmNhdCh4LCAicHgsIikuY29uY2F0KHksICJweCwgMCkiKSA6IG51bGw7CgogIGlmIChzY2FsZSAhPT0gMSkgewogICAgdHJhbnNmb3JtU3RyaW5nID0gdHJhbnNmb3JtU3RyaW5nID8gIiIuY29uY2F0KHRyYW5zZm9ybVN0cmluZywgIiBzY2FsZSgiKS5jb25jYXQoc2NhbGUsICIpIikgOiAic2NhbGUoIi5jb25jYXQoc2NhbGUsICIpIik7CiAgfQoKICBpZiAodHJhbnNsYXRlRHVyYXRpb24gPiAwKSB7CiAgICBnaG9zdEluZm8uZ2hvc3Quc3R5bGUudHJhbnNpdGlvbkR1cmF0aW9uID0gdHJhbnNsYXRlRHVyYXRpb24gKyAnbXMnOwogICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uICgpIHsKICAgICAgdHJhbnNmb3JtU3RyaW5nICYmIChnaG9zdC5zdHlsZS50cmFuc2Zvcm0gPSB0cmFuc2Zvcm1TdHJpbmcpOwoKICAgICAgaWYgKCF1c2VUcmFuc2Zvcm0pIHsKICAgICAgICBnaG9zdC5zdHlsZS5sZWZ0ID0geCArICdweCc7CiAgICAgICAgZ2hvc3Quc3R5bGUudG9wID0geSArICdweCc7CiAgICAgIH0KCiAgICAgIGdob3N0QW5pbWF0aW9uRnJhbWUgPSBudWxsOwoKICAgICAgaWYgKGZhZGVPdXQpIHsKICAgICAgICBnaG9zdC5zdHlsZS5vcGFjaXR5ID0gJzAnOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybjsKICB9CgogIGlmIChnaG9zdEFuaW1hdGlvbkZyYW1lID09PSBudWxsKSB7CiAgICBnaG9zdEFuaW1hdGlvbkZyYW1lID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uICgpIHsKICAgICAgdHJhbnNmb3JtU3RyaW5nICYmIChnaG9zdC5zdHlsZS50cmFuc2Zvcm0gPSB0cmFuc2Zvcm1TdHJpbmcpOwoKICAgICAgaWYgKCF1c2VUcmFuc2Zvcm0pIHsKICAgICAgICBnaG9zdC5zdHlsZS5sZWZ0ID0geCArICdweCc7CiAgICAgICAgZ2hvc3Quc3R5bGUudG9wID0geSArICdweCc7CiAgICAgIH0KCiAgICAgIGdob3N0QW5pbWF0aW9uRnJhbWUgPSBudWxsOwoKICAgICAgaWYgKGZhZGVPdXQpIHsKICAgICAgICBnaG9zdC5zdHlsZS5vcGFjaXR5ID0gJzAnOwogICAgICB9CiAgICB9KTsKICB9Cn0KCmZ1bmN0aW9uIHJlZ2lzdGVyQ29udGFpbmVyKGNvbnRhaW5lcikgewogIGNvbnRhaW5lcnMucHVzaChjb250YWluZXIpOwoKICBpZiAoX2lzRHJhZ2dpbmcgJiYgZHJhZ2dhYmxlSW5mbykgewogICAgaWYgKGNvbnRhaW5lci5pc0RyYWdSZWxldmFudChkcmFnZ2FibGVJbmZvLmNvbnRhaW5lciwgZHJhZ2dhYmxlSW5mby5wYXlsb2FkKSkgewogICAgICBkcmFnTGlzdGVuaW5nQ29udGFpbmVycy5wdXNoKGNvbnRhaW5lcik7CiAgICAgIGNvbnRhaW5lci5wcmVwYXJlRHJhZyhjb250YWluZXIsIGRyYWdMaXN0ZW5pbmdDb250YWluZXJzKTsKCiAgICAgIGlmIChoYW5kbGVTY3JvbGwgJiYgdHlwZW9mIGhhbmRsZVNjcm9sbCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIGhhbmRsZVNjcm9sbCh7CiAgICAgICAgICByZXNldDogdHJ1ZSwKICAgICAgICAgIGRyYWdnYWJsZUluZm86IHVuZGVmaW5lZAogICAgICAgIH0pOwogICAgICB9CgogICAgICBoYW5kbGVTY3JvbGwgPSBnZXRTY3JvbGxIYW5kbGVyKGNvbnRhaW5lciwgZHJhZ0xpc3RlbmluZ0NvbnRhaW5lcnMpOwogICAgICBoYW5kbGVEcmFnID0gZHJhZ0hhbmRsZXIoZHJhZ0xpc3RlbmluZ0NvbnRhaW5lcnMpOwogICAgICBjb250YWluZXIuaGFuZGxlRHJhZyhkcmFnZ2FibGVJbmZvKTsKICAgIH0KICB9Cn0KCmZ1bmN0aW9uIHVucmVnaXN0ZXJDb250YWluZXIoY29udGFpbmVyKSB7CiAgY29udGFpbmVycy5zcGxpY2UoY29udGFpbmVycy5pbmRleE9mKGNvbnRhaW5lciksIDEpOwoKICBpZiAoX2lzRHJhZ2dpbmcgJiYgZHJhZ2dhYmxlSW5mbykgewogICAgaWYgKGRyYWdnYWJsZUluZm8uY29udGFpbmVyID09PSBjb250YWluZXIpIHsKICAgICAgY29udGFpbmVyLmZpcmVSZW1vdmVFbGVtZW50KCk7CiAgICB9CgogICAgaWYgKGRyYWdnYWJsZUluZm8udGFyZ2V0RWxlbWVudCA9PT0gY29udGFpbmVyLmVsZW1lbnQpIHsKICAgICAgZHJhZ2dhYmxlSW5mby50YXJnZXRFbGVtZW50ID0gbnVsbDsKICAgIH0KCiAgICB2YXIgaW5kZXhJbkRyYWdMaXN0ZW5lcnMgPSBkcmFnTGlzdGVuaW5nQ29udGFpbmVycy5pbmRleE9mKGNvbnRhaW5lcik7CgogICAgaWYgKGluZGV4SW5EcmFnTGlzdGVuZXJzID4gLTEpIHsKICAgICAgZHJhZ0xpc3RlbmluZ0NvbnRhaW5lcnMuc3BsaWNlKGluZGV4SW5EcmFnTGlzdGVuZXJzLCAxKTsKCiAgICAgIGlmIChoYW5kbGVTY3JvbGwgJiYgdHlwZW9mIGhhbmRsZVNjcm9sbCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIGhhbmRsZVNjcm9sbCh7CiAgICAgICAgICByZXNldDogdHJ1ZSwKICAgICAgICAgIGRyYWdnYWJsZUluZm86IHVuZGVmaW5lZAogICAgICAgIH0pOwogICAgICB9CgogICAgICBoYW5kbGVTY3JvbGwgPSBnZXRTY3JvbGxIYW5kbGVyKGNvbnRhaW5lciwgZHJhZ0xpc3RlbmluZ0NvbnRhaW5lcnMpOwogICAgICBoYW5kbGVEcmFnID0gZHJhZ0hhbmRsZXIoZHJhZ0xpc3RlbmluZ0NvbnRhaW5lcnMpOwogICAgfQogIH0KfQoKZnVuY3Rpb24gd2F0Y2hSZWN0YW5nbGVzKCkgewogIHZhciBhbmltYXRpb25IYW5kbGUgPSBudWxsOwogIHZhciBpc1N0YXJ0ZWQgPSBmYWxzZTsKCiAgZnVuY3Rpb24gX3N0YXJ0KCkgewogICAgYW5pbWF0aW9uSGFuZGxlID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uICgpIHsKICAgICAgZHJhZ0xpc3RlbmluZ0NvbnRhaW5lcnMuZm9yRWFjaChmdW5jdGlvbiAocCkgewogICAgICAgIHJldHVybiBwLmxheW91dC5pbnZhbGlkYXRlUmVjdHMoKTsKICAgICAgfSk7CiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIGlmIChhbmltYXRpb25IYW5kbGUgIT09IG51bGwpIF9zdGFydCgpOwogICAgICB9LCA1MCk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIHN0b3AoKSB7CiAgICBpZiAoYW5pbWF0aW9uSGFuZGxlICE9PSBudWxsKSB7CiAgICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKGFuaW1hdGlvbkhhbmRsZSk7CiAgICAgIGFuaW1hdGlvbkhhbmRsZSA9IG51bGw7CiAgICB9CgogICAgaXNTdGFydGVkID0gZmFsc2U7CiAgfQoKICByZXR1cm4gewogICAgc3RhcnQ6IGZ1bmN0aW9uIHN0YXJ0KCkgewogICAgICBpZiAoIWlzU3RhcnRlZCkgewogICAgICAgIGlzU3RhcnRlZCA9IHRydWU7CgogICAgICAgIF9zdGFydCgpOwogICAgICB9CiAgICB9LAogICAgc3RvcDogc3RvcAogIH07Cn0KCmZ1bmN0aW9uIGNhbmNlbERyYWcoKSB7CiAgaWYgKF9pc0RyYWdnaW5nICYmICFpc0NhbmNlbGluZyAmJiAhZHJvcEFuaW1hdGlvblN0YXJ0ZWQpIHsKICAgIGlzQ2FuY2VsaW5nID0gdHJ1ZTsKICAgIG1pc3NlZERyYWcgPSBmYWxzZTsKICAgIHZhciBvdXRPZkJvdW5kc0RyYWdnYWJsZUluZm8gPSBPYmplY3QuYXNzaWduKHt9LCBkcmFnZ2FibGVJbmZvLCB7CiAgICAgIHRhcmdldEVsZW1lbnQ6IG51bGwsCiAgICAgIHBvc2l0aW9uOiB7CiAgICAgICAgeDogTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIsCiAgICAgICAgeTogTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIKICAgICAgfSwKICAgICAgbW91c2VQb3NpdGlvbjogewogICAgICAgIHg6IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSLAogICAgICAgIHk6IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSCiAgICAgIH0KICAgIH0pOwogICAgZHJhZ0xpc3RlbmluZ0NvbnRhaW5lcnMuZm9yRWFjaChmdW5jdGlvbiAoY29udGFpbmVyKSB7CiAgICAgIGNvbnRhaW5lci5oYW5kbGVEcmFnKG91dE9mQm91bmRzRHJhZ2dhYmxlSW5mbyk7CiAgICB9KTsKCiAgICBpZiAoZHJhZ2dhYmxlSW5mbykgewogICAgICBkcmFnZ2FibGVJbmZvLnRhcmdldEVsZW1lbnQgPSBudWxsOwogICAgICBkcmFnZ2FibGVJbmZvLmNhbmNlbERyb3AgPSB0cnVlOwogICAgICBvbk1vdXNlVXAoKTsKICAgICAgaXNDYW5jZWxpbmcgPSBmYWxzZTsKICAgIH0KICB9Cn0KCmZ1bmN0aW9uIE1lZGlhdG9yKCkgewogIGxpc3RlbkV2ZW50cygpOwogIHJldHVybiB7CiAgICByZWdpc3RlcjogZnVuY3Rpb24gcmVnaXN0ZXIoY29udGFpbmVyKSB7CiAgICAgIHJlZ2lzdGVyQ29udGFpbmVyKGNvbnRhaW5lcik7CiAgICB9LAogICAgdW5yZWdpc3RlcjogZnVuY3Rpb24gdW5yZWdpc3Rlcihjb250YWluZXIpIHsKICAgICAgdW5yZWdpc3RlckNvbnRhaW5lcihjb250YWluZXIpOwogICAgfSwKICAgIGlzRHJhZ2dpbmc6IGZ1bmN0aW9uIGlzRHJhZ2dpbmcoKSB7CiAgICAgIHJldHVybiBfaXNEcmFnZ2luZzsKICAgIH0sCiAgICBjYW5jZWxEcmFnOiBjYW5jZWxEcmFnCiAgfTsKfQoKaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7CiAgYWRkU3R5bGVUb0hlYWQoKTsKfQoKZXhwb3J0IGRlZmF1bHQgTWVkaWF0b3IoKTs="},{"version":3,"sources":["/Users/qiushunqun/Desktop/射箭專案/GitHub/17soooo/17soooo/src/utils/container/mediator.js"],"names":["constants","defaultOptions","dragScroller","addCursorStyleToBody","addStyleToHead","removeStyle","Utils","grabEvents","moveEvents","releaseEvents","dragListeningContainers","grabbedElement","ghostInfo","draggableInfo","containers","isDragging","isCanceling","dropAnimationStarted","missedDrag","handleDrag","handleScroll","sourceContainerLockAxis","cursorStyleElement","containerRectableWatcher","watchRectangles","isMobile","listenEvents","window","addGrabListeners","forEach","e","document","addEventListener","onMouseDown","passive","addMoveListeners","onMouseMove","removeMoveListeners","removeEventListener","addReleaseListeners","onMouseUp","removeReleaseListeners","getGhostParent","ghostParent","parentElement","body","getGhostElement","wrapperElement","container","cursor","x","y","wrapperRect","getBoundingClientRect","left","top","right","bottom","wrapperVisibleRect","getIntersection","layout","getContainerRectangles","visibleRect","midX","midY","ghost","cloneNode","style","zIndex","boxSizing","position","transform","removeProperty","shouldUseTransformForGhost","width","height","overflow","transition","pointerEvents","userSelect","getOptions","dragClass","setTimeout","addClass","firstElementChild","dragCursor","getComputedStyle","orientation","ghostClass","centerDelta","positionDelta","topLeft","getDraggableInfo","draggableElement","filter","p","element","draggableIndex","draggables","indexOf","draggableRect","size","offsetHeight","offsetWidth","elementIndex","payload","getChildPayload","undefined","targetElement","groupName","invalidateShadow","mousePosition","relevantContainers","handleDropAnimation","callback","endDrop","removeClass","transitionDuration","removeChild","animateGhostToPosition","duration","dropClass","translateGhost","shouldAnimateDrop","options","disappearAnimation","clb","dragResult","getDragResult","shadowBeginEnd","rect","Math","max","animationDuration","behaviour","removeOnDropOut","rectangles","isVisible","lastVisibleRect","removedIndex","elementSize","getTranslateCalculator","addedIndex","pos","prevDraggableEnd","getBeginEnd","end","getBeginEndOfContainer","begin","getTopLeftOfElementBegin","handleDragStartConditions","startEvent","delay","timer","moveThreshold","maxMoveInDelay","onMove","event","getPointerEvent","currentX","clientX","currentY","clientY","abs","callCallback","deregisterEvent","onUp","onHTMLDrag","registerEvents","clearTimeout","_startEvent","_delay","_clb","button","getParent","target","wrapperClass","containerElement","containerClass","dragHandleSelector","nonDragAreaSelector","startDrag","invalidate","disbaleTouchActions","noUserSelectClass","dragBeginDelay","clearSelection","initiateDrag","getElementCursor","handleMouseMoveForContainer","beginEnd","getBeginEndOfContainerVisibleRect","mousePos","axis","leftTop","beginBoundary","endBoundary","positionInBoundary","min","preventDefault","containerOptions","isContainDrag","debouncedHandleMissedDragFrame","debounce","handleMissedDragFrame","handleDragImmediate","reset","stop","fireOnDragStartEnd","containerToCallDrop","shift","handleDrop","touches","containerBoxChanged","requestAnimationFrame","invalidateRects","onTranslated","dragHandler","targetContainers","animationFrame","getScrollHandler","autoScrollEnabled","getScrollMaxSpeed","props","isStart","fireRelatedEventsOnly","onDragStart","onDragEnd","fn","isSource","willAcceptDrop","isDragRelevant","classList","contains","setDraggables","lockAxis","toLowerCase","prepareDrag","appendChild","start","ghostAnimationFrame","translateDuration","scale","fadeOut","useTransform","transformString","opacity","registerContainer","push","unregisterContainer","splice","fireRemoveElement","indexInDragListeners","animationHandle","isStarted","_start","cancelAnimationFrame","cancelDrag","outOfBoundsDraggableInfo","Object","assign","Number","MAX_SAFE_INTEGER","cancelDrop","Mediator","register","unregister"],"mappings":"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","sourcesContent":["import * as constants from './constants';\nimport { defaultOptions } from './defaults';\nimport dragScroller from './scroller';\nimport './polyfills';\nimport { addCursorStyleToBody, addStyleToHead, removeStyle } from './styles';\nimport * as Utils from './utils';\nconst grabEvents = ['mousedown', 'touchstart'];\nconst moveEvents = ['mousemove', 'touchmove'];\nconst releaseEvents = ['mouseup', 'touchend'];\nlet dragListeningContainers = null;\nlet grabbedElement = null;\nlet ghostInfo = null;\nlet draggableInfo = null;\nconst containers = [];\nlet isDragging = false;\nlet isCanceling = false;\nlet dropAnimationStarted = false;\nlet missedDrag = false;\nlet handleDrag = null;\nlet handleScroll = null;\nlet sourceContainerLockAxis = null;\nlet cursorStyleElement = null;\nconst containerRectableWatcher = watchRectangles();\nconst isMobile = Utils.isMobile();\nfunction listenEvents () {\n  if (typeof window !== 'undefined') {\n    addGrabListeners();\n  }\n}\nfunction addGrabListeners () {\n  grabEvents.forEach(e => {\n    window.document.addEventListener(e, onMouseDown, { passive: false });\n  });\n}\nfunction addMoveListeners () {\n  moveEvents.forEach(e => {\n    window.document.addEventListener(e, onMouseMove, { passive: false });\n  });\n}\nfunction removeMoveListeners () {\n  moveEvents.forEach(e => {\n    window.document.removeEventListener(e, onMouseMove, { passive: false });\n  });\n}\nfunction addReleaseListeners () {\n  releaseEvents.forEach(e => {\n    window.document.addEventListener(e, onMouseUp, { passive: false });\n  });\n}\nfunction removeReleaseListeners () {\n  releaseEvents.forEach(e => {\n    window.document.removeEventListener(e, onMouseUp, { passive: false });\n  });\n}\nfunction getGhostParent () {\n  if (draggableInfo && draggableInfo.ghostParent) {\n    return draggableInfo.ghostParent;\n  }\n  if (grabbedElement) {\n    return grabbedElement.parentElement || window.document.body;\n  } else {\n    return window.document.body;\n  }\n}\nfunction getGhostElement (wrapperElement, { x, y }, container, cursor) {\n  const wrapperRect = wrapperElement.getBoundingClientRect();\n  const { left, top, right, bottom } = wrapperRect;\n  const wrapperVisibleRect = Utils.getIntersection(container.layout.getContainerRectangles().visibleRect, wrapperRect);\n  const midX = wrapperVisibleRect.left + (wrapperVisibleRect.right - wrapperVisibleRect.left) / 2;\n  const midY = wrapperVisibleRect.top + (wrapperVisibleRect.bottom - wrapperVisibleRect.top) / 2;\n  const ghost = wrapperElement.cloneNode(true);\n  ghost.style.zIndex = '1000';\n  ghost.style.boxSizing = 'border-box';\n  ghost.style.position = 'fixed';\n  ghost.style.top = '0px';\n  ghost.style.left = '0px';\n  ghost.style.transform = 'none';\n  ghost.style.removeProperty('transform');\n  if (container.shouldUseTransformForGhost()) {\n    ghost.style.transform = `translate3d(${left}px, ${top}px, 0)`;\n  } else {\n    ghost.style.top = `${top}px`;\n    ghost.style.left = `${left}px`;\n  }\n  ghost.style.width = (right - left) + 'px';\n  ghost.style.height = (bottom - top) + 'px';\n  ghost.style.overflow = 'visible';\n  ghost.style.transition = null;\n  ghost.style.removeProperty('transition');\n  ghost.style.pointerEvents = 'none';\n  ghost.style.userSelect = 'none';\n  if (container.getOptions().dragClass) {\n    setTimeout(() => {\n      Utils.addClass(ghost.firstElementChild, container.getOptions().dragClass);\n      const dragCursor = window.getComputedStyle(ghost.firstElementChild).cursor;\n      cursorStyleElement = addCursorStyleToBody(dragCursor);\n    });\n  } else {\n    cursorStyleElement = addCursorStyleToBody(cursor);\n  }\n  Utils.addClass(ghost, container.getOptions().orientation || 'vertical');\n  Utils.addClass(ghost, constants.ghostClass);\n  return {\n    ghost: ghost,\n    centerDelta: { x: midX - x, y: midY - y },\n    positionDelta: { left: left - x, top: top - y },\n    topLeft: {\n      x: left,\n      y: top\n    }\n  };\n}\nfunction getDraggableInfo (draggableElement) {\n  const container = containers.filter(p => draggableElement.parentElement === p.element)[0];\n  const draggableIndex = container.draggables.indexOf(draggableElement);\n  const getGhostParent = container.getOptions().getGhostParent;\n  const draggableRect = draggableElement.getBoundingClientRect();\n  return {\n    container,\n    element: draggableElement,\n    size: {\n      offsetHeight: draggableRect.bottom - draggableRect.top,\n      offsetWidth: draggableRect.right - draggableRect.left,\n    },\n    elementIndex: draggableIndex,\n    payload: container.getOptions().getChildPayload ? container.getOptions().getChildPayload(draggableIndex) : undefined,\n    targetElement: null,\n    position: { x: 0, y: 0 },\n    groupName: container.getOptions().groupName,\n    ghostParent: getGhostParent ? getGhostParent() : null,\n    invalidateShadow: null,\n    mousePosition: null,\n    relevantContainers: null\n  };\n}\nfunction handleDropAnimation (callback) {\n  function endDrop () {\n    Utils.removeClass(ghostInfo.ghost, 'animated');\n    ghostInfo.ghost.style.transitionDuration = null;\n    getGhostParent().removeChild(ghostInfo.ghost);\n    callback();\n  }\n  function animateGhostToPosition ({ top, left }, duration, dropClass) {\n    Utils.addClass(ghostInfo.ghost, 'animated');\n    if (dropClass) {\n      Utils.addClass(ghostInfo.ghost.firstElementChild, dropClass);\n    }\n    ghostInfo.topLeft.x = left;\n    ghostInfo.topLeft.y = top;\n    translateGhost(duration);\n    setTimeout(function () {\n      endDrop();\n    }, duration + 20);\n  }\n  function shouldAnimateDrop (options) {\n    return options.shouldAnimateDrop\n      ? options.shouldAnimateDrop(draggableInfo.container.getOptions(), draggableInfo.payload)\n      : true;\n  }\n  function disappearAnimation (duration, clb) {\n    Utils.addClass(ghostInfo.ghost, 'animated');\n    translateGhost(duration, 0.9, true);\n    // ghostInfo.ghost.style.transitionDuration = duration + 'ms';\n    // ghostInfo.ghost.style.opacity = '0';\n    // ghostInfo.ghost.style.transform = 'scale(0.90)';\n    setTimeout(function () {\n      clb();\n    }, duration + 20);\n  }\n  if (draggableInfo.targetElement) {\n    const container = containers.filter(p => p.element === draggableInfo.targetElement)[0];\n    if (shouldAnimateDrop(container.getOptions())) {\n      const dragResult = container.getDragResult();\n      animateGhostToPosition(dragResult.shadowBeginEnd.rect, Math.max(150, container.getOptions().animationDuration / 2), container.getOptions().dropClass);\n    } else {\n      endDrop();\n    }\n  } else {\n    const container = containers.filter(p => p === draggableInfo.container)[0];\n    if (container) {\n      const { behaviour, removeOnDropOut } = container.getOptions();\n      if ((behaviour === 'move' || behaviour === 'contain') && (isCanceling || !removeOnDropOut) && container.getDragResult()) {\n        const rectangles = container.layout.getContainerRectangles();\n        // container is hidden somehow\n        // move ghost back to last seen position\n        if (!Utils.isVisible(rectangles.visibleRect) && Utils.isVisible(rectangles.lastVisibleRect)) {\n          animateGhostToPosition({\n            top: rectangles.lastVisibleRect.top,\n            left: rectangles.lastVisibleRect.left\n          }, container.getOptions().animationDuration, container.getOptions().dropClass);\n        } else {\n          const { removedIndex, elementSize } = container.getDragResult();\n          const layout = container.layout;\n          // drag ghost to back\n          container.getTranslateCalculator({\n            dragResult: {\n              removedIndex,\n              addedIndex: removedIndex,\n              elementSize,\n              pos: undefined,\n              shadowBeginEnd: undefined,\n            },\n          });\n          const prevDraggableEnd = removedIndex > 0\n            ? layout.getBeginEnd(container.draggables[removedIndex - 1]).end\n            : layout.getBeginEndOfContainer().begin;\n          animateGhostToPosition(layout.getTopLeftOfElementBegin(prevDraggableEnd), container.getOptions().animationDuration, container.getOptions().dropClass);\n        }\n      } else {\n        disappearAnimation(container.getOptions().animationDuration, endDrop);\n      }\n    } else {\n      // container is disposed due to removal\n      disappearAnimation(defaultOptions.animationDuration, endDrop);\n    }\n  }\n}\nconst handleDragStartConditions = (function handleDragStartConditions () {\n  let startEvent;\n  let delay;\n  let clb;\n  let timer = null;\n  const moveThreshold = 1;\n  const maxMoveInDelay = 5;\n  function onMove (event) {\n    const { clientX: currentX, clientY: currentY } = getPointerEvent(event);\n    if (!delay) {\n      if (Math.abs(startEvent.clientX - currentX) > moveThreshold || Math.abs(startEvent.clientY - currentY) > moveThreshold) {\n        return callCallback();\n      }\n    } else {\n      if (Math.abs(startEvent.clientX - currentX) > maxMoveInDelay || Math.abs(startEvent.clientY - currentY) > maxMoveInDelay) {\n        deregisterEvent();\n      }\n    }\n  }\n  function onUp () {\n    deregisterEvent();\n  }\n  function onHTMLDrag () {\n    deregisterEvent();\n  }\n  function registerEvents () {\n    if (delay) {\n      timer = setTimeout(callCallback, delay);\n    }\n    moveEvents.forEach(e => window.document.addEventListener(e, onMove), {\n      passive: false,\n    });\n    releaseEvents.forEach(e => window.document.addEventListener(e, onUp), {\n      passive: false,\n    });\n    window.document.addEventListener('drag', onHTMLDrag, {\n      passive: false,\n    });\n  }\n  function deregisterEvent () {\n    clearTimeout(timer);\n    moveEvents.forEach(e => window.document.removeEventListener(e, onMove), {\n      passive: false,\n    });\n    releaseEvents.forEach(e => window.document.removeEventListener(e, onUp), {\n      passive: false,\n    });\n    window.document.removeEventListener('drag', onHTMLDrag, {\n      passive: false,\n    });\n  }\n  function callCallback () {\n    clearTimeout(timer);\n    deregisterEvent();\n    clb();\n  }\n  return function (_startEvent, _delay, _clb) {\n    startEvent = getPointerEvent(_startEvent);\n    delay = typeof _delay === 'number' ? _delay : isMobile ? 200 : 0;\n    clb = _clb;\n    registerEvents();\n  };\n})();\nfunction onMouseDown (event) {\n  const e = getPointerEvent(event);\n  if (!isDragging && (e.button === undefined || e.button === 0)) {\n    grabbedElement = Utils.getParent(e.target, '.' + constants.wrapperClass);\n    if (grabbedElement) {\n      const containerElement = Utils.getParent(grabbedElement, '.' + constants.containerClass);\n      const container = containers.filter(p => p.element === containerElement)[0];\n      const dragHandleSelector = container.getOptions().dragHandleSelector;\n      const nonDragAreaSelector = container.getOptions().nonDragAreaSelector;\n      let startDrag = true;\n      if (dragHandleSelector && !Utils.getParent(e.target, dragHandleSelector)) {\n        startDrag = false;\n      }\n      if (nonDragAreaSelector && Utils.getParent(e.target, nonDragAreaSelector)) {\n        startDrag = false;\n      }\n      if (startDrag) {\n        container.layout.invalidate();\n        Utils.addClass(window.document.body, constants.disbaleTouchActions);\n        Utils.addClass(window.document.body, constants.noUserSelectClass);\n        const onMouseUp = () => {\n          Utils.removeClass(window.document.body, constants.disbaleTouchActions);\n          Utils.removeClass(window.document.body, constants.noUserSelectClass);\n          window.document.removeEventListener('mouseup', onMouseUp);\n        };\n        window.document.addEventListener('mouseup', onMouseUp);\n      }\n      if (startDrag) {\n        handleDragStartConditions(e, container.getOptions().dragBeginDelay, () => {\n          Utils.clearSelection();\n          initiateDrag(e, Utils.getElementCursor(event.target));\n          addMoveListeners();\n          addReleaseListeners();\n        });\n      }\n    }\n  }\n}\nfunction handleMouseMoveForContainer ({ clientX, clientY }, orientation = 'vertical') {\n  const beginEnd = draggableInfo.container.layout.getBeginEndOfContainerVisibleRect();\n  let mousePos;\n  let axis;\n  let leftTop;\n  let size;\n  if (orientation === 'vertical') {\n    mousePos = clientY;\n    axis = 'y';\n    leftTop = 'top';\n    size = draggableInfo.size.offsetHeight;\n  } else {\n    mousePos = clientX;\n    axis = 'x';\n    leftTop = 'left';\n    size = draggableInfo.size.offsetWidth;\n  }\n  const beginBoundary = beginEnd.begin;\n  const endBoundary = beginEnd.end - size;\n  const positionInBoundary = Math.max(beginBoundary, Math.min(endBoundary, (mousePos + ghostInfo.positionDelta[leftTop])));\n  ghostInfo.topLeft[axis] = positionInBoundary;\n  draggableInfo.position[axis] = Math.max(beginEnd.begin, Math.min(beginEnd.end, (mousePos + ghostInfo.centerDelta[axis])));\n  draggableInfo.mousePosition[axis] = Math.max(beginEnd.begin, Math.min(beginEnd.end, mousePos));\n  if (draggableInfo.position[axis] < (beginEnd.begin + (size / 2))) {\n    draggableInfo.position[axis] = beginEnd.begin + 2;\n  }\n  if (draggableInfo.position[axis] > (beginEnd.end - (size / 2))) {\n    draggableInfo.position[axis] = beginEnd.end - 2;\n  }\n}\nfunction onMouseMove (event) {\n  event.preventDefault();\n  const e = getPointerEvent(event);\n  if (!draggableInfo) {\n    initiateDrag(e, Utils.getElementCursor(event.target));\n  } else {\n    const containerOptions = draggableInfo.container.getOptions();\n    const isContainDrag = containerOptions.behaviour === 'contain';\n    if (isContainDrag) {\n      handleMouseMoveForContainer(e, containerOptions.orientation);\n    } else if (sourceContainerLockAxis) {\n      if (sourceContainerLockAxis === 'y') {\n        ghostInfo.topLeft.y = e.clientY + ghostInfo.positionDelta.top;\n        draggableInfo.position.y = e.clientY + ghostInfo.centerDelta.y;\n        draggableInfo.mousePosition.y = e.clientY;\n      } else if (sourceContainerLockAxis === 'x') {\n        ghostInfo.topLeft.x = e.clientX + ghostInfo.positionDelta.left;\n        draggableInfo.position.x = e.clientX + ghostInfo.centerDelta.x;\n        draggableInfo.mousePosition.x = e.clientX;\n      }\n    } else {\n      ghostInfo.topLeft.x = e.clientX + ghostInfo.positionDelta.left;\n      ghostInfo.topLeft.y = e.clientY + ghostInfo.positionDelta.top;\n      draggableInfo.position.x = e.clientX + ghostInfo.centerDelta.x;\n      draggableInfo.position.y = e.clientY + ghostInfo.centerDelta.y;\n      draggableInfo.mousePosition.x = e.clientX;\n      draggableInfo.mousePosition.y = e.clientY;\n    }\n    translateGhost();\n    if (!handleDrag(draggableInfo)) {\n      missedDrag = true;\n    } else {\n      missedDrag = false;\n    }\n    if (missedDrag) {\n      debouncedHandleMissedDragFrame();\n    }\n  }\n}\nvar debouncedHandleMissedDragFrame = Utils.debounce(handleMissedDragFrame, 20, false);\nfunction handleMissedDragFrame () {\n  if (missedDrag) {\n    missedDrag = false;\n    handleDragImmediate(draggableInfo, dragListeningContainers);\n  }\n}\nfunction onMouseUp () {\n  removeMoveListeners();\n  removeReleaseListeners();\n  if (handleScroll && typeof handleScroll === 'function') handleScroll({ reset: true });\n  if (cursorStyleElement) {\n    removeStyle(cursorStyleElement);\n    cursorStyleElement = null;\n  }\n  if (draggableInfo) {\n    containerRectableWatcher.stop();\n    handleMissedDragFrame();\n    dropAnimationStarted = true;\n    handleDropAnimation(() => {\n      isDragging = false;\n      fireOnDragStartEnd(false);\n      const containers = dragListeningContainers || [];\n      let containerToCallDrop = containers.shift();\n      while (containerToCallDrop !== undefined) {\n        containerToCallDrop.handleDrop(draggableInfo);\n        containerToCallDrop = containers.shift();\n      }\n      dragListeningContainers = null;\n      grabbedElement = null;\n      ghostInfo = null;\n      draggableInfo = null;\n      sourceContainerLockAxis = null;\n      handleDrag = null;\n      dropAnimationStarted = false;\n    });\n  }\n}\nfunction getPointerEvent (e) {\n  return e.touches ? e.touches[0] : e;\n}\nfunction handleDragImmediate (draggableInfo, dragListeningContainers) {\n  let containerBoxChanged = false;\n  dragListeningContainers.forEach((p) => {\n    const dragResult = p.handleDrag(draggableInfo);\n    containerBoxChanged = !!dragResult.containerBoxChanged || false;\n    dragResult.containerBoxChanged = false;\n  });\n  if (containerBoxChanged) {\n    containerBoxChanged = false;\n    requestAnimationFrame(() => {\n      containers.forEach(p => {\n        p.layout.invalidateRects();\n        p.onTranslated();\n      });\n    });\n  }\n}\nfunction dragHandler (dragListeningContainers) {\n  const targetContainers = dragListeningContainers;\n  let animationFrame = null;\n  return function (draggableInfo) {\n    if (animationFrame === null && isDragging && !dropAnimationStarted) {\n      animationFrame = requestAnimationFrame(() => {\n        if (isDragging && !dropAnimationStarted) {\n          handleDragImmediate(draggableInfo, targetContainers);\n          handleScroll({ draggableInfo });\n        }\n        animationFrame = null;\n      });\n      return true;\n    }\n    return false;\n  };\n}\nfunction getScrollHandler (container, dragListeningContainers) {\n  if (container.getOptions().autoScrollEnabled) {\n    return dragScroller(dragListeningContainers, container.getScrollMaxSpeed());\n  } else {\n    return (props) => null;\n  }\n}\nfunction fireOnDragStartEnd (isStart) {\n  const { container, payload } = draggableInfo;\n  containers.forEach(p => {\n    if (container.getOptions().fireRelatedEventsOnly && p !== container) return;\n    const { onDragStart, onDragEnd } = p.getOptions();\n    const fn = isStart ? onDragStart : onDragEnd;\n    if (fn) {\n      const options = {\n        isSource: p === container,\n        payload,\n        willAcceptDrop: false\n      };\n      if (p.isDragRelevant(container, payload)) {\n        options.willAcceptDrop = true;\n      }\n      fn(options);\n    }\n  });\n}\nfunction initiateDrag (position, cursor) {\n  if (grabbedElement !== null) {\n    if (grabbedElement.classList.contains('dndrop-not-draggable')) return;\n    isDragging = true;\n    const container = (containers.filter(p => grabbedElement.parentElement === p.element)[0]);\n    container.setDraggables();\n    sourceContainerLockAxis = container.getOptions().lockAxis ? container.getOptions().lockAxis.toLowerCase() : null;\n    draggableInfo = getDraggableInfo(grabbedElement);\n    ghostInfo = getGhostElement(grabbedElement, { x: position.clientX, y: position.clientY }, draggableInfo.container, cursor);\n    draggableInfo.position = {\n      x: position.clientX + ghostInfo.centerDelta.x,\n      y: position.clientY + ghostInfo.centerDelta.y,\n    };\n    draggableInfo.mousePosition = {\n      x: position.clientX,\n      y: position.clientY,\n    };\n    dragListeningContainers = containers.filter(p => p.isDragRelevant(container, draggableInfo.payload));\n    draggableInfo.relevantContainers = dragListeningContainers;\n    handleDrag = dragHandler(dragListeningContainers);\n    if (handleScroll && typeof handleScroll === 'function') {\n      handleScroll({ reset: true, draggableInfo: undefined });\n    }\n    handleScroll = getScrollHandler(container, dragListeningContainers);\n    dragListeningContainers.forEach(p => p.prepareDrag(p, dragListeningContainers));\n    fireOnDragStartEnd(true);\n    handleDrag(draggableInfo);\n    getGhostParent().appendChild(ghostInfo.ghost);\n    containerRectableWatcher.start();\n  }\n}\nlet ghostAnimationFrame = null;\nfunction translateGhost (translateDuration = 0, scale = 1, fadeOut = false) {\n  const { ghost, topLeft: { x, y } } = ghostInfo;\n  const useTransform = draggableInfo.container ? draggableInfo.container.shouldUseTransformForGhost() : true;\n  let transformString = useTransform ? `translate3d(${x}px,${y}px, 0)` : null;\n  if (scale !== 1) {\n    transformString = transformString ? `${transformString} scale(${scale})` : `scale(${scale})`;\n  }\n  if (translateDuration > 0) {\n    ghostInfo.ghost.style.transitionDuration = translateDuration + 'ms';\n    requestAnimationFrame(() => {\n      transformString && (ghost.style.transform = transformString);\n      if (!useTransform) {\n        ghost.style.left = x + 'px';\n        ghost.style.top = y + 'px';\n      }\n      ghostAnimationFrame = null;\n      if (fadeOut) {\n        ghost.style.opacity = '0';\n      }\n    });\n    return;\n  }\n  if (ghostAnimationFrame === null) {\n    ghostAnimationFrame = requestAnimationFrame(() => {\n      transformString && (ghost.style.transform = transformString);\n      if (!useTransform) {\n        ghost.style.left = x + 'px';\n        ghost.style.top = y + 'px';\n      }\n      ghostAnimationFrame = null;\n      if (fadeOut) {\n        ghost.style.opacity = '0';\n      }\n    });\n  }\n}\nfunction registerContainer (container) {\n  containers.push(container);\n  if (isDragging && draggableInfo) {\n    if (container.isDragRelevant(draggableInfo.container, draggableInfo.payload)) {\n      dragListeningContainers.push(container);\n      container.prepareDrag(container, dragListeningContainers);\n      if (handleScroll && typeof handleScroll === 'function') {\n        handleScroll({ reset: true, draggableInfo: undefined });\n      }\n      handleScroll = getScrollHandler(container, dragListeningContainers);\n      handleDrag = dragHandler(dragListeningContainers);\n      container.handleDrag(draggableInfo);\n    }\n  }\n}\nfunction unregisterContainer (container) {\n  containers.splice(containers.indexOf(container), 1);\n  if (isDragging && draggableInfo) {\n    if (draggableInfo.container === container) {\n      container.fireRemoveElement();\n    }\n    if (draggableInfo.targetElement === container.element) {\n      draggableInfo.targetElement = null;\n    }\n    const indexInDragListeners = dragListeningContainers.indexOf(container);\n    if (indexInDragListeners > -1) {\n      dragListeningContainers.splice(indexInDragListeners, 1);\n      if (handleScroll && typeof handleScroll === 'function') {\n        handleScroll({ reset: true, draggableInfo: undefined });\n      }\n      handleScroll = getScrollHandler(container, dragListeningContainers);\n      handleDrag = dragHandler(dragListeningContainers);\n    }\n  }\n}\nfunction watchRectangles () {\n  let animationHandle = null;\n  let isStarted = false;\n  function _start () {\n    animationHandle = requestAnimationFrame(() => {\n      dragListeningContainers.forEach(p => p.layout.invalidateRects());\n      setTimeout(() => {\n        if (animationHandle !== null) _start();\n      }, 50);\n    });\n  }\n  function stop () {\n    if (animationHandle !== null) {\n      cancelAnimationFrame(animationHandle);\n      animationHandle = null;\n    }\n    isStarted = false;\n  }\n  return {\n    start: () => {\n      if (!isStarted) {\n        isStarted = true;\n        _start();\n      }\n    },\n    stop\n  };\n}\nfunction cancelDrag () {\n  if (isDragging && !isCanceling && !dropAnimationStarted) {\n    isCanceling = true;\n    missedDrag = false;\n    const outOfBoundsDraggableInfo = Object.assign({}, draggableInfo, {\n      targetElement: null,\n      position: { x: Number.MAX_SAFE_INTEGER, y: Number.MAX_SAFE_INTEGER },\n      mousePosition: { x: Number.MAX_SAFE_INTEGER, y: Number.MAX_SAFE_INTEGER },\n    });\n    dragListeningContainers.forEach(container => {\n      container.handleDrag(outOfBoundsDraggableInfo);\n    });\n    if (draggableInfo) {\n      draggableInfo.targetElement = null;\n      draggableInfo.cancelDrop = true;\n      onMouseUp();\n      isCanceling = false;\n    }\n  }\n}\nfunction Mediator () {\n  listenEvents();\n  return {\n    register: function (container) {\n      registerContainer(container);\n    },\n    unregister: function (container) {\n      unregisterContainer(container);\n    },\n    isDragging: function () {\n      return isDragging;\n    },\n    cancelDrag,\n  };\n}\nif (typeof window !== 'undefined') {\n  addStyleToHead();\n}\nexport default Mediator();\n"]}]}
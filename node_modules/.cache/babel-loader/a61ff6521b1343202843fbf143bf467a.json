{"remainingRequest":"/Users/qiushunqun/Desktop/泰雅文化課程/GitHub/main/nahuymatuy.github.io/node_modules/thread-loader/dist/cjs.js!/Users/qiushunqun/Desktop/泰雅文化課程/GitHub/main/nahuymatuy.github.io/node_modules/babel-loader/lib/index.js!/Users/qiushunqun/Desktop/泰雅文化課程/GitHub/main/nahuymatuy.github.io/node_modules/vuetify/lib/components/VSelect/VSelect.js","dependencies":[{"path":"/Users/qiushunqun/Desktop/泰雅文化課程/GitHub/main/nahuymatuy.github.io/node_modules/vuetify/lib/components/VSelect/VSelect.js","mtime":499162500000},{"path":"/Users/qiushunqun/Desktop/泰雅文化課程/GitHub/main/nahuymatuy.github.io/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/qiushunqun/Desktop/泰雅文化課程/GitHub/main/nahuymatuy.github.io/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/qiushunqun/Desktop/泰雅文化課程/GitHub/main/nahuymatuy.github.io/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZC1pbmRleCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZyb20iOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmNsdWRlcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluZGV4LW9mIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucmVkdWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zcGxpY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5mdW5jdGlvbi5uYW1lIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubWFwIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pbmNsdWRlcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zdGFydHMtd2l0aCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy50cmltIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvciI7CmltcG9ydCBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciBmcm9tICIvVXNlcnMvcWl1c2h1bnF1bi9EZXNrdG9wL1x1NkNGMFx1OTZDNVx1NjU4N1x1NTMxNlx1OEFCMlx1N0EwQi9HaXRIdWIvbWFpbi9uYWh1eW1hdHV5LmdpdGh1Yi5pby9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciI7CmltcG9ydCBfZGVmaW5lUHJvcGVydHkgZnJvbSAiL1VzZXJzL3FpdXNodW5xdW4vRGVza3RvcC9cdTZDRjBcdTk2QzVcdTY1ODdcdTUzMTZcdThBQjJcdTdBMEIvR2l0SHViL21haW4vbmFodXltYXR1eS5naXRodWIuaW8vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2RlZmluZVByb3BlcnR5IjsKaW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiL1VzZXJzL3FpdXNodW5xdW4vRGVza3RvcC9cdTZDRjBcdTk2QzVcdTY1ODdcdTUzMTZcdThBQjJcdTdBMEIvR2l0SHViL21haW4vbmFodXltYXR1eS5naXRodWIuaW8vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL29iamVjdFNwcmVhZDIiOwovLyBTdHlsZXMKaW1wb3J0ICIuLi8uLi8uLi9zcmMvY29tcG9uZW50cy9WVGV4dEZpZWxkL1ZUZXh0RmllbGQuc2FzcyI7CmltcG9ydCAiLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvVlNlbGVjdC9WU2VsZWN0LnNhc3MiOyAvLyBDb21wb25lbnRzCgppbXBvcnQgVkNoaXAgZnJvbSAnLi4vVkNoaXAnOwppbXBvcnQgVk1lbnUgZnJvbSAnLi4vVk1lbnUnOwppbXBvcnQgVlNlbGVjdExpc3QgZnJvbSAnLi9WU2VsZWN0TGlzdCc7IC8vIEV4dGVuc2lvbnMKCmltcG9ydCBWSW5wdXQgZnJvbSAnLi4vVklucHV0JzsKaW1wb3J0IFZUZXh0RmllbGQgZnJvbSAnLi4vVlRleHRGaWVsZC9WVGV4dEZpZWxkJzsgLy8gTWl4aW5zCgppbXBvcnQgQ29tcGFyYWJsZSBmcm9tICcuLi8uLi9taXhpbnMvY29tcGFyYWJsZSc7CmltcG9ydCBEZXBlbmRlbnQgZnJvbSAnLi4vLi4vbWl4aW5zL2RlcGVuZGVudCc7CmltcG9ydCBGaWx0ZXJhYmxlIGZyb20gJy4uLy4uL21peGlucy9maWx0ZXJhYmxlJzsgLy8gRGlyZWN0aXZlcwoKaW1wb3J0IENsaWNrT3V0c2lkZSBmcm9tICcuLi8uLi9kaXJlY3RpdmVzL2NsaWNrLW91dHNpZGUnOyAvLyBVdGlsaXRpZXMKCmltcG9ydCBtZXJnZURhdGEgZnJvbSAnLi4vLi4vdXRpbC9tZXJnZURhdGEnOwppbXBvcnQgeyBnZXRQcm9wZXJ0eUZyb21JdGVtLCBnZXRPYmplY3RWYWx1ZUJ5UGF0aCwga2V5Q29kZXMgfSBmcm9tICcuLi8uLi91dGlsL2hlbHBlcnMnOwppbXBvcnQgeyBjb25zb2xlRXJyb3IgfSBmcm9tICcuLi8uLi91dGlsL2NvbnNvbGUnOyAvLyBUeXBlcwoKaW1wb3J0IG1peGlucyBmcm9tICcuLi8uLi91dGlsL21peGlucyc7CmV4cG9ydCB2YXIgZGVmYXVsdE1lbnVQcm9wcyA9IHsKICBjbG9zZU9uQ2xpY2s6IGZhbHNlLAogIGNsb3NlT25Db250ZW50Q2xpY2s6IGZhbHNlLAogIGRpc2FibGVLZXlzOiB0cnVlLAogIG9wZW5PbkNsaWNrOiBmYWxzZSwKICBtYXhIZWlnaHQ6IDMwNAp9OyAvLyBUeXBlcwoKdmFyIGJhc2VNaXhpbnMgPSBtaXhpbnMoVlRleHRGaWVsZCwgQ29tcGFyYWJsZSwgRGVwZW5kZW50LCBGaWx0ZXJhYmxlKTsKLyogQHZ1ZS9jb21wb25lbnQgKi8KCmV4cG9ydCBkZWZhdWx0IGJhc2VNaXhpbnMuZXh0ZW5kKCkuZXh0ZW5kKHsKICBuYW1lOiAndi1zZWxlY3QnLAogIGRpcmVjdGl2ZXM6IHsKICAgIENsaWNrT3V0c2lkZTogQ2xpY2tPdXRzaWRlCiAgfSwKICBwcm9wczogewogICAgYXBwZW5kSWNvbjogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6ICckZHJvcGRvd24nCiAgICB9LAogICAgYXR0YWNoOiB7CiAgICAgIHR5cGU6IG51bGwsCiAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICB9LAogICAgY2FjaGVJdGVtczogQm9vbGVhbiwKICAgIGNoaXBzOiBCb29sZWFuLAogICAgY2xlYXJhYmxlOiBCb29sZWFuLAogICAgZGVsZXRhYmxlQ2hpcHM6IEJvb2xlYW4sCiAgICBkaXNhYmxlTG9va3VwOiBCb29sZWFuLAogICAgZWFnZXI6IEJvb2xlYW4sCiAgICBoaWRlU2VsZWN0ZWQ6IEJvb2xlYW4sCiAgICBpdGVtczogewogICAgICB0eXBlOiBBcnJheSwKICAgICAgZGVmYXVsdDogZnVuY3Rpb24gX2RlZmF1bHQoKSB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgICB9CiAgICB9LAogICAgaXRlbUNvbG9yOiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogJ3ByaW1hcnknCiAgICB9LAogICAgaXRlbURpc2FibGVkOiB7CiAgICAgIHR5cGU6IFtTdHJpbmcsIEFycmF5LCBGdW5jdGlvbl0sCiAgICAgIGRlZmF1bHQ6ICdkaXNhYmxlZCcKICAgIH0sCiAgICBpdGVtVGV4dDogewogICAgICB0eXBlOiBbU3RyaW5nLCBBcnJheSwgRnVuY3Rpb25dLAogICAgICBkZWZhdWx0OiAndGV4dCcKICAgIH0sCiAgICBpdGVtVmFsdWU6IHsKICAgICAgdHlwZTogW1N0cmluZywgQXJyYXksIEZ1bmN0aW9uXSwKICAgICAgZGVmYXVsdDogJ3ZhbHVlJwogICAgfSwKICAgIG1lbnVQcm9wczogewogICAgICB0eXBlOiBbU3RyaW5nLCBBcnJheSwgT2JqZWN0XSwKICAgICAgZGVmYXVsdDogZnVuY3Rpb24gX2RlZmF1bHQoKSB7CiAgICAgICAgcmV0dXJuIGRlZmF1bHRNZW51UHJvcHM7CiAgICAgIH0KICAgIH0sCiAgICBtdWx0aXBsZTogQm9vbGVhbiwKICAgIG9wZW5PbkNsZWFyOiBCb29sZWFuLAogICAgcmV0dXJuT2JqZWN0OiBCb29sZWFuLAogICAgc21hbGxDaGlwczogQm9vbGVhbgogIH0sCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGNhY2hlZEl0ZW1zOiB0aGlzLmNhY2hlSXRlbXMgPyB0aGlzLml0ZW1zIDogW10sCiAgICAgIG1lbnVJc0Jvb3RlZDogZmFsc2UsCiAgICAgIGlzTWVudUFjdGl2ZTogZmFsc2UsCiAgICAgIGxhc3RJdGVtOiAyMCwKICAgICAgLy8gQXMgbG9uZyBhcyBhIHZhbHVlIGlzIGRlZmluZWQsIHNob3cgaXQKICAgICAgLy8gT3RoZXJ3aXNlLCBjaGVjayBpZiBtdWx0aXBsZQogICAgICAvLyB0byBkZXRlcm1pbmUgd2hpY2ggZGVmYXVsdCB0byBwcm92aWRlCiAgICAgIGxhenlWYWx1ZTogdGhpcy52YWx1ZSAhPT0gdW5kZWZpbmVkID8gdGhpcy52YWx1ZSA6IHRoaXMubXVsdGlwbGUgPyBbXSA6IHVuZGVmaW5lZCwKICAgICAgc2VsZWN0ZWRJbmRleDogLTEsCiAgICAgIHNlbGVjdGVkSXRlbXM6IFtdLAogICAgICBrZXlib2FyZExvb2t1cFByZWZpeDogJycsCiAgICAgIGtleWJvYXJkTG9va3VwTGFzdFRpbWU6IDAKICAgIH07CiAgfSwKICBjb21wdXRlZDogewogICAgLyogQWxsIGl0ZW1zIHRoYXQgdGhlIHNlbGVjdCBoYXMgKi8KICAgIGFsbEl0ZW1zOiBmdW5jdGlvbiBhbGxJdGVtcygpIHsKICAgICAgcmV0dXJuIHRoaXMuZmlsdGVyRHVwbGljYXRlcyh0aGlzLmNhY2hlZEl0ZW1zLmNvbmNhdCh0aGlzLml0ZW1zKSk7CiAgICB9LAogICAgY2xhc3NlczogZnVuY3Rpb24gY2xhc3NlcygpIHsKICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgVlRleHRGaWVsZC5vcHRpb25zLmNvbXB1dGVkLmNsYXNzZXMuY2FsbCh0aGlzKSksIHt9LCB7CiAgICAgICAgJ3Ytc2VsZWN0JzogdHJ1ZSwKICAgICAgICAndi1zZWxlY3QtLWNoaXBzJzogdGhpcy5oYXNDaGlwcywKICAgICAgICAndi1zZWxlY3QtLWNoaXBzLS1zbWFsbCc6IHRoaXMuc21hbGxDaGlwcywKICAgICAgICAndi1zZWxlY3QtLWlzLW1lbnUtYWN0aXZlJzogdGhpcy5pc01lbnVBY3RpdmUsCiAgICAgICAgJ3Ytc2VsZWN0LS1pcy1tdWx0aSc6IHRoaXMubXVsdGlwbGUKICAgICAgfSk7CiAgICB9LAoKICAgIC8qIFVzZWQgYnkgb3RoZXIgY29tcG9uZW50cyB0byBvdmVyd3JpdGUgKi8KICAgIGNvbXB1dGVkSXRlbXM6IGZ1bmN0aW9uIGNvbXB1dGVkSXRlbXMoKSB7CiAgICAgIHJldHVybiB0aGlzLmFsbEl0ZW1zOwogICAgfSwKICAgIGNvbXB1dGVkT3duczogZnVuY3Rpb24gY29tcHV0ZWRPd25zKCkgewogICAgICByZXR1cm4gImxpc3QtIi5jb25jYXQodGhpcy5fdWlkKTsKICAgIH0sCiAgICBjb21wdXRlZENvdW50ZXJWYWx1ZTogZnVuY3Rpb24gY29tcHV0ZWRDb3VudGVyVmFsdWUoKSB7CiAgICAgIHZhciB2YWx1ZSA9IHRoaXMubXVsdGlwbGUgPyB0aGlzLnNlbGVjdGVkSXRlbXMgOiAodGhpcy5nZXRUZXh0KHRoaXMuc2VsZWN0ZWRJdGVtc1swXSkgfHwgJycpLnRvU3RyaW5nKCk7CgogICAgICBpZiAodHlwZW9mIHRoaXMuY291bnRlclZhbHVlID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY291bnRlclZhbHVlKHZhbHVlKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHZhbHVlLmxlbmd0aDsKICAgIH0sCiAgICBkaXJlY3RpdmVzOiBmdW5jdGlvbiBkaXJlY3RpdmVzKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgcmV0dXJuIHRoaXMuaXNGb2N1c2VkID8gW3sKICAgICAgICBuYW1lOiAnY2xpY2stb3V0c2lkZScsCiAgICAgICAgdmFsdWU6IHsKICAgICAgICAgIGhhbmRsZXI6IHRoaXMuYmx1ciwKICAgICAgICAgIGNsb3NlQ29uZGl0aW9uYWw6IHRoaXMuY2xvc2VDb25kaXRpb25hbCwKICAgICAgICAgIGluY2x1ZGU6IGZ1bmN0aW9uIGluY2x1ZGUoKSB7CiAgICAgICAgICAgIHJldHVybiBfdGhpcy5nZXRPcGVuRGVwZW5kZW50RWxlbWVudHMoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH1dIDogdW5kZWZpbmVkOwogICAgfSwKICAgIGR5bmFtaWNIZWlnaHQ6IGZ1bmN0aW9uIGR5bmFtaWNIZWlnaHQoKSB7CiAgICAgIHJldHVybiAnYXV0byc7CiAgICB9LAogICAgaGFzQ2hpcHM6IGZ1bmN0aW9uIGhhc0NoaXBzKCkgewogICAgICByZXR1cm4gdGhpcy5jaGlwcyB8fCB0aGlzLnNtYWxsQ2hpcHM7CiAgICB9LAogICAgaGFzU2xvdDogZnVuY3Rpb24gaGFzU2xvdCgpIHsKICAgICAgcmV0dXJuIEJvb2xlYW4odGhpcy5oYXNDaGlwcyB8fCB0aGlzLiRzY29wZWRTbG90cy5zZWxlY3Rpb24pOwogICAgfSwKICAgIGlzRGlydHk6IGZ1bmN0aW9uIGlzRGlydHkoKSB7CiAgICAgIHJldHVybiB0aGlzLnNlbGVjdGVkSXRlbXMubGVuZ3RoID4gMDsKICAgIH0sCiAgICBsaXN0RGF0YTogZnVuY3Rpb24gbGlzdERhdGEoKSB7CiAgICAgIHZhciBzY29wZUlkID0gdGhpcy4kdm5vZGUgJiYgdGhpcy4kdm5vZGUuY29udGV4dC4kb3B0aW9ucy5fc2NvcGVJZDsKICAgICAgdmFyIGF0dHJzID0gc2NvcGVJZCA/IF9kZWZpbmVQcm9wZXJ0eSh7fSwgc2NvcGVJZCwgdHJ1ZSkgOiB7fTsKICAgICAgcmV0dXJuIHsKICAgICAgICBhdHRyczogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBhdHRycyksIHt9LCB7CiAgICAgICAgICBpZDogdGhpcy5jb21wdXRlZE93bnMKICAgICAgICB9KSwKICAgICAgICBwcm9wczogewogICAgICAgICAgYWN0aW9uOiB0aGlzLm11bHRpcGxlLAogICAgICAgICAgY29sb3I6IHRoaXMuaXRlbUNvbG9yLAogICAgICAgICAgZGVuc2U6IHRoaXMuZGVuc2UsCiAgICAgICAgICBoaWRlU2VsZWN0ZWQ6IHRoaXMuaGlkZVNlbGVjdGVkLAogICAgICAgICAgaXRlbXM6IHRoaXMudmlydHVhbGl6ZWRJdGVtcywKICAgICAgICAgIGl0ZW1EaXNhYmxlZDogdGhpcy5pdGVtRGlzYWJsZWQsCiAgICAgICAgICBpdGVtVGV4dDogdGhpcy5pdGVtVGV4dCwKICAgICAgICAgIGl0ZW1WYWx1ZTogdGhpcy5pdGVtVmFsdWUsCiAgICAgICAgICBub0RhdGFUZXh0OiB0aGlzLiR2dWV0aWZ5LmxhbmcudCh0aGlzLm5vRGF0YVRleHQpLAogICAgICAgICAgc2VsZWN0ZWRJdGVtczogdGhpcy5zZWxlY3RlZEl0ZW1zCiAgICAgICAgfSwKICAgICAgICBvbjogewogICAgICAgICAgc2VsZWN0OiB0aGlzLnNlbGVjdEl0ZW0KICAgICAgICB9LAogICAgICAgIHNjb3BlZFNsb3RzOiB7CiAgICAgICAgICBpdGVtOiB0aGlzLiRzY29wZWRTbG90cy5pdGVtCiAgICAgICAgfQogICAgICB9OwogICAgfSwKICAgIHN0YXRpY0xpc3Q6IGZ1bmN0aW9uIHN0YXRpY0xpc3QoKSB7CiAgICAgIGlmICh0aGlzLiRzbG90c1snbm8tZGF0YSddIHx8IHRoaXMuJHNsb3RzWydwcmVwZW5kLWl0ZW0nXSB8fCB0aGlzLiRzbG90c1snYXBwZW5kLWl0ZW0nXSkgewogICAgICAgIGNvbnNvbGVFcnJvcignYXNzZXJ0OiBzdGF0aWNMaXN0IHNob3VsZCBub3QgYmUgY2FsbGVkIGlmIHNsb3RzIGFyZSB1c2VkJyk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzLiRjcmVhdGVFbGVtZW50KFZTZWxlY3RMaXN0LCB0aGlzLmxpc3REYXRhKTsKICAgIH0sCiAgICB2aXJ0dWFsaXplZEl0ZW1zOiBmdW5jdGlvbiB2aXJ0dWFsaXplZEl0ZW1zKCkgewogICAgICByZXR1cm4gdGhpcy4kX21lbnVQcm9wcy5hdXRvID8gdGhpcy5jb21wdXRlZEl0ZW1zIDogdGhpcy5jb21wdXRlZEl0ZW1zLnNsaWNlKDAsIHRoaXMubGFzdEl0ZW0pOwogICAgfSwKICAgIG1lbnVDYW5TaG93OiBmdW5jdGlvbiBtZW51Q2FuU2hvdygpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9LAogICAgJF9tZW51UHJvcHM6IGZ1bmN0aW9uICRfbWVudVByb3BzKCkgewogICAgICB2YXIgbm9ybWFsaXNlZFByb3BzID0gdHlwZW9mIHRoaXMubWVudVByb3BzID09PSAnc3RyaW5nJyA/IHRoaXMubWVudVByb3BzLnNwbGl0KCcsJykgOiB0aGlzLm1lbnVQcm9wczsKCiAgICAgIGlmIChBcnJheS5pc0FycmF5KG5vcm1hbGlzZWRQcm9wcykpIHsKICAgICAgICBub3JtYWxpc2VkUHJvcHMgPSBub3JtYWxpc2VkUHJvcHMucmVkdWNlKGZ1bmN0aW9uIChhY2MsIHApIHsKICAgICAgICAgIGFjY1twLnRyaW0oKV0gPSB0cnVlOwogICAgICAgICAgcmV0dXJuIGFjYzsKICAgICAgICB9LCB7fSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIGRlZmF1bHRNZW51UHJvcHMpLCB7fSwgewogICAgICAgIGVhZ2VyOiB0aGlzLmVhZ2VyLAogICAgICAgIHZhbHVlOiB0aGlzLm1lbnVDYW5TaG93ICYmIHRoaXMuaXNNZW51QWN0aXZlLAogICAgICAgIG51ZGdlQm90dG9tOiBub3JtYWxpc2VkUHJvcHMub2Zmc2V0WSA/IDEgOiAwCiAgICAgIH0sIG5vcm1hbGlzZWRQcm9wcyk7CiAgICB9CiAgfSwKICB3YXRjaDogewogICAgaW50ZXJuYWxWYWx1ZTogZnVuY3Rpb24gaW50ZXJuYWxWYWx1ZSh2YWwpIHsKICAgICAgdGhpcy5pbml0aWFsVmFsdWUgPSB2YWw7CiAgICAgIHRoaXMuc2V0U2VsZWN0ZWRJdGVtcygpOwogICAgfSwKICAgIGlzTWVudUFjdGl2ZTogZnVuY3Rpb24gaXNNZW51QWN0aXZlKHZhbCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gX3RoaXMyLm9uTWVudUFjdGl2ZUNoYW5nZSh2YWwpOwogICAgICB9KTsKICAgIH0sCiAgICBpdGVtczogewogICAgICBpbW1lZGlhdGU6IHRydWUsCiAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uIGhhbmRsZXIodmFsKSB7CiAgICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICAgIGlmICh0aGlzLmNhY2hlSXRlbXMpIHsKICAgICAgICAgIC8vIEJyZWFrcyB2dWUtdGVzdC11dGlscyBpZgogICAgICAgICAgLy8gdGhpcyBpc24ndCBjYWxjdWxhdGVkCiAgICAgICAgICAvLyBvbiB0aGUgbmV4dCB0aWNrCiAgICAgICAgICB0aGlzLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIF90aGlzMy5jYWNoZWRJdGVtcyA9IF90aGlzMy5maWx0ZXJEdXBsaWNhdGVzKF90aGlzMy5jYWNoZWRJdGVtcy5jb25jYXQodmFsKSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHRoaXMuc2V0U2VsZWN0ZWRJdGVtcygpOwogICAgICB9CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICAvKiogQHB1YmxpYyAqLwogICAgYmx1cjogZnVuY3Rpb24gYmx1cihlKSB7CiAgICAgIFZUZXh0RmllbGQub3B0aW9ucy5tZXRob2RzLmJsdXIuY2FsbCh0aGlzLCBlKTsKICAgICAgdGhpcy5pc01lbnVBY3RpdmUgPSBmYWxzZTsKICAgICAgdGhpcy5pc0ZvY3VzZWQgPSBmYWxzZTsKICAgICAgdGhpcy5zZWxlY3RlZEluZGV4ID0gLTE7CiAgICAgIHRoaXMuc2V0TWVudUluZGV4KC0xKTsKICAgIH0sCgogICAgLyoqIEBwdWJsaWMgKi8KICAgIGFjdGl2YXRlTWVudTogZnVuY3Rpb24gYWN0aXZhdGVNZW51KCkgewogICAgICBpZiAoIXRoaXMuaXNJbnRlcmFjdGl2ZSB8fCB0aGlzLmlzTWVudUFjdGl2ZSkgcmV0dXJuOwogICAgICB0aGlzLmlzTWVudUFjdGl2ZSA9IHRydWU7CiAgICB9LAogICAgY2xlYXJhYmxlQ2FsbGJhY2s6IGZ1bmN0aW9uIGNsZWFyYWJsZUNhbGxiYWNrKCkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIHRoaXMuc2V0VmFsdWUodGhpcy5tdWx0aXBsZSA/IFtdIDogbnVsbCk7CiAgICAgIHRoaXMuc2V0TWVudUluZGV4KC0xKTsKICAgICAgdGhpcy4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBfdGhpczQuJHJlZnMuaW5wdXQgJiYgX3RoaXM0LiRyZWZzLmlucHV0LmZvY3VzKCk7CiAgICAgIH0pOwogICAgICBpZiAodGhpcy5vcGVuT25DbGVhcikgdGhpcy5pc01lbnVBY3RpdmUgPSB0cnVlOwogICAgfSwKICAgIGNsb3NlQ29uZGl0aW9uYWw6IGZ1bmN0aW9uIGNsb3NlQ29uZGl0aW9uYWwoZSkgewogICAgICBpZiAoIXRoaXMuaXNNZW51QWN0aXZlKSByZXR1cm4gdHJ1ZTsKICAgICAgcmV0dXJuICF0aGlzLl9pc0Rlc3Ryb3llZCAmJiAoIC8vIENsaWNrIG9yaWdpbmF0ZXMgZnJvbSBvdXRzaWRlIHRoZSBtZW51IGNvbnRlbnQKICAgICAgLy8gTXVsdGlwbGUgc2VsZWN0cyBkb24ndCBjbG9zZSB3aGVuIGFuIGl0ZW0gaXMgY2xpY2tlZAogICAgICAhdGhpcy5nZXRDb250ZW50KCkgfHwgIXRoaXMuZ2V0Q29udGVudCgpLmNvbnRhaW5zKGUudGFyZ2V0KSkgJiYgLy8gQ2xpY2sgb3JpZ2luYXRlcyBmcm9tIG91dHNpZGUgdGhlIGVsZW1lbnQKICAgICAgdGhpcy4kZWwgJiYgIXRoaXMuJGVsLmNvbnRhaW5zKGUudGFyZ2V0KSAmJiBlLnRhcmdldCAhPT0gdGhpcy4kZWw7CiAgICB9LAogICAgZmlsdGVyRHVwbGljYXRlczogZnVuY3Rpb24gZmlsdGVyRHVwbGljYXRlcyhhcnIpIHsKICAgICAgdmFyIHVuaXF1ZVZhbHVlcyA9IG5ldyBNYXAoKTsKCiAgICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCBhcnIubGVuZ3RoOyArK2luZGV4KSB7CiAgICAgICAgdmFyIGl0ZW0gPSBhcnJbaW5kZXhdOyAvLyBEbyBub3QgZGVkdXBsaWNhdGUgaGVhZGVycyBvciBkaXZpZGVycyAoIzEyNTE3KQoKICAgICAgICBpZiAoaXRlbS5oZWFkZXIgfHwgaXRlbS5kaXZpZGVyKSB7CiAgICAgICAgICB1bmlxdWVWYWx1ZXMuc2V0KGl0ZW0sIGl0ZW0pOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQoKICAgICAgICB2YXIgdmFsID0gdGhpcy5nZXRWYWx1ZShpdGVtKTsgLy8gVE9ETzogY29tcGFyYXRvcgoKICAgICAgICAhdW5pcXVlVmFsdWVzLmhhcyh2YWwpICYmIHVuaXF1ZVZhbHVlcy5zZXQodmFsLCBpdGVtKTsKICAgICAgfQoKICAgICAgcmV0dXJuIEFycmF5LmZyb20odW5pcXVlVmFsdWVzLnZhbHVlcygpKTsKICAgIH0sCiAgICBmaW5kRXhpc3RpbmdJbmRleDogZnVuY3Rpb24gZmluZEV4aXN0aW5nSW5kZXgoaXRlbSkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgIHZhciBpdGVtVmFsdWUgPSB0aGlzLmdldFZhbHVlKGl0ZW0pOwogICAgICByZXR1cm4gKHRoaXMuaW50ZXJuYWxWYWx1ZSB8fCBbXSkuZmluZEluZGV4KGZ1bmN0aW9uIChpKSB7CiAgICAgICAgcmV0dXJuIF90aGlzNS52YWx1ZUNvbXBhcmF0b3IoX3RoaXM1LmdldFZhbHVlKGkpLCBpdGVtVmFsdWUpOwogICAgICB9KTsKICAgIH0sCiAgICBnZXRDb250ZW50OiBmdW5jdGlvbiBnZXRDb250ZW50KCkgewogICAgICByZXR1cm4gdGhpcy4kcmVmcy5tZW51ICYmIHRoaXMuJHJlZnMubWVudS4kcmVmcy5jb250ZW50OwogICAgfSwKICAgIGdlbkNoaXBTZWxlY3Rpb246IGZ1bmN0aW9uIGdlbkNoaXBTZWxlY3Rpb24oaXRlbSwgaW5kZXgpIHsKICAgICAgdmFyIF90aGlzNiA9IHRoaXM7CgogICAgICB2YXIgaXNEaXNhYmxlZCA9IHRoaXMuaXNEaXNhYmxlZCB8fCB0aGlzLmdldERpc2FibGVkKGl0ZW0pOwogICAgICB2YXIgaXNJbnRlcmFjdGl2ZSA9ICFpc0Rpc2FibGVkICYmIHRoaXMuaXNJbnRlcmFjdGl2ZTsKICAgICAgcmV0dXJuIHRoaXMuJGNyZWF0ZUVsZW1lbnQoVkNoaXAsIHsKICAgICAgICBzdGF0aWNDbGFzczogJ3YtY2hpcC0tc2VsZWN0JywKICAgICAgICBhdHRyczogewogICAgICAgICAgdGFiaW5kZXg6IC0xCiAgICAgICAgfSwKICAgICAgICBwcm9wczogewogICAgICAgICAgY2xvc2U6IHRoaXMuZGVsZXRhYmxlQ2hpcHMgJiYgaXNJbnRlcmFjdGl2ZSwKICAgICAgICAgIGRpc2FibGVkOiBpc0Rpc2FibGVkLAogICAgICAgICAgaW5wdXRWYWx1ZTogaW5kZXggPT09IHRoaXMuc2VsZWN0ZWRJbmRleCwKICAgICAgICAgIHNtYWxsOiB0aGlzLnNtYWxsQ2hpcHMKICAgICAgICB9LAogICAgICAgIG9uOiB7CiAgICAgICAgICBjbGljazogZnVuY3Rpb24gY2xpY2soZSkgewogICAgICAgICAgICBpZiAoIWlzSW50ZXJhY3RpdmUpIHJldHVybjsKICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgX3RoaXM2LnNlbGVjdGVkSW5kZXggPSBpbmRleDsKICAgICAgICAgIH0sCiAgICAgICAgICAnY2xpY2s6Y2xvc2UnOiBmdW5jdGlvbiBjbGlja0Nsb3NlKCkgewogICAgICAgICAgICByZXR1cm4gX3RoaXM2Lm9uQ2hpcElucHV0KGl0ZW0pOwogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAga2V5OiBKU09OLnN0cmluZ2lmeSh0aGlzLmdldFZhbHVlKGl0ZW0pKQogICAgICB9LCB0aGlzLmdldFRleHQoaXRlbSkpOwogICAgfSwKICAgIGdlbkNvbW1hU2VsZWN0aW9uOiBmdW5jdGlvbiBnZW5Db21tYVNlbGVjdGlvbihpdGVtLCBpbmRleCwgbGFzdCkgewogICAgICB2YXIgY29sb3IgPSBpbmRleCA9PT0gdGhpcy5zZWxlY3RlZEluZGV4ICYmIHRoaXMuY29tcHV0ZWRDb2xvcjsKICAgICAgdmFyIGlzRGlzYWJsZWQgPSB0aGlzLmlzRGlzYWJsZWQgfHwgdGhpcy5nZXREaXNhYmxlZChpdGVtKTsKICAgICAgcmV0dXJuIHRoaXMuJGNyZWF0ZUVsZW1lbnQoJ2RpdicsIHRoaXMuc2V0VGV4dENvbG9yKGNvbG9yLCB7CiAgICAgICAgc3RhdGljQ2xhc3M6ICd2LXNlbGVjdF9fc2VsZWN0aW9uIHYtc2VsZWN0X19zZWxlY3Rpb24tLWNvbW1hJywKICAgICAgICBjbGFzczogewogICAgICAgICAgJ3Ytc2VsZWN0X19zZWxlY3Rpb24tLWRpc2FibGVkJzogaXNEaXNhYmxlZAogICAgICAgIH0sCiAgICAgICAga2V5OiBKU09OLnN0cmluZ2lmeSh0aGlzLmdldFZhbHVlKGl0ZW0pKQogICAgICB9KSwgIiIuY29uY2F0KHRoaXMuZ2V0VGV4dChpdGVtKSkuY29uY2F0KGxhc3QgPyAnJyA6ICcsICcpKTsKICAgIH0sCiAgICBnZW5EZWZhdWx0U2xvdDogZnVuY3Rpb24gZ2VuRGVmYXVsdFNsb3QoKSB7CiAgICAgIHZhciBzZWxlY3Rpb25zID0gdGhpcy5nZW5TZWxlY3Rpb25zKCk7CiAgICAgIHZhciBpbnB1dCA9IHRoaXMuZ2VuSW5wdXQoKTsgLy8gSWYgdGhlIHJldHVybiBpcyBhbiBlbXB0eSBhcnJheQogICAgICAvLyBwdXNoIHRoZSBpbnB1dAoKICAgICAgaWYgKEFycmF5LmlzQXJyYXkoc2VsZWN0aW9ucykpIHsKICAgICAgICBzZWxlY3Rpb25zLnB1c2goaW5wdXQpOyAvLyBPdGhlcndpc2UgcHVzaCBpdCBpbnRvIGNoaWxkcmVuCiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2VsZWN0aW9ucy5jaGlsZHJlbiA9IHNlbGVjdGlvbnMuY2hpbGRyZW4gfHwgW107CiAgICAgICAgc2VsZWN0aW9ucy5jaGlsZHJlbi5wdXNoKGlucHV0KTsKICAgICAgfQoKICAgICAgcmV0dXJuIFt0aGlzLmdlbkZpZWxkc2V0KCksIHRoaXMuJGNyZWF0ZUVsZW1lbnQoJ2RpdicsIHsKICAgICAgICBzdGF0aWNDbGFzczogJ3Ytc2VsZWN0X19zbG90JywKICAgICAgICBkaXJlY3RpdmVzOiB0aGlzLmRpcmVjdGl2ZXMKICAgICAgfSwgW3RoaXMuZ2VuTGFiZWwoKSwgdGhpcy5wcmVmaXggPyB0aGlzLmdlbkFmZml4KCdwcmVmaXgnKSA6IG51bGwsIHNlbGVjdGlvbnMsIHRoaXMuc3VmZml4ID8gdGhpcy5nZW5BZmZpeCgnc3VmZml4JykgOiBudWxsLCB0aGlzLmdlbkNsZWFySWNvbigpLCB0aGlzLmdlbkljb25TbG90KCksIHRoaXMuZ2VuSGlkZGVuSW5wdXQoKV0pLCB0aGlzLmdlbk1lbnUoKSwgdGhpcy5nZW5Qcm9ncmVzcygpXTsKICAgIH0sCiAgICBnZW5JY29uOiBmdW5jdGlvbiBnZW5JY29uKHR5cGUsIGNiLCBleHRyYURhdGEpIHsKICAgICAgdmFyIGljb24gPSBWSW5wdXQub3B0aW9ucy5tZXRob2RzLmdlbkljb24uY2FsbCh0aGlzLCB0eXBlLCBjYiwgZXh0cmFEYXRhKTsKCiAgICAgIGlmICh0eXBlID09PSAnYXBwZW5kJykgewogICAgICAgIC8vIERvbid0IGFsbG93IHRoZSBkcm9wZG93biBpY29uIHRvIGJlIGZvY3VzZWQKICAgICAgICBpY29uLmNoaWxkcmVuWzBdLmRhdGEgPSBtZXJnZURhdGEoaWNvbi5jaGlsZHJlblswXS5kYXRhLCB7CiAgICAgICAgICBhdHRyczogewogICAgICAgICAgICB0YWJpbmRleDogaWNvbi5jaGlsZHJlblswXS5jb21wb25lbnRPcHRpb25zLmxpc3RlbmVycyAmJiAnLTEnLAogICAgICAgICAgICAnYXJpYS1oaWRkZW4nOiAndHJ1ZScsCiAgICAgICAgICAgICdhcmlhLWxhYmVsJzogdW5kZWZpbmVkCiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBpY29uOwogICAgfSwKICAgIGdlbklucHV0OiBmdW5jdGlvbiBnZW5JbnB1dCgpIHsKICAgICAgdmFyIGlucHV0ID0gVlRleHRGaWVsZC5vcHRpb25zLm1ldGhvZHMuZ2VuSW5wdXQuY2FsbCh0aGlzKTsKICAgICAgZGVsZXRlIGlucHV0LmRhdGEuYXR0cnMubmFtZTsKICAgICAgaW5wdXQuZGF0YSA9IG1lcmdlRGF0YShpbnB1dC5kYXRhLCB7CiAgICAgICAgZG9tUHJvcHM6IHsKICAgICAgICAgIHZhbHVlOiBudWxsCiAgICAgICAgfSwKICAgICAgICBhdHRyczogewogICAgICAgICAgcmVhZG9ubHk6IHRydWUsCiAgICAgICAgICB0eXBlOiAndGV4dCcsCiAgICAgICAgICAnYXJpYS1yZWFkb25seSc6IFN0cmluZyh0aGlzLmlzUmVhZG9ubHkpLAogICAgICAgICAgJ2FyaWEtYWN0aXZlZGVzY2VuZGFudCc6IGdldE9iamVjdFZhbHVlQnlQYXRoKHRoaXMuJHJlZnMubWVudSwgJ2FjdGl2ZVRpbGUuaWQnKSwKICAgICAgICAgIGF1dG9jb21wbGV0ZTogZ2V0T2JqZWN0VmFsdWVCeVBhdGgoaW5wdXQuZGF0YSwgJ2F0dHJzLmF1dG9jb21wbGV0ZScsICdvZmYnKSwKICAgICAgICAgIHBsYWNlaG9sZGVyOiAhdGhpcy5pc0RpcnR5ICYmICh0aGlzLnBlcnNpc3RlbnRQbGFjZWhvbGRlciB8fCB0aGlzLmlzRm9jdXNlZCB8fCAhdGhpcy5oYXNMYWJlbCkgPyB0aGlzLnBsYWNlaG9sZGVyIDogdW5kZWZpbmVkCiAgICAgICAgfSwKICAgICAgICBvbjogewogICAgICAgICAga2V5cHJlc3M6IHRoaXMub25LZXlQcmVzcwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybiBpbnB1dDsKICAgIH0sCiAgICBnZW5IaWRkZW5JbnB1dDogZnVuY3Rpb24gZ2VuSGlkZGVuSW5wdXQoKSB7CiAgICAgIHJldHVybiB0aGlzLiRjcmVhdGVFbGVtZW50KCdpbnB1dCcsIHsKICAgICAgICBkb21Qcm9wczogewogICAgICAgICAgdmFsdWU6IHRoaXMubGF6eVZhbHVlCiAgICAgICAgfSwKICAgICAgICBhdHRyczogewogICAgICAgICAgdHlwZTogJ2hpZGRlbicsCiAgICAgICAgICBuYW1lOiB0aGlzLmF0dHJzJC5uYW1lCiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBnZW5JbnB1dFNsb3Q6IGZ1bmN0aW9uIGdlbklucHV0U2xvdCgpIHsKICAgICAgdmFyIHJlbmRlciA9IFZUZXh0RmllbGQub3B0aW9ucy5tZXRob2RzLmdlbklucHV0U2xvdC5jYWxsKHRoaXMpOwogICAgICByZW5kZXIuZGF0YS5hdHRycyA9IF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgcmVuZGVyLmRhdGEuYXR0cnMpLCB7fSwgewogICAgICAgIHJvbGU6ICdidXR0b24nLAogICAgICAgICdhcmlhLWhhc3BvcHVwJzogJ2xpc3Rib3gnLAogICAgICAgICdhcmlhLWV4cGFuZGVkJzogU3RyaW5nKHRoaXMuaXNNZW51QWN0aXZlKSwKICAgICAgICAnYXJpYS1vd25zJzogdGhpcy5jb21wdXRlZE93bnMKICAgICAgfSk7CiAgICAgIHJldHVybiByZW5kZXI7CiAgICB9LAogICAgZ2VuTGlzdDogZnVuY3Rpb24gZ2VuTGlzdCgpIHsKICAgICAgLy8gSWYgdGhlcmUncyBubyBzbG90cywgd2UgY2FuIHVzZSBhIGNhY2hlZCBWTm9kZSB0byBpbXByb3ZlIHBlcmZvcm1hbmNlCiAgICAgIGlmICh0aGlzLiRzbG90c1snbm8tZGF0YSddIHx8IHRoaXMuJHNsb3RzWydwcmVwZW5kLWl0ZW0nXSB8fCB0aGlzLiRzbG90c1snYXBwZW5kLWl0ZW0nXSkgewogICAgICAgIHJldHVybiB0aGlzLmdlbkxpc3RXaXRoU2xvdCgpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB0aGlzLnN0YXRpY0xpc3Q7CiAgICAgIH0KICAgIH0sCiAgICBnZW5MaXN0V2l0aFNsb3Q6IGZ1bmN0aW9uIGdlbkxpc3RXaXRoU2xvdCgpIHsKICAgICAgdmFyIF90aGlzNyA9IHRoaXM7CgogICAgICB2YXIgc2xvdHMgPSBbJ3ByZXBlbmQtaXRlbScsICduby1kYXRhJywgJ2FwcGVuZC1pdGVtJ10uZmlsdGVyKGZ1bmN0aW9uIChzbG90TmFtZSkgewogICAgICAgIHJldHVybiBfdGhpczcuJHNsb3RzW3Nsb3ROYW1lXTsKICAgICAgfSkubWFwKGZ1bmN0aW9uIChzbG90TmFtZSkgewogICAgICAgIHJldHVybiBfdGhpczcuJGNyZWF0ZUVsZW1lbnQoJ3RlbXBsYXRlJywgewogICAgICAgICAgc2xvdDogc2xvdE5hbWUKICAgICAgICB9LCBfdGhpczcuJHNsb3RzW3Nsb3ROYW1lXSk7CiAgICAgIH0pOyAvLyBSZXF1aXJlcyBkZXN0cnVjdHVyaW5nIGR1ZSB0byBWdWUKICAgICAgLy8gbW9kaWZ5aW5nIHRoZSBgb25gIHByb3BlcnR5IHdoZW4gcGFzc2VkCiAgICAgIC8vIGFzIGEgcmVmZXJlbmNlZCBvYmplY3QKCiAgICAgIHJldHVybiB0aGlzLiRjcmVhdGVFbGVtZW50KFZTZWxlY3RMaXN0LCBfb2JqZWN0U3ByZWFkKHt9LCB0aGlzLmxpc3REYXRhKSwgc2xvdHMpOwogICAgfSwKICAgIGdlbk1lbnU6IGZ1bmN0aW9uIGdlbk1lbnUoKSB7CiAgICAgIHZhciBfdGhpczggPSB0aGlzOwoKICAgICAgdmFyIHByb3BzID0gdGhpcy4kX21lbnVQcm9wczsKICAgICAgcHJvcHMuYWN0aXZhdG9yID0gdGhpcy4kcmVmc1snaW5wdXQtc2xvdCddOyAvLyBBdHRhY2ggdG8gcm9vdCBlbCBzbyB0aGF0CiAgICAgIC8vIG1lbnUgY292ZXJzIHByZXBlbmQvYXBwZW5kIGljb25zCgogICAgICBpZiAoIC8vIFRPRE86IG1ha2UgdGhpcyBhIGNvbXB1dGVkIHByb3BlcnR5IG9yIGhlbHBlciBvciBzb21ldGhpbmcKICAgICAgdGhpcy5hdHRhY2ggPT09ICcnIHx8IC8vIElmIHVzZWQgYXMgYSBib29sZWFuIHByb3AgKDx2LW1lbnUgYXR0YWNoPikKICAgICAgdGhpcy5hdHRhY2ggPT09IHRydWUgfHwgLy8gSWYgYm91bmQgdG8gYSBib29sZWFuICg8di1tZW51IDphdHRhY2g9InRydWUiPikKICAgICAgdGhpcy5hdHRhY2ggPT09ICdhdHRhY2gnIC8vIElmIGJvdW5kIGFzIGJvb2xlYW4gcHJvcCBpbiBwdWcgKHYtbWVudShhdHRhY2gpKQogICAgICApIHsKICAgICAgICAgIHByb3BzLmF0dGFjaCA9IHRoaXMuJGVsOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgcHJvcHMuYXR0YWNoID0gdGhpcy5hdHRhY2g7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzLiRjcmVhdGVFbGVtZW50KFZNZW51LCB7CiAgICAgICAgYXR0cnM6IHsKICAgICAgICAgIHJvbGU6IHVuZGVmaW5lZAogICAgICAgIH0sCiAgICAgICAgcHJvcHM6IHByb3BzLAogICAgICAgIG9uOiB7CiAgICAgICAgICBpbnB1dDogZnVuY3Rpb24gaW5wdXQodmFsKSB7CiAgICAgICAgICAgIF90aGlzOC5pc01lbnVBY3RpdmUgPSB2YWw7CiAgICAgICAgICAgIF90aGlzOC5pc0ZvY3VzZWQgPSB2YWw7CiAgICAgICAgICB9LAogICAgICAgICAgc2Nyb2xsOiB0aGlzLm9uU2Nyb2xsCiAgICAgICAgfSwKICAgICAgICByZWY6ICdtZW51JwogICAgICB9LCBbdGhpcy5nZW5MaXN0KCldKTsKICAgIH0sCiAgICBnZW5TZWxlY3Rpb25zOiBmdW5jdGlvbiBnZW5TZWxlY3Rpb25zKCkgewogICAgICB2YXIgbGVuZ3RoID0gdGhpcy5zZWxlY3RlZEl0ZW1zLmxlbmd0aDsKICAgICAgdmFyIGNoaWxkcmVuID0gbmV3IEFycmF5KGxlbmd0aCk7CiAgICAgIHZhciBnZW5TZWxlY3Rpb247CgogICAgICBpZiAodGhpcy4kc2NvcGVkU2xvdHMuc2VsZWN0aW9uKSB7CiAgICAgICAgZ2VuU2VsZWN0aW9uID0gdGhpcy5nZW5TbG90U2VsZWN0aW9uOwogICAgICB9IGVsc2UgaWYgKHRoaXMuaGFzQ2hpcHMpIHsKICAgICAgICBnZW5TZWxlY3Rpb24gPSB0aGlzLmdlbkNoaXBTZWxlY3Rpb247CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZ2VuU2VsZWN0aW9uID0gdGhpcy5nZW5Db21tYVNlbGVjdGlvbjsKICAgICAgfQoKICAgICAgd2hpbGUgKGxlbmd0aC0tKSB7CiAgICAgICAgY2hpbGRyZW5bbGVuZ3RoXSA9IGdlblNlbGVjdGlvbih0aGlzLnNlbGVjdGVkSXRlbXNbbGVuZ3RoXSwgbGVuZ3RoLCBsZW5ndGggPT09IGNoaWxkcmVuLmxlbmd0aCAtIDEpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy4kY3JlYXRlRWxlbWVudCgnZGl2JywgewogICAgICAgIHN0YXRpY0NsYXNzOiAndi1zZWxlY3RfX3NlbGVjdGlvbnMnCiAgICAgIH0sIGNoaWxkcmVuKTsKICAgIH0sCiAgICBnZW5TbG90U2VsZWN0aW9uOiBmdW5jdGlvbiBnZW5TbG90U2VsZWN0aW9uKGl0ZW0sIGluZGV4KSB7CiAgICAgIHZhciBfdGhpczkgPSB0aGlzOwoKICAgICAgcmV0dXJuIHRoaXMuJHNjb3BlZFNsb3RzLnNlbGVjdGlvbih7CiAgICAgICAgYXR0cnM6IHsKICAgICAgICAgIGNsYXNzOiAndi1jaGlwLS1zZWxlY3QnCiAgICAgICAgfSwKICAgICAgICBwYXJlbnQ6IHRoaXMsCiAgICAgICAgaXRlbTogaXRlbSwKICAgICAgICBpbmRleDogaW5kZXgsCiAgICAgICAgc2VsZWN0OiBmdW5jdGlvbiBzZWxlY3QoZSkgewogICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgIF90aGlzOS5zZWxlY3RlZEluZGV4ID0gaW5kZXg7CiAgICAgICAgfSwKICAgICAgICBzZWxlY3RlZDogaW5kZXggPT09IHRoaXMuc2VsZWN0ZWRJbmRleCwKICAgICAgICBkaXNhYmxlZDogIXRoaXMuaXNJbnRlcmFjdGl2ZQogICAgICB9KTsKICAgIH0sCiAgICBnZXRNZW51SW5kZXg6IGZ1bmN0aW9uIGdldE1lbnVJbmRleCgpIHsKICAgICAgcmV0dXJuIHRoaXMuJHJlZnMubWVudSA/IHRoaXMuJHJlZnMubWVudS5saXN0SW5kZXggOiAtMTsKICAgIH0sCiAgICBnZXREaXNhYmxlZDogZnVuY3Rpb24gZ2V0RGlzYWJsZWQoaXRlbSkgewogICAgICByZXR1cm4gZ2V0UHJvcGVydHlGcm9tSXRlbShpdGVtLCB0aGlzLml0ZW1EaXNhYmxlZCwgZmFsc2UpOwogICAgfSwKICAgIGdldFRleHQ6IGZ1bmN0aW9uIGdldFRleHQoaXRlbSkgewogICAgICByZXR1cm4gZ2V0UHJvcGVydHlGcm9tSXRlbShpdGVtLCB0aGlzLml0ZW1UZXh0LCBpdGVtKTsKICAgIH0sCiAgICBnZXRWYWx1ZTogZnVuY3Rpb24gZ2V0VmFsdWUoaXRlbSkgewogICAgICByZXR1cm4gZ2V0UHJvcGVydHlGcm9tSXRlbShpdGVtLCB0aGlzLml0ZW1WYWx1ZSwgdGhpcy5nZXRUZXh0KGl0ZW0pKTsKICAgIH0sCiAgICBvbkJsdXI6IGZ1bmN0aW9uIG9uQmx1cihlKSB7CiAgICAgIGUgJiYgdGhpcy4kZW1pdCgnYmx1cicsIGUpOwogICAgfSwKICAgIG9uQ2hpcElucHV0OiBmdW5jdGlvbiBvbkNoaXBJbnB1dChpdGVtKSB7CiAgICAgIGlmICh0aGlzLm11bHRpcGxlKSB0aGlzLnNlbGVjdEl0ZW0oaXRlbSk7ZWxzZSB0aGlzLnNldFZhbHVlKG51bGwpOyAvLyBJZiBhbGwgaXRlbXMgaGF2ZSBiZWVuIGRlbGV0ZWQsCiAgICAgIC8vIG9wZW4gYHYtbWVudWAKCiAgICAgIGlmICh0aGlzLnNlbGVjdGVkSXRlbXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5pc01lbnVBY3RpdmUgPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaXNNZW51QWN0aXZlID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIHRoaXMuc2VsZWN0ZWRJbmRleCA9IC0xOwogICAgfSwKICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soZSkgewogICAgICBpZiAoIXRoaXMuaXNJbnRlcmFjdGl2ZSkgcmV0dXJuOwoKICAgICAgaWYgKCF0aGlzLmlzQXBwZW5kSW5uZXIoZS50YXJnZXQpKSB7CiAgICAgICAgdGhpcy5pc01lbnVBY3RpdmUgPSB0cnVlOwogICAgICB9CgogICAgICBpZiAoIXRoaXMuaXNGb2N1c2VkKSB7CiAgICAgICAgdGhpcy5pc0ZvY3VzZWQgPSB0cnVlOwogICAgICAgIHRoaXMuJGVtaXQoJ2ZvY3VzJyk7CiAgICAgIH0KCiAgICAgIHRoaXMuJGVtaXQoJ2NsaWNrJywgZSk7CiAgICB9LAogICAgb25Fc2NEb3duOiBmdW5jdGlvbiBvbkVzY0Rvd24oZSkgewogICAgICBlLnByZXZlbnREZWZhdWx0KCk7CgogICAgICBpZiAodGhpcy5pc01lbnVBY3RpdmUpIHsKICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgIHRoaXMuaXNNZW51QWN0aXZlID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCiAgICBvbktleVByZXNzOiBmdW5jdGlvbiBvbktleVByZXNzKGUpIHsKICAgICAgdmFyIF90aGlzMTAgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMubXVsdGlwbGUgfHwgIXRoaXMuaXNJbnRlcmFjdGl2ZSB8fCB0aGlzLmRpc2FibGVMb29rdXApIHJldHVybjsKICAgICAgdmFyIEtFWUJPQVJEX0xPT0tVUF9USFJFU0hPTEQgPSAxMDAwOyAvLyBtaWxsaXNlY29uZHMKCiAgICAgIHZhciBub3cgPSBwZXJmb3JtYW5jZS5ub3coKTsKCiAgICAgIGlmIChub3cgLSB0aGlzLmtleWJvYXJkTG9va3VwTGFzdFRpbWUgPiBLRVlCT0FSRF9MT09LVVBfVEhSRVNIT0xEKSB7CiAgICAgICAgdGhpcy5rZXlib2FyZExvb2t1cFByZWZpeCA9ICcnOwogICAgICB9CgogICAgICB0aGlzLmtleWJvYXJkTG9va3VwUHJlZml4ICs9IGUua2V5LnRvTG93ZXJDYXNlKCk7CiAgICAgIHRoaXMua2V5Ym9hcmRMb29rdXBMYXN0VGltZSA9IG5vdzsKICAgICAgdmFyIGluZGV4ID0gdGhpcy5hbGxJdGVtcy5maW5kSW5kZXgoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICB2YXIgdGV4dCA9IChfdGhpczEwLmdldFRleHQoaXRlbSkgfHwgJycpLnRvU3RyaW5nKCk7CiAgICAgICAgcmV0dXJuIHRleHQudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKF90aGlzMTAua2V5Ym9hcmRMb29rdXBQcmVmaXgpOwogICAgICB9KTsKICAgICAgdmFyIGl0ZW0gPSB0aGlzLmFsbEl0ZW1zW2luZGV4XTsKCiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICB0aGlzLmxhc3RJdGVtID0gTWF0aC5tYXgodGhpcy5sYXN0SXRlbSwgaW5kZXggKyA1KTsKICAgICAgICB0aGlzLnNldFZhbHVlKHRoaXMucmV0dXJuT2JqZWN0ID8gaXRlbSA6IHRoaXMuZ2V0VmFsdWUoaXRlbSkpOwogICAgICAgIHRoaXMuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBfdGhpczEwLiRyZWZzLm1lbnUuZ2V0VGlsZXMoKTsKICAgICAgICB9KTsKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJldHVybiBfdGhpczEwLnNldE1lbnVJbmRleChpbmRleCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBvbktleURvd246IGZ1bmN0aW9uIG9uS2V5RG93bihlKSB7CiAgICAgIHZhciBfdGhpczExID0gdGhpczsKCiAgICAgIGlmICh0aGlzLmlzUmVhZG9ubHkgJiYgZS5rZXlDb2RlICE9PSBrZXlDb2Rlcy50YWIpIHJldHVybjsKICAgICAgdmFyIGtleUNvZGUgPSBlLmtleUNvZGU7CiAgICAgIHZhciBtZW51ID0gdGhpcy4kcmVmcy5tZW51OwogICAgICB0aGlzLiRlbWl0KCdrZXlkb3duJywgZSk7CiAgICAgIGlmICghbWVudSkgcmV0dXJuOyAvLyBJZiBtZW51IGlzIGFjdGl2ZSwgYWxsb3cgZGVmYXVsdAogICAgICAvLyBsaXN0SW5kZXggY2hhbmdlIGZyb20gbWVudQoKICAgICAgaWYgKHRoaXMuaXNNZW51QWN0aXZlICYmIGtleUNvZGUgIT09IGtleUNvZGVzLnRhYikgewogICAgICAgIHRoaXMuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIG1lbnUuY2hhbmdlTGlzdEluZGV4KGUpOwoKICAgICAgICAgIF90aGlzMTEuJGVtaXQoJ3VwZGF0ZTpsaXN0LWluZGV4JywgbWVudS5saXN0SW5kZXgpOwogICAgICAgIH0pOwogICAgICB9IC8vIElmIGVudGVyLCBzcGFjZSwgb3BlbiBtZW51CgoKICAgICAgaWYgKFtrZXlDb2Rlcy5lbnRlciwga2V5Q29kZXMuc3BhY2VdLmluY2x1ZGVzKGtleUNvZGUpKSB0aGlzLmFjdGl2YXRlTWVudSgpOyAvLyBJZiBtZW51IGlzIG5vdCBhY3RpdmUsIHVwL2Rvd24vaG9tZS9lbmQgY2FuIGRvCiAgICAgIC8vIG9uZSBvZiAyIHRoaW5ncy4gSWYgbXVsdGlwbGUsIG9wZW5zIHRoZQogICAgICAvLyBtZW51LCBpZiBub3QsIHdpbGwgY3ljbGUgdGhyb3VnaCBhbGwKICAgICAgLy8gYXZhaWxhYmxlIG9wdGlvbnMKCiAgICAgIGlmICghdGhpcy5pc01lbnVBY3RpdmUgJiYgW2tleUNvZGVzLnVwLCBrZXlDb2Rlcy5kb3duLCBrZXlDb2Rlcy5ob21lLCBrZXlDb2Rlcy5lbmRdLmluY2x1ZGVzKGtleUNvZGUpKSByZXR1cm4gdGhpcy5vblVwRG93bihlKTsgLy8gSWYgZXNjYXBlIGRlYWN0aXZhdGUgdGhlIG1lbnUKCiAgICAgIGlmIChrZXlDb2RlID09PSBrZXlDb2Rlcy5lc2MpIHJldHVybiB0aGlzLm9uRXNjRG93bihlKTsgLy8gSWYgdGFiIC0gc2VsZWN0IGl0ZW0gb3IgY2xvc2UgbWVudQoKICAgICAgaWYgKGtleUNvZGUgPT09IGtleUNvZGVzLnRhYikgcmV0dXJuIHRoaXMub25UYWJEb3duKGUpOyAvLyBJZiBzcGFjZSBwcmV2ZW50RGVmYXVsdAoKICAgICAgaWYgKGtleUNvZGUgPT09IGtleUNvZGVzLnNwYWNlKSByZXR1cm4gdGhpcy5vblNwYWNlRG93bihlKTsKICAgIH0sCiAgICBvbk1lbnVBY3RpdmVDaGFuZ2U6IGZ1bmN0aW9uIG9uTWVudUFjdGl2ZUNoYW5nZSh2YWwpIHsKICAgICAgLy8gSWYgbWVudSBpcyBjbG9zaW5nIGFuZCBtdWxpdHBsZQogICAgICAvLyBvciBtZW51SW5kZXggaXMgYWxyZWFkeSBzZXQKICAgICAgLy8gc2tpcCBtZW51IGluZGV4IHJlY2FsY3VsYXRpb24KICAgICAgaWYgKHRoaXMubXVsdGlwbGUgJiYgIXZhbCB8fCB0aGlzLmdldE1lbnVJbmRleCgpID4gLTEpIHJldHVybjsKICAgICAgdmFyIG1lbnUgPSB0aGlzLiRyZWZzLm1lbnU7CiAgICAgIGlmICghbWVudSB8fCAhdGhpcy5pc0RpcnR5KSByZXR1cm47IC8vIFdoZW4gbWVudSBvcGVucywgc2V0IGluZGV4IG9mIGZpcnN0IGFjdGl2ZSBpdGVtCgogICAgICB0aGlzLiRyZWZzLm1lbnUuZ2V0VGlsZXMoKTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWVudS50aWxlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmIChtZW51LnRpbGVzW2ldLmdldEF0dHJpYnV0ZSgnYXJpYS1zZWxlY3RlZCcpID09PSAndHJ1ZScpIHsKICAgICAgICAgIHRoaXMuc2V0TWVudUluZGV4KGkpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgb25Nb3VzZVVwOiBmdW5jdGlvbiBvbk1vdXNlVXAoZSkgewogICAgICB2YXIgX3RoaXMxMiA9IHRoaXM7CgogICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgc29uYXJqcy9uby1jb2xsYXBzaWJsZS1pZgogICAgICBpZiAodGhpcy5oYXNNb3VzZURvd24gJiYgZS53aGljaCAhPT0gMyAmJiB0aGlzLmlzSW50ZXJhY3RpdmUpIHsKICAgICAgICAvLyBJZiBhcHBlbmQgaW5uZXIgaXMgcHJlc2VudAogICAgICAgIC8vIGFuZCB0aGUgdGFyZ2V0IGlzIGl0c2VsZgogICAgICAgIC8vIG9yIGluc2lkZSwgdG9nZ2xlIG1lbnUKICAgICAgICBpZiAodGhpcy5pc0FwcGVuZElubmVyKGUudGFyZ2V0KSkgewogICAgICAgICAgdGhpcy4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gX3RoaXMxMi5pc01lbnVBY3RpdmUgPSAhX3RoaXMxMi5pc01lbnVBY3RpdmU7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIFZUZXh0RmllbGQub3B0aW9ucy5tZXRob2RzLm9uTW91c2VVcC5jYWxsKHRoaXMsIGUpOwogICAgfSwKICAgIG9uU2Nyb2xsOiBmdW5jdGlvbiBvblNjcm9sbCgpIHsKICAgICAgdmFyIF90aGlzMTMgPSB0aGlzOwoKICAgICAgaWYgKCF0aGlzLmlzTWVudUFjdGl2ZSkgewogICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gX3RoaXMxMy5nZXRDb250ZW50KCkuc2Nyb2xsVG9wID0gMDsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAodGhpcy5sYXN0SXRlbSA+IHRoaXMuY29tcHV0ZWRJdGVtcy5sZW5ndGgpIHJldHVybjsKICAgICAgICB2YXIgc2hvd01vcmVJdGVtcyA9IHRoaXMuZ2V0Q29udGVudCgpLnNjcm9sbEhlaWdodCAtICh0aGlzLmdldENvbnRlbnQoKS5zY3JvbGxUb3AgKyB0aGlzLmdldENvbnRlbnQoKS5jbGllbnRIZWlnaHQpIDwgMjAwOwoKICAgICAgICBpZiAoc2hvd01vcmVJdGVtcykgewogICAgICAgICAgdGhpcy5sYXN0SXRlbSArPSAyMDsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBvblNwYWNlRG93bjogZnVuY3Rpb24gb25TcGFjZURvd24oZSkgewogICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICB9LAogICAgb25UYWJEb3duOiBmdW5jdGlvbiBvblRhYkRvd24oZSkgewogICAgICB2YXIgbWVudSA9IHRoaXMuJHJlZnMubWVudTsKICAgICAgaWYgKCFtZW51KSByZXR1cm47CiAgICAgIHZhciBhY3RpdmVUaWxlID0gbWVudS5hY3RpdmVUaWxlOyAvLyBBbiBpdGVtIHRoYXQgaXMgc2VsZWN0ZWQgYnkKICAgICAgLy8gbWVudS1pbmRleCBzaG91bGQgdG9nZ2xlZAoKICAgICAgaWYgKCF0aGlzLm11bHRpcGxlICYmIGFjdGl2ZVRpbGUgJiYgdGhpcy5pc01lbnVBY3RpdmUpIHsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICBhY3RpdmVUaWxlLmNsaWNrKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gSWYgd2UgbWFrZSBpdCBoZXJlLAogICAgICAgIC8vIHRoZSB1c2VyIGhhcyBubyBzZWxlY3RlZCBpbmRleGVzCiAgICAgICAgLy8gYW5kIGlzIHByb2JhYmx5IHRhYmJpbmcgb3V0CiAgICAgICAgdGhpcy5ibHVyKGUpOwogICAgICB9CiAgICB9LAogICAgb25VcERvd246IGZ1bmN0aW9uIG9uVXBEb3duKGUpIHsKICAgICAgdmFyIF90aGlzMTQgPSB0aGlzOwoKICAgICAgdmFyIG1lbnUgPSB0aGlzLiRyZWZzLm1lbnU7CiAgICAgIGlmICghbWVudSkgcmV0dXJuOwogICAgICBlLnByZXZlbnREZWZhdWx0KCk7IC8vIE11bHRpcGxlIHNlbGVjdHMgZG8gbm90IGN5Y2xlIHRoZWlyIHZhbHVlCiAgICAgIC8vIHdoZW4gcHJlc3NpbmcgdXAgb3IgZG93biwgaW5zdGVhZCBhY3RpdmF0ZQogICAgICAvLyB0aGUgbWVudQoKICAgICAgaWYgKHRoaXMubXVsdGlwbGUpIHJldHVybiB0aGlzLmFjdGl2YXRlTWVudSgpOwogICAgICB2YXIga2V5Q29kZSA9IGUua2V5Q29kZTsgLy8gQ3ljbGUgdGhyb3VnaCBhdmFpbGFibGUgdmFsdWVzIHRvIGFjaGlldmUKICAgICAgLy8gc2VsZWN0IG5hdGl2ZSBiZWhhdmlvcgoKICAgICAgbWVudS5pc0Jvb3RlZCA9IHRydWU7CiAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gKCkgewogICAgICAgIG1lbnUuZ2V0VGlsZXMoKTsKICAgICAgICBpZiAoIW1lbnUuaGFzQ2xpY2thYmxlVGlsZXMpIHJldHVybiBfdGhpczE0LmFjdGl2YXRlTWVudSgpOwoKICAgICAgICBzd2l0Y2ggKGtleUNvZGUpIHsKICAgICAgICAgIGNhc2Uga2V5Q29kZXMudXA6CiAgICAgICAgICAgIG1lbnUucHJldlRpbGUoKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSBrZXlDb2Rlcy5kb3duOgogICAgICAgICAgICBtZW51Lm5leHRUaWxlKCk7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2Uga2V5Q29kZXMuaG9tZToKICAgICAgICAgICAgbWVudS5maXJzdFRpbGUoKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSBrZXlDb2Rlcy5lbmQ6CiAgICAgICAgICAgIG1lbnUubGFzdFRpbGUoKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBfdGhpczE0LnNlbGVjdEl0ZW0oX3RoaXMxNC5hbGxJdGVtc1tfdGhpczE0LmdldE1lbnVJbmRleCgpXSk7CiAgICAgIH0pOwogICAgfSwKICAgIHNlbGVjdEl0ZW06IGZ1bmN0aW9uIHNlbGVjdEl0ZW0oaXRlbSkgewogICAgICB2YXIgX3RoaXMxNSA9IHRoaXM7CgogICAgICBpZiAoIXRoaXMubXVsdGlwbGUpIHsKICAgICAgICB0aGlzLnNldFZhbHVlKHRoaXMucmV0dXJuT2JqZWN0ID8gaXRlbSA6IHRoaXMuZ2V0VmFsdWUoaXRlbSkpOwogICAgICAgIHRoaXMuaXNNZW51QWN0aXZlID0gZmFsc2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIGludGVybmFsVmFsdWUgPSAodGhpcy5pbnRlcm5hbFZhbHVlIHx8IFtdKS5zbGljZSgpOwogICAgICAgIHZhciBpID0gdGhpcy5maW5kRXhpc3RpbmdJbmRleChpdGVtKTsKICAgICAgICBpICE9PSAtMSA/IGludGVybmFsVmFsdWUuc3BsaWNlKGksIDEpIDogaW50ZXJuYWxWYWx1ZS5wdXNoKGl0ZW0pOwogICAgICAgIHRoaXMuc2V0VmFsdWUoaW50ZXJuYWxWYWx1ZS5tYXAoZnVuY3Rpb24gKGkpIHsKICAgICAgICAgIHJldHVybiBfdGhpczE1LnJldHVybk9iamVjdCA/IGkgOiBfdGhpczE1LmdldFZhbHVlKGkpOwogICAgICAgIH0pKTsgLy8gV2hlbiBzZWxlY3RpbmcgbXVsdGlwbGUKICAgICAgICAvLyBhZGp1c3QgbWVudSBhZnRlciBlYWNoCiAgICAgICAgLy8gc2VsZWN0aW9uCgogICAgICAgIHRoaXMuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzMTUuJHJlZnMubWVudSAmJiBfdGhpczE1LiRyZWZzLm1lbnUudXBkYXRlRGltZW5zaW9ucygpOwogICAgICAgIH0pOyAvLyBUaGVyZSBpcyBubyBpdGVtIHRvIHJlLWhpZ2hsaWdodAogICAgICAgIC8vIHdoZW4gc2VsZWN0aW9ucyBhcmUgaGlkZGVuCgogICAgICAgIGlmICh0aGlzLmhpZGVTZWxlY3RlZCkgewogICAgICAgICAgdGhpcy5zZXRNZW51SW5kZXgoLTEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgaW5kZXggPSB0aGlzLmFsbEl0ZW1zLmluZGV4T2YoaXRlbSk7CgogICAgICAgICAgaWYgKH5pbmRleCkgewogICAgICAgICAgICB0aGlzLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMTUuJHJlZnMubWVudS5nZXRUaWxlcygpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMTUuc2V0TWVudUluZGV4KGluZGV4KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc2V0TWVudUluZGV4OiBmdW5jdGlvbiBzZXRNZW51SW5kZXgoaW5kZXgpIHsKICAgICAgdGhpcy4kcmVmcy5tZW51ICYmICh0aGlzLiRyZWZzLm1lbnUubGlzdEluZGV4ID0gaW5kZXgpOwogICAgfSwKICAgIHNldFNlbGVjdGVkSXRlbXM6IGZ1bmN0aW9uIHNldFNlbGVjdGVkSXRlbXMoKSB7CiAgICAgIHZhciBfdGhpczE2ID0gdGhpczsKCiAgICAgIHZhciBzZWxlY3RlZEl0ZW1zID0gW107CiAgICAgIHZhciB2YWx1ZXMgPSAhdGhpcy5tdWx0aXBsZSB8fCAhQXJyYXkuaXNBcnJheSh0aGlzLmludGVybmFsVmFsdWUpID8gW3RoaXMuaW50ZXJuYWxWYWx1ZV0gOiB0aGlzLmludGVybmFsVmFsdWU7CgogICAgICB2YXIgX2l0ZXJhdG9yID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIodmFsdWVzKSwKICAgICAgICAgIF9zdGVwOwoKICAgICAgdHJ5IHsKICAgICAgICB2YXIgX2xvb3AgPSBmdW5jdGlvbiBfbG9vcCgpIHsKICAgICAgICAgIHZhciB2YWx1ZSA9IF9zdGVwLnZhbHVlOwoKICAgICAgICAgIHZhciBpbmRleCA9IF90aGlzMTYuYWxsSXRlbXMuZmluZEluZGV4KGZ1bmN0aW9uICh2KSB7CiAgICAgICAgICAgIHJldHVybiBfdGhpczE2LnZhbHVlQ29tcGFyYXRvcihfdGhpczE2LmdldFZhbHVlKHYpLCBfdGhpczE2LmdldFZhbHVlKHZhbHVlKSk7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAoaW5kZXggPiAtMSkgewogICAgICAgICAgICBzZWxlY3RlZEl0ZW1zLnB1c2goX3RoaXMxNi5hbGxJdGVtc1tpbmRleF0pOwogICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIGZvciAoX2l0ZXJhdG9yLnMoKTsgIShfc3RlcCA9IF9pdGVyYXRvci5uKCkpLmRvbmU7KSB7CiAgICAgICAgICBfbG9vcCgpOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2l0ZXJhdG9yLmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3IuZigpOwogICAgICB9CgogICAgICB0aGlzLnNlbGVjdGVkSXRlbXMgPSBzZWxlY3RlZEl0ZW1zOwogICAgfSwKICAgIHNldFZhbHVlOiBmdW5jdGlvbiBzZXRWYWx1ZSh2YWx1ZSkgewogICAgICBpZiAoIXRoaXMudmFsdWVDb21wYXJhdG9yKHZhbHVlLCB0aGlzLmludGVybmFsVmFsdWUpKSB7CiAgICAgICAgdGhpcy5pbnRlcm5hbFZhbHVlID0gdmFsdWU7CiAgICAgICAgdGhpcy4kZW1pdCgnY2hhbmdlJywgdmFsdWUpOwogICAgICB9CiAgICB9LAogICAgaXNBcHBlbmRJbm5lcjogZnVuY3Rpb24gaXNBcHBlbmRJbm5lcih0YXJnZXQpIHsKICAgICAgLy8gcmV0dXJuIHRydWUgaWYgYXBwZW5kIGlubmVyIGlzIHByZXNlbnQKICAgICAgLy8gYW5kIHRoZSB0YXJnZXQgaXMgaXRzZWxmIG9yIGluc2lkZQogICAgICB2YXIgYXBwZW5kSW5uZXIgPSB0aGlzLiRyZWZzWydhcHBlbmQtaW5uZXInXTsKICAgICAgcmV0dXJuIGFwcGVuZElubmVyICYmIChhcHBlbmRJbm5lciA9PT0gdGFyZ2V0IHx8IGFwcGVuZElubmVyLmNvbnRhaW5zKHRhcmdldCkpOwogICAgfQogIH0KfSk7"},null]}
{"remainingRequest":"/Users/qiushunqun/Desktop/射箭專案/GitHub/17soooo/17soooo/node_modules/babel-loader/lib/index.js!/Users/qiushunqun/Desktop/射箭專案/GitHub/17soooo/17soooo/node_modules/eslint-loader/index.js??ref--13-0!/Users/qiushunqun/Desktop/射箭專案/GitHub/17soooo/17soooo/src/utils/container/container.js","dependencies":[{"path":"/Users/qiushunqun/Desktop/射箭專案/GitHub/17soooo/17soooo/src/utils/container/container.js","mtime":1634663364000},{"path":"/Users/qiushunqun/Desktop/射箭專案/GitHub/17soooo/17soooo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/qiushunqun/Desktop/射箭專案/GitHub/17soooo/17soooo/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/qiushunqun/Desktop/射箭專案/GitHub/17soooo/17soooo/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5yZWR1Y2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIuY29uc3RydWN0b3IiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIubWF4LXNhZmUtaW50ZWdlciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci5taW4tc2FmZS1pbnRlZ2VyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaCI7CmltcG9ydCB7IGFuaW1hdGlvbkNsYXNzLCBjb250YWluZXJDbGFzcywgY29udGFpbmVySW5zdGFuY2UsIGRyb3BQbGFjZWhvbGRlckZsZXhDb250YWluZXJDbGFzcywgZHJvcFBsYWNlaG9sZGVySW5uZXJDbGFzcywgZHJvcFBsYWNlaG9sZGVyV3JhcHBlckNsYXNzLCBzdHJldGNoZXJFbGVtZW50Q2xhc3MsIHN0cmV0Y2hlckVsZW1lbnRJbnN0YW5jZSwgdHJhbnNsYXRpb25WYWx1ZSwgd3JhcHBlckNsYXNzLCBkcm9wUGxhY2Vob2xkZXJEZWZhdWx0Q2xhc3MgfSBmcm9tICcuL2NvbnN0YW50cyc7CmltcG9ydCB7IGRlZmF1bHRPcHRpb25zIH0gZnJvbSAnLi9kZWZhdWx0cyc7CmltcG9ydCB7IGRvbURyb3BIYW5kbGVyIH0gZnJvbSAnLi9kcm9wSGFuZGxlcnMnOwppbXBvcnQgbGF5b3V0TWFuYWdlciBmcm9tICcuL2xheW91dE1hbmFnZXInOwppbXBvcnQgTWVkaWF0b3IgZnJvbSAnLi9tZWRpYXRvcic7CmltcG9ydCB7IGFkZENsYXNzLCBnZXRQYXJlbnQsIGdldFBhcmVudFJlbGV2YW50Q29udGFpbmVyRWxlbWVudCwgaGFzQ2xhc3MsIGxpc3RlblNjcm9sbFBhcmVudCwgcmVtb3ZlQ2xhc3MgfSBmcm9tICcuL3V0aWxzJzsKCmZ1bmN0aW9uIHNldEFuaW1hdGlvbihlbGVtZW50LCBhZGQpIHsKICB2YXIgYW5pbWF0aW9uRHVyYXRpb24gPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IGRlZmF1bHRPcHRpb25zLmFuaW1hdGlvbkR1cmF0aW9uOwoKICBpZiAoYWRkKSB7CiAgICBhZGRDbGFzcyhlbGVtZW50LCBhbmltYXRpb25DbGFzcyk7CiAgICBlbGVtZW50LnN0eWxlLnRyYW5zaXRpb25EdXJhdGlvbiA9IGFuaW1hdGlvbkR1cmF0aW9uICsgJ21zJzsKICB9IGVsc2UgewogICAgcmVtb3ZlQ2xhc3MoZWxlbWVudCwgYW5pbWF0aW9uQ2xhc3MpOwogICAgZWxlbWVudC5zdHlsZS5yZW1vdmVQcm9wZXJ0eSgndHJhbnNpdGlvbi1kdXJhdGlvbicpOwogIH0KfQoKZnVuY3Rpb24gaXNEcmFnUmVsZXZhbnQoX3JlZikgewogIHZhciBlbGVtZW50ID0gX3JlZi5lbGVtZW50LAogICAgICBnZXRPcHRpb25zID0gX3JlZi5nZXRPcHRpb25zOwogIHJldHVybiBmdW5jdGlvbiAoc291cmNlQ29udGFpbmVyLCBwYXlsb2FkKSB7CiAgICB2YXIgb3B0aW9ucyA9IGdldE9wdGlvbnMoKTsKCiAgICBpZiAob3B0aW9ucy5zaG91bGRBY2NlcHREcm9wKSB7CiAgICAgIHJldHVybiBvcHRpb25zLnNob3VsZEFjY2VwdERyb3Aoc291cmNlQ29udGFpbmVyLmdldE9wdGlvbnMoKSwgcGF5bG9hZCk7CiAgICB9CgogICAgdmFyIHNvdXJjZU9wdGlvbnMgPSBzb3VyY2VDb250YWluZXIuZ2V0T3B0aW9ucygpOwogICAgaWYgKG9wdGlvbnMuYmVoYXZpb3VyID09PSAnY29weScpIHJldHVybiBmYWxzZTsKICAgIHZhciBwYXJlbnRXcmFwcGVyID0gZ2V0UGFyZW50KGVsZW1lbnQsICcuJyArIHdyYXBwZXJDbGFzcyk7CgogICAgaWYgKHBhcmVudFdyYXBwZXIgPT09IHNvdXJjZUNvbnRhaW5lci5lbGVtZW50KSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBpZiAoc291cmNlQ29udGFpbmVyLmVsZW1lbnQgPT09IGVsZW1lbnQpIHJldHVybiB0cnVlOwoKICAgIGlmIChzb3VyY2VPcHRpb25zLmdyb3VwTmFtZSAmJiBzb3VyY2VPcHRpb25zLmdyb3VwTmFtZSA9PT0gb3B0aW9ucy5ncm91cE5hbWUpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcmV0dXJuIGZhbHNlOwogIH07Cn0KCmZ1bmN0aW9uIHdyYXBDaGlsZChjaGlsZCkgewogIGlmIChzbW9vdGhEbkQud3JhcENoaWxkKSB7CiAgICB2YXIgZGl2ID0gd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgZGl2LmNsYXNzTmFtZSA9ICIiLmNvbmNhdCh3cmFwcGVyQ2xhc3MpOwogICAgY2hpbGQucGFyZW50RWxlbWVudC5pbnNlcnRCZWZvcmUoZGl2LCBjaGlsZCk7CiAgICBkaXYuYXBwZW5kQ2hpbGQoY2hpbGQpOwogICAgcmV0dXJuIGRpdjsKICB9CgogIHJldHVybiBjaGlsZDsKfQoKZnVuY3Rpb24gd3JhcENoaWxkcmVuKGVsZW1lbnQpIHsKICB2YXIgZHJhZ2dhYmxlcyA9IFtdOwogIEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwoZWxlbWVudC5jaGlsZHJlbiwgZnVuY3Rpb24gKGNoaWxkKSB7CiAgICBpZiAoY2hpbGQubm9kZVR5cGUgPT09IE5vZGUuRUxFTUVOVF9OT0RFKSB7CiAgICAgIHZhciB3cmFwcGVyID0gY2hpbGQ7CgogICAgICBpZiAoIWhhc0NsYXNzKGNoaWxkLCB3cmFwcGVyQ2xhc3MpKSB7CiAgICAgICAgd3JhcHBlciA9IHdyYXBDaGlsZChjaGlsZCk7CiAgICAgIH0KCiAgICAgIHdyYXBwZXJbdHJhbnNsYXRpb25WYWx1ZV0gPSAwOwogICAgICBkcmFnZ2FibGVzLnB1c2god3JhcHBlcik7CiAgICB9IGVsc2UgewogICAgICBlbGVtZW50LnJlbW92ZUNoaWxkKGNoaWxkKTsKICAgIH0KICB9KTsKICByZXR1cm4gZHJhZ2dhYmxlczsKfQoKZnVuY3Rpb24gdW53cmFwQ2hpbGRyZW4oZWxlbWVudCkgewogIGlmIChzbW9vdGhEbkQud3JhcENoaWxkKSB7CiAgICBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKGVsZW1lbnQuY2hpbGRyZW4sIGZ1bmN0aW9uIChjaGlsZCkgewogICAgICBpZiAoY2hpbGQubm9kZVR5cGUgPT09IE5vZGUuRUxFTUVOVF9OT0RFKSB7CiAgICAgICAgaWYgKGhhc0NsYXNzKGNoaWxkLCB3cmFwcGVyQ2xhc3MpKSB7CiAgICAgICAgICBlbGVtZW50Lmluc2VydEJlZm9yZShjaGlsZC5maXJzdEVsZW1lbnRDaGlsZCwgY2hpbGQpOwogICAgICAgICAgZWxlbWVudC5yZW1vdmVDaGlsZChjaGlsZCk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICB9Cn0KCmZ1bmN0aW9uIGZpbmREcmFnZ2VibGVBdFBvcyhfcmVmMikgewogIHZhciBsYXlvdXQgPSBfcmVmMi5sYXlvdXQ7CgogIHZhciBmaW5kID0gZnVuY3Rpb24gZmluZChkcmFnZ2FibGVzLCBwb3MsIHN0YXJ0SW5kZXgsIGVuZEluZGV4KSB7CiAgICB2YXIgd2l0aFJlc3BlY3RUb01pZGRsZVBvaW50cyA9IGFyZ3VtZW50cy5sZW5ndGggPiA0ICYmIGFyZ3VtZW50c1s0XSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzRdIDogZmFsc2U7CgogICAgaWYgKGVuZEluZGV4IDwgc3RhcnRJbmRleCkgewogICAgICByZXR1cm4gc3RhcnRJbmRleDsKICAgIH0gLy8gYmluYXJ5IHNlcmFjaCBkcmFnZ2FibGUKCgogICAgaWYgKHN0YXJ0SW5kZXggPT09IGVuZEluZGV4KSB7CiAgICAgIHZhciBfbGF5b3V0JGdldEJlZ2luRW5kID0gbGF5b3V0LmdldEJlZ2luRW5kKGRyYWdnYWJsZXNbc3RhcnRJbmRleF0pLAogICAgICAgICAgYmVnaW4gPSBfbGF5b3V0JGdldEJlZ2luRW5kLmJlZ2luLAogICAgICAgICAgZW5kID0gX2xheW91dCRnZXRCZWdpbkVuZC5lbmQ7IC8vIG1vdXNlIHBvcyBpcyBpbnNpZGUgZHJhZ2dhYmxlCiAgICAgIC8vIG5vdyBkZWNpZGUgd2hpY2ggaW5kZXggdG8gcmV0dXJuCiAgICAgIC8vIGlmIChwb3MgPiBiZWdpbiAmJiBwb3MgPD0gZW5kKSB7CgoKICAgICAgaWYgKHdpdGhSZXNwZWN0VG9NaWRkbGVQb2ludHMpIHsKICAgICAgICByZXR1cm4gcG9zIDwgKGVuZCArIGJlZ2luKSAvIDIgPyBzdGFydEluZGV4IDogc3RhcnRJbmRleCArIDE7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHN0YXJ0SW5kZXg7CiAgICAgIH0gLy8gfSBlbHNlIHsKICAgICAgLy8gICByZXR1cm4gbnVsbDsKICAgICAgLy8gfQoKICAgIH0gZWxzZSB7CiAgICAgIHZhciBtaWRkbGVJbmRleCA9IE1hdGguZmxvb3IoKGVuZEluZGV4ICsgc3RhcnRJbmRleCkgLyAyKTsKCiAgICAgIHZhciBfbGF5b3V0JGdldEJlZ2luRW5kMiA9IGxheW91dC5nZXRCZWdpbkVuZChkcmFnZ2FibGVzW21pZGRsZUluZGV4XSksCiAgICAgICAgICBfYmVnaW4gPSBfbGF5b3V0JGdldEJlZ2luRW5kMi5iZWdpbiwKICAgICAgICAgIF9lbmQgPSBfbGF5b3V0JGdldEJlZ2luRW5kMi5lbmQ7CgogICAgICBpZiAocG9zIDwgX2JlZ2luKSB7CiAgICAgICAgcmV0dXJuIGZpbmQoZHJhZ2dhYmxlcywgcG9zLCBzdGFydEluZGV4LCBtaWRkbGVJbmRleCAtIDEsIHdpdGhSZXNwZWN0VG9NaWRkbGVQb2ludHMpOwogICAgICB9IGVsc2UgaWYgKHBvcyA+IF9lbmQpIHsKICAgICAgICByZXR1cm4gZmluZChkcmFnZ2FibGVzLCBwb3MsIG1pZGRsZUluZGV4ICsgMSwgZW5kSW5kZXgsIHdpdGhSZXNwZWN0VG9NaWRkbGVQb2ludHMpOwogICAgICB9IGVsc2UgewogICAgICAgIGlmICh3aXRoUmVzcGVjdFRvTWlkZGxlUG9pbnRzKSB7CiAgICAgICAgICByZXR1cm4gcG9zIDwgKF9lbmQgKyBfYmVnaW4pIC8gMiA/IG1pZGRsZUluZGV4IDogbWlkZGxlSW5kZXggKyAxOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gbWlkZGxlSW5kZXg7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKCiAgcmV0dXJuIGZ1bmN0aW9uIChkcmFnZ2FibGVzLCBwb3MpIHsKICAgIHZhciB3aXRoUmVzcGVjdFRvTWlkZGxlUG9pbnRzID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiBmYWxzZTsKICAgIHJldHVybiBmaW5kKGRyYWdnYWJsZXMsIHBvcywgMCwgZHJhZ2dhYmxlcy5sZW5ndGggLSAxLCB3aXRoUmVzcGVjdFRvTWlkZGxlUG9pbnRzKTsKICB9Owp9CgpmdW5jdGlvbiByZXNldERyYWdnYWJsZXMoX3JlZjMpIHsKICB2YXIgZWxlbWVudCA9IF9yZWYzLmVsZW1lbnQsCiAgICAgIGRyYWdnYWJsZXMgPSBfcmVmMy5kcmFnZ2FibGVzLAogICAgICBsYXlvdXQgPSBfcmVmMy5sYXlvdXQ7CiAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgIGRyYWdnYWJsZXMuZm9yRWFjaChmdW5jdGlvbiAocCkgewogICAgICBzZXRBbmltYXRpb24ocCwgZmFsc2UpOwogICAgICBsYXlvdXQuc2V0VHJhbnNsYXRpb24ocCwgMCk7CiAgICAgIGxheW91dC5zZXRWaXNpYmlsaXR5KHAsIHRydWUpOwogICAgfSk7CgogICAgaWYgKGVsZW1lbnRbc3RyZXRjaGVyRWxlbWVudEluc3RhbmNlXSkgewogICAgICBlbGVtZW50W3N0cmV0Y2hlckVsZW1lbnRJbnN0YW5jZV0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbGVtZW50W3N0cmV0Y2hlckVsZW1lbnRJbnN0YW5jZV0pOwogICAgICBlbGVtZW50W3N0cmV0Y2hlckVsZW1lbnRJbnN0YW5jZV0gPSBudWxsOwogICAgfQogIH07Cn0KCmZ1bmN0aW9uIHNldFRhcmdldENvbnRhaW5lcihkcmFnZ2FibGVJbmZvLCBlbGVtZW50KSB7CiAgdmFyIHNldCA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogdHJ1ZTsKCiAgaWYgKGVsZW1lbnQgJiYgc2V0KSB7CiAgICBkcmFnZ2FibGVJbmZvLnRhcmdldEVsZW1lbnQgPSBlbGVtZW50OwogIH0gZWxzZSB7CiAgICBpZiAoZHJhZ2dhYmxlSW5mby50YXJnZXRFbGVtZW50ID09PSBlbGVtZW50KSB7CiAgICAgIGRyYWdnYWJsZUluZm8udGFyZ2V0RWxlbWVudCA9IG51bGw7CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBoYW5kbGVEcm9wKF9yZWY0KSB7CiAgdmFyIGVsZW1lbnQgPSBfcmVmNC5lbGVtZW50LAogICAgICBkcmFnZ2FibGVzID0gX3JlZjQuZHJhZ2dhYmxlcywKICAgICAgbGF5b3V0ID0gX3JlZjQubGF5b3V0LAogICAgICBnZXRPcHRpb25zID0gX3JlZjQuZ2V0T3B0aW9uczsKICB2YXIgZHJhZ2dhYmxlc1Jlc2V0ID0gcmVzZXREcmFnZ2FibGVzKHsKICAgIGVsZW1lbnQ6IGVsZW1lbnQsCiAgICBkcmFnZ2FibGVzOiBkcmFnZ2FibGVzLAogICAgbGF5b3V0OiBsYXlvdXQsCiAgICBnZXRPcHRpb25zOiBnZXRPcHRpb25zCiAgfSk7CiAgdmFyIGRyb3BIYW5kbGVyID0gKHNtb290aERuRC5kcm9wSGFuZGxlciB8fCBkb21Ecm9wSGFuZGxlcikoewogICAgZWxlbWVudDogZWxlbWVudCwKICAgIGRyYWdnYWJsZXM6IGRyYWdnYWJsZXMsCiAgICBsYXlvdXQ6IGxheW91dCwKICAgIGdldE9wdGlvbnM6IGdldE9wdGlvbnMKICB9KTsKICByZXR1cm4gZnVuY3Rpb24gKGRyYWdnYWJsZUluZm8sIF9yZWY1KSB7CiAgICB2YXIgYWRkZWRJbmRleCA9IF9yZWY1LmFkZGVkSW5kZXgsCiAgICAgICAgcmVtb3ZlZEluZGV4ID0gX3JlZjUucmVtb3ZlZEluZGV4OwogICAgdmFyIGZvckRpc3Bvc2UgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IGZhbHNlOwogICAgZHJhZ2dhYmxlc1Jlc2V0KCk7IC8vIGlmIGRyb3Agem9uZSBpcyB2YWxpZCA9PiBjb21wbGV0ZSBkcmFnLCBlbHNlIGVtaXQgZHJvcE5vdEFsbG93ZWQgYW5kIGV2ZXJ5dGhpbmcgd2lsbCBiZSByZXZlcnRlZCBieSBkcmFnZ2FibGVzUmVzZXQoKQoKICAgIGlmIChkcmFnZ2FibGVJbmZvICYmICFkcmFnZ2FibGVJbmZvLmNhbmNlbERyb3ApIHsKICAgICAgaWYgKGRyYWdnYWJsZUluZm8udGFyZ2V0RWxlbWVudCB8fCBnZXRPcHRpb25zKCkucmVtb3ZlT25Ecm9wT3V0IHx8IGZvckRpc3Bvc2UpIHsKICAgICAgICB2YXIgaW5kZXhOb3ROdWxsID0gZnVuY3Rpb24gaW5kZXhOb3ROdWxsKGluZGV4KSB7CiAgICAgICAgICByZXR1cm4gaW5kZXggIT09IG51bGw7CiAgICAgICAgfTsKCiAgICAgICAgdmFyIGFjdHVhbEFkZEluZGV4ID0gaW5kZXhOb3ROdWxsKGFkZGVkSW5kZXgpID8gaW5kZXhOb3ROdWxsKHJlbW92ZWRJbmRleCkgJiYgcmVtb3ZlZEluZGV4IDwgYWRkZWRJbmRleCA/IGFkZGVkSW5kZXggLSAxIDogYWRkZWRJbmRleCA6IG51bGw7CiAgICAgICAgdmFyIGRyb3BIYW5kbGVyUGFyYW1zID0gewogICAgICAgICAgcmVtb3ZlZEluZGV4OiByZW1vdmVkSW5kZXgsCiAgICAgICAgICBhZGRlZEluZGV4OiBhY3R1YWxBZGRJbmRleCwKICAgICAgICAgIHBheWxvYWQ6IGRyYWdnYWJsZUluZm8ucGF5bG9hZCAvLyBkcm9wcGVkRWxlbWVudDogZHJhZ2dhYmxlSW5mby5lbGVtZW50LmZpcnN0RWxlbWVudENoaWxkLAoKICAgICAgICB9OwogICAgICAgIHZhciBzaG91bGRIYW5kbGVEcm9wID0gIWRyYWdnYWJsZUluZm8uY29udGFpbmVyLmdldE9wdGlvbnMoKS5maXJlUmVsYXRlZEV2ZW50c09ubHkgfHwgaW5kZXhOb3ROdWxsKHJlbW92ZWRJbmRleCkgfHwgaW5kZXhOb3ROdWxsKGFjdHVhbEFkZEluZGV4KTsKCiAgICAgICAgaWYgKHNob3VsZEhhbmRsZURyb3ApIHsKICAgICAgICAgIGRyb3BIYW5kbGVyKGRyb3BIYW5kbGVyUGFyYW1zLCBnZXRPcHRpb25zKCkub25Ecm9wKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoZ2V0T3B0aW9ucygpLmRyb3BOb3RBbGxvd2VkKSB7CiAgICAgICAgdmFyIHBheWxvYWQgPSBkcmFnZ2FibGVJbmZvLnBheWxvYWQsCiAgICAgICAgICAgIGNvbnRhaW5lciA9IGRyYWdnYWJsZUluZm8uY29udGFpbmVyOwogICAgICAgIHJldHVybiBnZXRPcHRpb25zKCkuZHJvcE5vdEFsbG93ZWQoewogICAgICAgICAgcGF5bG9hZDogcGF5bG9hZCwKICAgICAgICAgIGNvbnRhaW5lcjogY29udGFpbmVyCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9Owp9CgpmdW5jdGlvbiBnZXRDb250YWluZXJQcm9wcyhlbGVtZW50LCBnZXRPcHRpb25zKSB7CiAgdmFyIGRyYWdnYWJsZXMgPSB3cmFwQ2hpbGRyZW4oZWxlbWVudCk7CiAgdmFyIG9wdGlvbnMgPSBnZXRPcHRpb25zKCk7IC8vIHNldCBmbGV4IGNsYXNzZXMgYmVmb3JlIGxheW91dCBpcyBpbml0ZWQgZm9yIHNjcm9sbCBsaXN0ZW5lcgoKICBhZGRDbGFzcyhlbGVtZW50LCAiIi5jb25jYXQoY29udGFpbmVyQ2xhc3MsICIgIikuY29uY2F0KG9wdGlvbnMub3JpZW50YXRpb24pKTsKICB2YXIgbGF5b3V0ID0gbGF5b3V0TWFuYWdlcihlbGVtZW50LCBvcHRpb25zLm9yaWVudGF0aW9uLCBvcHRpb25zLmFuaW1hdGlvbkR1cmF0aW9uKTsKICByZXR1cm4gewogICAgZWxlbWVudDogZWxlbWVudCwKICAgIGRyYWdnYWJsZXM6IGRyYWdnYWJsZXMsCiAgICBnZXRPcHRpb25zOiBnZXRPcHRpb25zLAogICAgbGF5b3V0OiBsYXlvdXQKICB9Owp9CgpmdW5jdGlvbiBnZXRSZW1vdmVkSXRlbShfcmVmNikgewogIHZhciBlbGVtZW50ID0gX3JlZjYuZWxlbWVudCwKICAgICAgZ2V0T3B0aW9ucyA9IF9yZWY2LmdldE9wdGlvbnM7CiAgdmFyIHByZXZSZW1vdmVkSW5kZXggPSBudWxsOwogIHJldHVybiBmdW5jdGlvbiAoX3JlZjcpIHsKICAgIHZhciBkcmFnZ2FibGVJbmZvID0gX3JlZjcuZHJhZ2dhYmxlSW5mbzsKICAgIHZhciByZW1vdmVkSW5kZXggPSBwcmV2UmVtb3ZlZEluZGV4OwoKICAgIGlmIChwcmV2UmVtb3ZlZEluZGV4ID09IG51bGwgJiYgZHJhZ2dhYmxlSW5mby5jb250YWluZXIuZWxlbWVudCA9PT0gZWxlbWVudCAmJiBnZXRPcHRpb25zKCkuYmVoYXZpb3VyICE9PSAnY29weScpIHsKICAgICAgcmVtb3ZlZEluZGV4ID0gcHJldlJlbW92ZWRJbmRleCA9IGRyYWdnYWJsZUluZm8uZWxlbWVudEluZGV4OwogICAgfQoKICAgIHJldHVybiB7CiAgICAgIHJlbW92ZWRJbmRleDogcmVtb3ZlZEluZGV4CiAgICB9OwogIH07Cn0KCmZ1bmN0aW9uIHNldFJlbW92ZWRJdGVtVmlzaWJpbHR5KF9yZWY4KSB7CiAgdmFyIGRyYWdnYWJsZXMgPSBfcmVmOC5kcmFnZ2FibGVzLAogICAgICBsYXlvdXQgPSBfcmVmOC5sYXlvdXQ7CiAgcmV0dXJuIGZ1bmN0aW9uIChfcmVmOSkgewogICAgdmFyIGRyYWdSZXN1bHQgPSBfcmVmOS5kcmFnUmVzdWx0OwoKICAgIGlmIChkcmFnUmVzdWx0LnJlbW92ZWRJbmRleCAhPT0gbnVsbCkgewogICAgICBsYXlvdXQuc2V0VmlzaWJpbGl0eShkcmFnZ2FibGVzW2RyYWdSZXN1bHQucmVtb3ZlZEluZGV4XSwgZmFsc2UpOwogICAgfQogIH07Cn0KCmZ1bmN0aW9uIGdldFBvc2l0aW9uKF9yZWYxMCkgewogIHZhciBlbGVtZW50ID0gX3JlZjEwLmVsZW1lbnQsCiAgICAgIGxheW91dCA9IF9yZWYxMC5sYXlvdXQ7CiAgcmV0dXJuIGZ1bmN0aW9uIChfcmVmMTEpIHsKICAgIHZhciBkcmFnZ2FibGVJbmZvID0gX3JlZjExLmRyYWdnYWJsZUluZm87CiAgICB2YXIgaGl0RWxlbWVudCA9IGRvY3VtZW50LmVsZW1lbnRGcm9tUG9pbnQoZHJhZ2dhYmxlSW5mby5wb3NpdGlvbi54LCBkcmFnZ2FibGVJbmZvLnBvc2l0aW9uLnkpOyAvLyBUT0RPOiBpZiBjZW50ZXIgaXMgb3V0IG9mIGJvdW5kcyB1c2UgbW91c2UgcG9zaXRpb24gZm9yIGhpdHRlc3QKICAgIC8vIGlmICghaGl0RWxlbWVudCkgewogICAgLy8gICBoaXRFbGVtZW50ID0gZG9jdW1lbnQuZWxlbWVudEZyb21Qb2ludChkcmFnZ2FibGVJbmZvLm1vdXNlUG9zaXRpb24ueCwgZHJhZ2dhYmxlSW5mby5tb3VzZVBvc2l0aW9uLnkpOwogICAgLy8gfQoKICAgIGlmIChoaXRFbGVtZW50KSB7CiAgICAgIHZhciBjb250YWluZXIgPSBnZXRQYXJlbnRSZWxldmFudENvbnRhaW5lckVsZW1lbnQoaGl0RWxlbWVudCwgZHJhZ2dhYmxlSW5mby5yZWxldmFudENvbnRhaW5lcnMpOwoKICAgICAgaWYgKGNvbnRhaW5lciAmJiBjb250YWluZXIuZWxlbWVudCA9PT0gZWxlbWVudCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBwb3M6IGxheW91dC5nZXRQb3NpdGlvbihkcmFnZ2FibGVJbmZvLnBvc2l0aW9uKQogICAgICAgIH07CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gewogICAgICBwb3M6IG51bGwKICAgIH07CiAgfTsKfQoKZnVuY3Rpb24gZ2V0RWxlbWVudFNpemUoX3JlZjEyKSB7CiAgdmFyIGxheW91dCA9IF9yZWYxMi5sYXlvdXQ7CiAgdmFyIGVsZW1lbnRTaXplID0gbnVsbDsKICByZXR1cm4gZnVuY3Rpb24gKF9yZWYxMykgewogICAgdmFyIGRyYWdnYWJsZUluZm8gPSBfcmVmMTMuZHJhZ2dhYmxlSW5mbywKICAgICAgICBkcmFnUmVzdWx0ID0gX3JlZjEzLmRyYWdSZXN1bHQ7CgogICAgaWYgKGRyYWdSZXN1bHQucG9zID09PSBudWxsKSB7CiAgICAgIHJldHVybiBlbGVtZW50U2l6ZSA9IG51bGw7CiAgICB9IGVsc2UgewogICAgICBlbGVtZW50U2l6ZSA9IGVsZW1lbnRTaXplIHx8IGxheW91dC5nZXRTaXplKGRyYWdnYWJsZUluZm8uc2l6ZSk7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgZWxlbWVudFNpemU6IGVsZW1lbnRTaXplCiAgICB9OwogIH07Cn0KCmZ1bmN0aW9uIGhhbmRsZVRhcmdldENvbnRhaW5lcihfcmVmMTQpIHsKICB2YXIgZWxlbWVudCA9IF9yZWYxNC5lbGVtZW50OwogIHJldHVybiBmdW5jdGlvbiAoX3JlZjE1KSB7CiAgICB2YXIgZHJhZ2dhYmxlSW5mbyA9IF9yZWYxNS5kcmFnZ2FibGVJbmZvLAogICAgICAgIGRyYWdSZXN1bHQgPSBfcmVmMTUuZHJhZ1Jlc3VsdDsKICAgIHNldFRhcmdldENvbnRhaW5lcihkcmFnZ2FibGVJbmZvLCBlbGVtZW50LCAhIWRyYWdSZXN1bHQucG9zKTsKICB9Owp9CgpmdW5jdGlvbiBnZXREcmFnSW5zZXJ0aW9uSW5kZXgoX3JlZjE2KSB7CiAgdmFyIGRyYWdnYWJsZXMgPSBfcmVmMTYuZHJhZ2dhYmxlcywKICAgICAgbGF5b3V0ID0gX3JlZjE2LmxheW91dDsKICB2YXIgZmluZERyYWdnYWJsZSA9IGZpbmREcmFnZ2VibGVBdFBvcyh7CiAgICBsYXlvdXQ6IGxheW91dAogIH0pOwogIHJldHVybiBmdW5jdGlvbiAoX3JlZjE3KSB7CiAgICB2YXIgX3JlZjE3JGRyYWdSZXN1bHQgPSBfcmVmMTcuZHJhZ1Jlc3VsdCwKICAgICAgICBzaGFkb3dCZWdpbkVuZCA9IF9yZWYxNyRkcmFnUmVzdWx0LnNoYWRvd0JlZ2luRW5kLAogICAgICAgIHBvcyA9IF9yZWYxNyRkcmFnUmVzdWx0LnBvczsKCiAgICBpZiAoIXNoYWRvd0JlZ2luRW5kKSB7CiAgICAgIHZhciBpbmRleCA9IGZpbmREcmFnZ2FibGUoZHJhZ2dhYmxlcywgcG9zLCB0cnVlKTsKICAgICAgcmV0dXJuIGluZGV4ICE9PSBudWxsID8gaW5kZXggOiBkcmFnZ2FibGVzLmxlbmd0aDsKICAgIH0gZWxzZSB7CiAgICAgIGlmIChzaGFkb3dCZWdpbkVuZC5iZWdpbiArIHNoYWRvd0JlZ2luRW5kLmJlZ2luQWRqdXN0bWVudCA8PSBwb3MgJiYgc2hhZG93QmVnaW5FbmQuZW5kID49IHBvcykgewogICAgICAgIC8vIHBvc2l0aW9uIGluc2lkZSBnaG9zdAogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9CgogICAgaWYgKHBvcyA8IHNoYWRvd0JlZ2luRW5kLmJlZ2luICsgc2hhZG93QmVnaW5FbmQuYmVnaW5BZGp1c3RtZW50KSB7CiAgICAgIHJldHVybiBmaW5kRHJhZ2dhYmxlKGRyYWdnYWJsZXMsIHBvcyk7CiAgICB9IGVsc2UgaWYgKHBvcyA+IHNoYWRvd0JlZ2luRW5kLmVuZCkgewogICAgICByZXR1cm4gZmluZERyYWdnYWJsZShkcmFnZ2FibGVzLCBwb3MpICsgMTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBkcmFnZ2FibGVzLmxlbmd0aDsKICAgIH0KICB9Owp9CgpmdW5jdGlvbiBnZXREcmFnSW5zZXJ0aW9uSW5kZXhGb3JEcm9wWm9uZSgpIHsKICByZXR1cm4gZnVuY3Rpb24gKF9yZWYxOCkgewogICAgdmFyIHBvcyA9IF9yZWYxOC5kcmFnUmVzdWx0LnBvczsKICAgIHJldHVybiBwb3MgIT09IG51bGwgPyB7CiAgICAgIGFkZGVkSW5kZXg6IDAKICAgIH0gOiB7CiAgICAgIGFkZGVkSW5kZXg6IG51bGwKICAgIH07CiAgfTsKfQoKZnVuY3Rpb24gZ2V0U2hhZG93QmVnaW5FbmRGb3JEcm9wWm9uZShfcmVmMTkpIHsKICB2YXIgbGF5b3V0ID0gX3JlZjE5LmxheW91dDsKICB2YXIgcHJldkFkZGVkSW5kZXggPSBudWxsOwogIHJldHVybiBmdW5jdGlvbiAoX3JlZjIwKSB7CiAgICB2YXIgYWRkZWRJbmRleCA9IF9yZWYyMC5kcmFnUmVzdWx0LmFkZGVkSW5kZXg7CgogICAgaWYgKGFkZGVkSW5kZXggIT09IHByZXZBZGRlZEluZGV4KSB7CiAgICAgIHByZXZBZGRlZEluZGV4ID0gYWRkZWRJbmRleDsKCiAgICAgIHZhciBfbGF5b3V0JGdldEJlZ2luRW5kT2YgPSBsYXlvdXQuZ2V0QmVnaW5FbmRPZkNvbnRhaW5lcigpLAogICAgICAgICAgYmVnaW4gPSBfbGF5b3V0JGdldEJlZ2luRW5kT2YuYmVnaW47CgogICAgICByZXR1cm4gewogICAgICAgIHNoYWRvd0JlZ2luRW5kOiB7CiAgICAgICAgICByZWN0OiBsYXlvdXQuZ2V0VG9wTGVmdE9mRWxlbWVudEJlZ2luKGJlZ2luKQogICAgICAgIH0KICAgICAgfTsKICAgIH0KCiAgICByZXR1cm4gbnVsbDsKICB9Owp9CgpmdW5jdGlvbiBkcmF3RHJvcFBsYWNlaG9sZGVyKF9yZWYyMSkgewogIHZhciBsYXlvdXQgPSBfcmVmMjEubGF5b3V0LAogICAgICBlbGVtZW50ID0gX3JlZjIxLmVsZW1lbnQsCiAgICAgIGdldE9wdGlvbnMgPSBfcmVmMjEuZ2V0T3B0aW9uczsKICB2YXIgcHJldkFkZGVkSW5kZXggPSBudWxsOwogIHJldHVybiBmdW5jdGlvbiAoX3JlZjIyKSB7CiAgICB2YXIgX3JlZjIyJGRyYWdSZXN1bHQgPSBfcmVmMjIuZHJhZ1Jlc3VsdCwKICAgICAgICBlbGVtZW50U2l6ZSA9IF9yZWYyMiRkcmFnUmVzdWx0LmVsZW1lbnRTaXplLAogICAgICAgIHNoYWRvd0JlZ2luRW5kID0gX3JlZjIyJGRyYWdSZXN1bHQuc2hhZG93QmVnaW5FbmQsCiAgICAgICAgYWRkZWRJbmRleCA9IF9yZWYyMiRkcmFnUmVzdWx0LmFkZGVkSW5kZXgsCiAgICAgICAgZHJvcFBsYWNlaG9sZGVyQ29udGFpbmVyID0gX3JlZjIyJGRyYWdSZXN1bHQuZHJvcFBsYWNlaG9sZGVyQ29udGFpbmVyOwogICAgdmFyIG9wdGlvbnMgPSBnZXRPcHRpb25zKCk7CgogICAgaWYgKG9wdGlvbnMuZHJvcFBsYWNlaG9sZGVyKSB7CiAgICAgIHZhciBfcmVmMjMgPSB0eXBlb2Ygb3B0aW9ucy5kcm9wUGxhY2Vob2xkZXIgPT09ICdib29sZWFuJyA/IHt9IDogb3B0aW9ucy5kcm9wUGxhY2Vob2xkZXIsCiAgICAgICAgICBhbmltYXRpb25EdXJhdGlvbiA9IF9yZWYyMy5hbmltYXRpb25EdXJhdGlvbiwKICAgICAgICAgIGNsYXNzTmFtZSA9IF9yZWYyMy5jbGFzc05hbWUsCiAgICAgICAgICBzaG93T25Ub3AgPSBfcmVmMjMuc2hvd09uVG9wOwoKICAgICAgaWYgKGFkZGVkSW5kZXggIT09IG51bGwpIHsKICAgICAgICBpZiAoIWRyb3BQbGFjZWhvbGRlckNvbnRhaW5lcikgewogICAgICAgICAgdmFyIGlubmVyRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgdmFyIGZsZXggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgIGZsZXguY2xhc3NOYW1lID0gZHJvcFBsYWNlaG9sZGVyRmxleENvbnRhaW5lckNsYXNzOwogICAgICAgICAgaW5uZXJFbGVtZW50LmNsYXNzTmFtZSA9ICIiLmNvbmNhdChkcm9wUGxhY2Vob2xkZXJJbm5lckNsYXNzLCAiICIpLmNvbmNhdChjbGFzc05hbWUgfHwgZHJvcFBsYWNlaG9sZGVyRGVmYXVsdENsYXNzKTsKICAgICAgICAgIGRyb3BQbGFjZWhvbGRlckNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgZHJvcFBsYWNlaG9sZGVyQ29udGFpbmVyLmNsYXNzTmFtZSA9ICIiLmNvbmNhdChkcm9wUGxhY2Vob2xkZXJXcmFwcGVyQ2xhc3MpOwogICAgICAgICAgZHJvcFBsYWNlaG9sZGVyQ29udGFpbmVyLnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJzsKCiAgICAgICAgICBpZiAoYW5pbWF0aW9uRHVyYXRpb24gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBkcm9wUGxhY2Vob2xkZXJDb250YWluZXIuc3R5bGUudHJhbnNpdGlvbiA9ICJhbGwgIi5jb25jYXQoYW5pbWF0aW9uRHVyYXRpb24sICJtcyBlYXNlIik7CiAgICAgICAgICB9CgogICAgICAgICAgZHJvcFBsYWNlaG9sZGVyQ29udGFpbmVyLmFwcGVuZENoaWxkKGZsZXgpOwogICAgICAgICAgZmxleC5hcHBlbmRDaGlsZChpbm5lckVsZW1lbnQpOwogICAgICAgICAgbGF5b3V0LnNldFNpemUoZHJvcFBsYWNlaG9sZGVyQ29udGFpbmVyLnN0eWxlLCBlbGVtZW50U2l6ZSArICdweCcpOwogICAgICAgICAgZHJvcFBsYWNlaG9sZGVyQ29udGFpbmVyLnN0eWxlLnBvaW50ZXJFdmVudHMgPSAnbm9uZSc7CgogICAgICAgICAgaWYgKHNob3dPblRvcCkgewogICAgICAgICAgICBlbGVtZW50LmFwcGVuZENoaWxkKGRyb3BQbGFjZWhvbGRlckNvbnRhaW5lcik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBlbGVtZW50Lmluc2VydEJlZm9yZShkcm9wUGxhY2Vob2xkZXJDb250YWluZXIsIGVsZW1lbnQuZmlyc3RFbGVtZW50Q2hpbGQpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHByZXZBZGRlZEluZGV4ICE9PSBhZGRlZEluZGV4ICYmIHNoYWRvd0JlZ2luRW5kLmRyb3BBcmVhKSB7CiAgICAgICAgICBsYXlvdXQuc2V0QmVnaW4oZHJvcFBsYWNlaG9sZGVyQ29udGFpbmVyLnN0eWxlLCBzaGFkb3dCZWdpbkVuZC5kcm9wQXJlYS5iZWdpbiAtIGxheW91dC5nZXRCZWdpbkVuZE9mQ29udGFpbmVyKCkuYmVnaW4gKyAncHgnKTsKICAgICAgICB9CgogICAgICAgIHByZXZBZGRlZEluZGV4ID0gYWRkZWRJbmRleDsKICAgICAgICByZXR1cm4gewogICAgICAgICAgZHJvcFBsYWNlaG9sZGVyQ29udGFpbmVyOiBkcm9wUGxhY2Vob2xkZXJDb250YWluZXIKICAgICAgICB9OwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChkcm9wUGxhY2Vob2xkZXJDb250YWluZXIgJiYgcHJldkFkZGVkSW5kZXggIT09IG51bGwpIHsKICAgICAgICAgIGVsZW1lbnQucmVtb3ZlQ2hpbGQoZHJvcFBsYWNlaG9sZGVyQ29udGFpbmVyKTsKICAgICAgICB9CgogICAgICAgIHByZXZBZGRlZEluZGV4ID0gbnVsbDsKICAgICAgICByZXR1cm4gewogICAgICAgICAgZHJvcFBsYWNlaG9sZGVyQ29udGFpbmVyOiB1bmRlZmluZWQKICAgICAgICB9OwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIG51bGw7CiAgfTsKfQoKZnVuY3Rpb24gaW52YWxpZGF0ZVNoYWRvd0JlZ2luRW5kSWZOZWVkZWQocGFyYW1zKSB7CiAgdmFyIHNoYWRvd0JvdW5kc0dldHRlciA9IGdldFNoYWRvd0JlZ2luRW5kKHBhcmFtcyk7CiAgcmV0dXJuIGZ1bmN0aW9uIChfcmVmMjQpIHsKICAgIHZhciBkcmFnZ2FibGVJbmZvID0gX3JlZjI0LmRyYWdnYWJsZUluZm8sCiAgICAgICAgZHJhZ1Jlc3VsdCA9IF9yZWYyNC5kcmFnUmVzdWx0OwoKICAgIGlmIChkcmFnZ2FibGVJbmZvLmludmFsaWRhdGVTaGFkb3cpIHsKICAgICAgcmV0dXJuIHNoYWRvd0JvdW5kc0dldHRlcih7CiAgICAgICAgZHJhZ2dhYmxlSW5mbzogZHJhZ2dhYmxlSW5mbywKICAgICAgICBkcmFnUmVzdWx0OiBkcmFnUmVzdWx0CiAgICAgIH0pOwogICAgfQoKICAgIHJldHVybiBudWxsOwogIH07Cn0KCmZ1bmN0aW9uIGdldE5leHRBZGRlZEluZGV4KHBhcmFtcykgewogIHZhciBnZXRJbmRleEZvclBvcyA9IGdldERyYWdJbnNlcnRpb25JbmRleChwYXJhbXMpOwogIHJldHVybiBmdW5jdGlvbiAoX3JlZjI1KSB7CiAgICB2YXIgZHJhZ1Jlc3VsdCA9IF9yZWYyNS5kcmFnUmVzdWx0OwogICAgdmFyIGluZGV4ID0gbnVsbDsKCiAgICBpZiAoZHJhZ1Jlc3VsdC5wb3MgIT09IG51bGwpIHsKICAgICAgaW5kZXggPSBnZXRJbmRleEZvclBvcyh7CiAgICAgICAgZHJhZ1Jlc3VsdDogZHJhZ1Jlc3VsdAogICAgICB9KTsKCiAgICAgIGlmIChpbmRleCA9PT0gbnVsbCkgewogICAgICAgIGluZGV4ID0gZHJhZ1Jlc3VsdC5hZGRlZEluZGV4OwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgYWRkZWRJbmRleDogaW5kZXgKICAgIH07CiAgfTsKfQoKZnVuY3Rpb24gcmVzZXRTaGFkb3dBZGp1c3RtZW50KCkgewogIHZhciBsYXN0QWRkZWRJbmRleCA9IG51bGw7CiAgcmV0dXJuIGZ1bmN0aW9uIChfcmVmMjYpIHsKICAgIHZhciBfcmVmMjYkZHJhZ1Jlc3VsdCA9IF9yZWYyNi5kcmFnUmVzdWx0LAogICAgICAgIGFkZGVkSW5kZXggPSBfcmVmMjYkZHJhZ1Jlc3VsdC5hZGRlZEluZGV4LAogICAgICAgIHNoYWRvd0JlZ2luRW5kID0gX3JlZjI2JGRyYWdSZXN1bHQuc2hhZG93QmVnaW5FbmQ7CgogICAgaWYgKGFkZGVkSW5kZXggIT09IGxhc3RBZGRlZEluZGV4ICYmIGxhc3RBZGRlZEluZGV4ICE9PSBudWxsICYmIHNoYWRvd0JlZ2luRW5kKSB7CiAgICAgIHNoYWRvd0JlZ2luRW5kLmJlZ2luQWRqdXN0bWVudCA9IDA7CiAgICB9CgogICAgbGFzdEFkZGVkSW5kZXggPSBhZGRlZEluZGV4OwogIH07Cn0KCmZ1bmN0aW9uIGhhbmRsZUluc2VydGlvblNpemVDaGFuZ2UoX3JlZjI3KSB7CiAgdmFyIGVsZW1lbnQgPSBfcmVmMjcuZWxlbWVudCwKICAgICAgZHJhZ2dhYmxlcyA9IF9yZWYyNy5kcmFnZ2FibGVzLAogICAgICBsYXlvdXQgPSBfcmVmMjcubGF5b3V0LAogICAgICBnZXRPcHRpb25zID0gX3JlZjI3LmdldE9wdGlvbnM7CiAgdmFyIHN0cmVjdGhlckVsZW1lbnQgPSBudWxsOwogIHJldHVybiBmdW5jdGlvbiAoX3JlZjI4KSB7CiAgICB2YXIgX3JlZjI4JGRyYWdSZXN1bHQgPSBfcmVmMjguZHJhZ1Jlc3VsdCwKICAgICAgICBhZGRlZEluZGV4ID0gX3JlZjI4JGRyYWdSZXN1bHQuYWRkZWRJbmRleCwKICAgICAgICByZW1vdmVkSW5kZXggPSBfcmVmMjgkZHJhZ1Jlc3VsdC5yZW1vdmVkSW5kZXgsCiAgICAgICAgZWxlbWVudFNpemUgPSBfcmVmMjgkZHJhZ1Jlc3VsdC5lbGVtZW50U2l6ZTsKCiAgICBpZiAocmVtb3ZlZEluZGV4ID09PSBudWxsKSB7CiAgICAgIGlmIChhZGRlZEluZGV4ICE9PSBudWxsKSB7CiAgICAgICAgaWYgKCFzdHJlY3RoZXJFbGVtZW50KSB7CiAgICAgICAgICB2YXIgY29udGFpbmVyQmVnaW5FbmQgPSBsYXlvdXQuZ2V0QmVnaW5FbmRPZkNvbnRhaW5lcigpOwogICAgICAgICAgY29udGFpbmVyQmVnaW5FbmQuZW5kID0gY29udGFpbmVyQmVnaW5FbmQuYmVnaW4gKyBsYXlvdXQuZ2V0U2l6ZShlbGVtZW50KTsKICAgICAgICAgIHZhciBoYXNTY3JvbGxCYXIgPSBsYXlvdXQuZ2V0U2Nyb2xsU2l6ZShlbGVtZW50KSA+IGxheW91dC5nZXRTaXplKGVsZW1lbnQpOwogICAgICAgICAgdmFyIGNvbnRhaW5lckVuZCA9IGhhc1Njcm9sbEJhciA/IGNvbnRhaW5lckJlZ2luRW5kLmJlZ2luICsgbGF5b3V0LmdldFNjcm9sbFNpemUoZWxlbWVudCkgLSBsYXlvdXQuZ2V0U2Nyb2xsVmFsdWUoZWxlbWVudCkgOiBjb250YWluZXJCZWdpbkVuZC5lbmQ7CiAgICAgICAgICB2YXIgbGFzdERyYWdnYWJsZUVuZCA9IGRyYWdnYWJsZXMubGVuZ3RoID4gMCA/IGxheW91dC5nZXRCZWdpbkVuZChkcmFnZ2FibGVzW2RyYWdnYWJsZXMubGVuZ3RoIC0gMV0pLmVuZCAtIGRyYWdnYWJsZXNbZHJhZ2dhYmxlcy5sZW5ndGggLSAxXVt0cmFuc2xhdGlvblZhbHVlXSA6IGNvbnRhaW5lckJlZ2luRW5kLmJlZ2luOwoKICAgICAgICAgIGlmIChsYXN0RHJhZ2dhYmxlRW5kICsgZWxlbWVudFNpemUgPiBjb250YWluZXJFbmQpIHsKICAgICAgICAgICAgc3RyZWN0aGVyRWxlbWVudCA9IHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgc3RyZWN0aGVyRWxlbWVudC5jbGFzc05hbWUgPSBzdHJldGNoZXJFbGVtZW50Q2xhc3MgKyAnICcgKyBnZXRPcHRpb25zKCkub3JpZW50YXRpb247CiAgICAgICAgICAgIHZhciBzdHJldGNoZXJTaXplID0gZHJhZ2dhYmxlcy5sZW5ndGggPiAwID8gZWxlbWVudFNpemUgKyBsYXN0RHJhZ2dhYmxlRW5kIC0gY29udGFpbmVyRW5kIDogZWxlbWVudFNpemU7CiAgICAgICAgICAgIGxheW91dC5zZXRTaXplKHN0cmVjdGhlckVsZW1lbnQuc3R5bGUsICIiLmNvbmNhdChzdHJldGNoZXJTaXplLCAicHgiKSk7CiAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kQ2hpbGQoc3RyZWN0aGVyRWxlbWVudCk7CiAgICAgICAgICAgIGVsZW1lbnRbc3RyZXRjaGVyRWxlbWVudEluc3RhbmNlXSA9IHN0cmVjdGhlckVsZW1lbnQ7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgY29udGFpbmVyQm94Q2hhbmdlZDogdHJ1ZQogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoc3RyZWN0aGVyRWxlbWVudCkgewogICAgICAgICAgbGF5b3V0LnNldFRyYW5zbGF0aW9uKHN0cmVjdGhlckVsZW1lbnQsIDApOwogICAgICAgICAgdmFyIHRvUmVtb3ZlID0gc3RyZWN0aGVyRWxlbWVudDsKICAgICAgICAgIHN0cmVjdGhlckVsZW1lbnQgPSBudWxsOwogICAgICAgICAgZWxlbWVudC5yZW1vdmVDaGlsZCh0b1JlbW92ZSk7CiAgICAgICAgICBlbGVtZW50W3N0cmV0Y2hlckVsZW1lbnRJbnN0YW5jZV0gPSBudWxsOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgY29udGFpbmVyQm94Q2hhbmdlZDogdHJ1ZQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gdW5kZWZpbmVkOwogIH07Cn0KCmZ1bmN0aW9uIGNhbGN1bGF0ZVRyYW5zbGF0aW9ucyhfcmVmMjkpIHsKICB2YXIgZHJhZ2dhYmxlcyA9IF9yZWYyOS5kcmFnZ2FibGVzLAogICAgICBsYXlvdXQgPSBfcmVmMjkubGF5b3V0OwogIHZhciBwcmV2QWRkZWRJbmRleCA9IG51bGw7CiAgdmFyIHByZXZSZW1vdmVkSW5kZXggPSBudWxsOwogIHJldHVybiBmdW5jdGlvbiAoX3JlZjMwKSB7CiAgICB2YXIgX3JlZjMwJGRyYWdSZXN1bHQgPSBfcmVmMzAuZHJhZ1Jlc3VsdCwKICAgICAgICBhZGRlZEluZGV4ID0gX3JlZjMwJGRyYWdSZXN1bHQuYWRkZWRJbmRleCwKICAgICAgICByZW1vdmVkSW5kZXggPSBfcmVmMzAkZHJhZ1Jlc3VsdC5yZW1vdmVkSW5kZXgsCiAgICAgICAgZWxlbWVudFNpemUgPSBfcmVmMzAkZHJhZ1Jlc3VsdC5lbGVtZW50U2l6ZTsKCiAgICBpZiAoYWRkZWRJbmRleCAhPT0gcHJldkFkZGVkSW5kZXggfHwgcmVtb3ZlZEluZGV4ICE9PSBwcmV2UmVtb3ZlZEluZGV4KSB7CiAgICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCBkcmFnZ2FibGVzLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgIGlmIChpbmRleCAhPT0gcmVtb3ZlZEluZGV4KSB7CiAgICAgICAgICB2YXIgZHJhZ2dhYmxlID0gZHJhZ2dhYmxlc1tpbmRleF07CiAgICAgICAgICB2YXIgdHJhbnNsYXRlID0gMDsKCiAgICAgICAgICBpZiAocmVtb3ZlZEluZGV4ICE9PSBudWxsICYmIHJlbW92ZWRJbmRleCA8IGluZGV4KSB7CiAgICAgICAgICAgIHRyYW5zbGF0ZSAtPSBlbGVtZW50U2l6ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoYWRkZWRJbmRleCAhPT0gbnVsbCAmJiBhZGRlZEluZGV4IDw9IGluZGV4KSB7CiAgICAgICAgICAgIHRyYW5zbGF0ZSArPSBlbGVtZW50U2l6ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBsYXlvdXQuc2V0VHJhbnNsYXRpb24oZHJhZ2dhYmxlLCB0cmFuc2xhdGUpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcHJldkFkZGVkSW5kZXggPSBhZGRlZEluZGV4OwogICAgICBwcmV2UmVtb3ZlZEluZGV4ID0gcmVtb3ZlZEluZGV4OwogICAgICByZXR1cm4gewogICAgICAgIGFkZGVkSW5kZXg6IGFkZGVkSW5kZXgsCiAgICAgICAgcmVtb3ZlZEluZGV4OiByZW1vdmVkSW5kZXgKICAgICAgfTsKICAgIH0KCiAgICByZXR1cm4gdW5kZWZpbmVkOwogIH07Cn0KCmZ1bmN0aW9uIGdldFNoYWRvd0JlZ2luRW5kKF9yZWYzMSkgewogIHZhciBkcmFnZ2FibGVzID0gX3JlZjMxLmRyYWdnYWJsZXMsCiAgICAgIGxheW91dCA9IF9yZWYzMS5sYXlvdXQ7CiAgdmFyIHByZXZBZGRlZEluZGV4ID0gbnVsbDsKICByZXR1cm4gZnVuY3Rpb24gKF9yZWYzMikgewogICAgdmFyIGRyYWdnYWJsZUluZm8gPSBfcmVmMzIuZHJhZ2dhYmxlSW5mbywKICAgICAgICBkcmFnUmVzdWx0ID0gX3JlZjMyLmRyYWdSZXN1bHQ7CiAgICB2YXIgYWRkZWRJbmRleCA9IGRyYWdSZXN1bHQuYWRkZWRJbmRleCwKICAgICAgICByZW1vdmVkSW5kZXggPSBkcmFnUmVzdWx0LnJlbW92ZWRJbmRleCwKICAgICAgICBlbGVtZW50U2l6ZSA9IGRyYWdSZXN1bHQuZWxlbWVudFNpemUsCiAgICAgICAgcG9zID0gZHJhZ1Jlc3VsdC5wb3MsCiAgICAgICAgc2hhZG93QmVnaW5FbmQgPSBkcmFnUmVzdWx0LnNoYWRvd0JlZ2luRW5kOwoKICAgIGlmIChwb3MgIT09IG51bGwpIHsKICAgICAgaWYgKGFkZGVkSW5kZXggIT09IG51bGwgJiYgKGRyYWdnYWJsZUluZm8uaW52YWxpZGF0ZVNoYWRvdyB8fCBhZGRlZEluZGV4ICE9PSBwcmV2QWRkZWRJbmRleCkpIHsKICAgICAgICAvLyBpZiAocHJldkFkZGVkSW5kZXgpIHByZXZBZGRlZEluZGV4ID0gYWRkZWRJbmRleDsKICAgICAgICB2YXIgYmVmb3JlSW5kZXggPSBhZGRlZEluZGV4IC0gMTsKICAgICAgICB2YXIgYmVnaW4gPSBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUjsKICAgICAgICB2YXIgZHJvcEFyZWFCZWdpbiA9IDA7CiAgICAgICAgdmFyIGRyb3BBcmVhRW5kID0gMDsKICAgICAgICB2YXIgYWZ0ZXJCb3VuZHMgPSBudWxsOwogICAgICAgIHZhciBiZWZvcmVCb3VuZHMgPSBudWxsOwoKICAgICAgICBpZiAoYmVmb3JlSW5kZXggPT09IHJlbW92ZWRJbmRleCkgewogICAgICAgICAgYmVmb3JlSW5kZXgtLTsKICAgICAgICB9CgogICAgICAgIGlmIChiZWZvcmVJbmRleCA+IC0xKSB7CiAgICAgICAgICB2YXIgYmVmb3JlU2l6ZSA9IGxheW91dC5nZXRTaXplKGRyYWdnYWJsZXNbYmVmb3JlSW5kZXhdKTsKICAgICAgICAgIGJlZm9yZUJvdW5kcyA9IGxheW91dC5nZXRCZWdpbkVuZChkcmFnZ2FibGVzW2JlZm9yZUluZGV4XSk7CgogICAgICAgICAgaWYgKGVsZW1lbnRTaXplIDwgYmVmb3JlU2l6ZSkgewogICAgICAgICAgICB2YXIgdGhyZXNob2xkID0gKGJlZm9yZVNpemUgLSBlbGVtZW50U2l6ZSkgLyAyOwogICAgICAgICAgICBiZWdpbiA9IGJlZm9yZUJvdW5kcy5lbmQgLSB0aHJlc2hvbGQ7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBiZWdpbiA9IGJlZm9yZUJvdW5kcy5lbmQ7CiAgICAgICAgICB9CgogICAgICAgICAgZHJvcEFyZWFCZWdpbiA9IGJlZm9yZUJvdW5kcy5lbmQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGJlZm9yZUJvdW5kcyA9IHsKICAgICAgICAgICAgZW5kOiBsYXlvdXQuZ2V0QmVnaW5FbmRPZkNvbnRhaW5lcigpLmJlZ2luCiAgICAgICAgICB9OwogICAgICAgICAgZHJvcEFyZWFCZWdpbiA9IGxheW91dC5nZXRCZWdpbkVuZE9mQ29udGFpbmVyKCkuYmVnaW47CiAgICAgICAgfQoKICAgICAgICB2YXIgZW5kID0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVI7CiAgICAgICAgdmFyIGFmdGVySW5kZXggPSBhZGRlZEluZGV4OwoKICAgICAgICBpZiAoYWZ0ZXJJbmRleCA9PT0gcmVtb3ZlZEluZGV4KSB7CiAgICAgICAgICBhZnRlckluZGV4Kys7CiAgICAgICAgfQoKICAgICAgICBpZiAoYWZ0ZXJJbmRleCA8IGRyYWdnYWJsZXMubGVuZ3RoKSB7CiAgICAgICAgICB2YXIgYWZ0ZXJTaXplID0gbGF5b3V0LmdldFNpemUoZHJhZ2dhYmxlc1thZnRlckluZGV4XSk7CiAgICAgICAgICBhZnRlckJvdW5kcyA9IGxheW91dC5nZXRCZWdpbkVuZChkcmFnZ2FibGVzW2FmdGVySW5kZXhdKTsKCiAgICAgICAgICBpZiAoZWxlbWVudFNpemUgPCBhZnRlclNpemUpIHsKICAgICAgICAgICAgdmFyIF90aHJlc2hvbGQgPSAoYWZ0ZXJTaXplIC0gZWxlbWVudFNpemUpIC8gMjsKCiAgICAgICAgICAgIGVuZCA9IGFmdGVyQm91bmRzLmJlZ2luICsgX3RocmVzaG9sZDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGVuZCA9IGFmdGVyQm91bmRzLmJlZ2luOwogICAgICAgICAgfQoKICAgICAgICAgIGRyb3BBcmVhRW5kID0gYWZ0ZXJCb3VuZHMuYmVnaW47CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFmdGVyQm91bmRzID0gewogICAgICAgICAgICBiZWdpbjogbGF5b3V0LmdldENvbnRhaW5lclJlY3RhbmdsZXMoKS5yZWN0LmVuZAogICAgICAgICAgfTsKICAgICAgICAgIGRyb3BBcmVhRW5kID0gbGF5b3V0LmdldENvbnRhaW5lclJlY3RhbmdsZXMoKS5yZWN0LmVuZCAtIGxheW91dC5nZXRDb250YWluZXJSZWN0YW5nbGVzKCkucmVjdC5iZWdpbjsKICAgICAgICB9CgogICAgICAgIHZhciBzaGFkb3dSZWN0VG9wTGVmdCA9IGJlZm9yZUJvdW5kcyAmJiBhZnRlckJvdW5kcyA/IGxheW91dC5nZXRUb3BMZWZ0T2ZFbGVtZW50QmVnaW4oYmVmb3JlQm91bmRzLmVuZCkgOiBudWxsOwogICAgICAgIHByZXZBZGRlZEluZGV4ID0gYWRkZWRJbmRleDsKICAgICAgICByZXR1cm4gewogICAgICAgICAgc2hhZG93QmVnaW5FbmQ6IHsKICAgICAgICAgICAgZHJvcEFyZWE6IHsKICAgICAgICAgICAgICBiZWdpbjogZHJvcEFyZWFCZWdpbiwKICAgICAgICAgICAgICBlbmQ6IGRyb3BBcmVhRW5kCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGJlZ2luOiBiZWdpbiwKICAgICAgICAgICAgZW5kOiBlbmQsCiAgICAgICAgICAgIHJlY3Q6IHNoYWRvd1JlY3RUb3BMZWZ0LAogICAgICAgICAgICBiZWdpbkFkanVzdG1lbnQ6IHNoYWRvd0JlZ2luRW5kID8gc2hhZG93QmVnaW5FbmQuYmVnaW5BZGp1c3RtZW50IDogMAogICAgICAgICAgfQogICAgICAgIH07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHByZXZBZGRlZEluZGV4ID0gbnVsbDsKICAgICAgcmV0dXJuIHsKICAgICAgICBzaGFkb3dCZWdpbkVuZDogbnVsbAogICAgICB9OwogICAgfQogIH07Cn0KCmZ1bmN0aW9uIGhhbmRsZUZpcnN0SW5zZXJ0U2hhZG93QWRqdXN0bWVudCgpIHsKICB2YXIgbGFzdEFkZGVkSW5kZXggPSBudWxsOwogIHJldHVybiBmdW5jdGlvbiAoX3JlZjMzKSB7CiAgICB2YXIgX3JlZjMzJGRyYWdSZXN1bHQgPSBfcmVmMzMuZHJhZ1Jlc3VsdCwKICAgICAgICBwb3MgPSBfcmVmMzMkZHJhZ1Jlc3VsdC5wb3MsCiAgICAgICAgYWRkZWRJbmRleCA9IF9yZWYzMyRkcmFnUmVzdWx0LmFkZGVkSW5kZXgsCiAgICAgICAgc2hhZG93QmVnaW5FbmQgPSBfcmVmMzMkZHJhZ1Jlc3VsdC5zaGFkb3dCZWdpbkVuZDsKCiAgICBpZiAocG9zICE9PSBudWxsKSB7CiAgICAgIGlmIChhZGRlZEluZGV4ICE9IG51bGwgJiYgbGFzdEFkZGVkSW5kZXggPT09IG51bGwpIHsKICAgICAgICBpZiAocG9zIDwgc2hhZG93QmVnaW5FbmQuYmVnaW4pIHsKICAgICAgICAgIHZhciBiZWdpbkFkanVzdG1lbnQgPSBwb3MgLSBzaGFkb3dCZWdpbkVuZC5iZWdpbiAtIDU7CiAgICAgICAgICBzaGFkb3dCZWdpbkVuZC5iZWdpbkFkanVzdG1lbnQgPSBiZWdpbkFkanVzdG1lbnQ7CiAgICAgICAgfQoKICAgICAgICBsYXN0QWRkZWRJbmRleCA9IGFkZGVkSW5kZXg7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGxhc3RBZGRlZEluZGV4ID0gbnVsbDsKICAgIH0KICB9Owp9CgpmdW5jdGlvbiBmaXJlRHJhZ0VudGVyTGVhdmVFdmVudHMoX3JlZjM0KSB7CiAgdmFyIGdldE9wdGlvbnMgPSBfcmVmMzQuZ2V0T3B0aW9uczsKICB2YXIgd2FzRHJhZ0luID0gZmFsc2U7CiAgdmFyIG9wdGlvbnMgPSBnZXRPcHRpb25zKCk7CiAgcmV0dXJuIGZ1bmN0aW9uIChfcmVmMzUpIHsKICAgIHZhciBwb3MgPSBfcmVmMzUuZHJhZ1Jlc3VsdC5wb3M7CiAgICB2YXIgaXNEcmFnSW4gPSAhIXBvczsKCiAgICBpZiAoaXNEcmFnSW4gIT09IHdhc0RyYWdJbikgewogICAgICB3YXNEcmFnSW4gPSBpc0RyYWdJbjsKCiAgICAgIGlmIChpc0RyYWdJbikgewogICAgICAgIG9wdGlvbnMub25EcmFnRW50ZXIgJiYgb3B0aW9ucy5vbkRyYWdFbnRlcigpOwogICAgICB9IGVsc2UgewogICAgICAgIG9wdGlvbnMub25EcmFnTGVhdmUgJiYgb3B0aW9ucy5vbkRyYWdMZWF2ZSgpOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIHVuZGVmaW5lZDsKICB9Owp9CgpmdW5jdGlvbiBmaXJlT25Ecm9wUmVhZHkoX3JlZjM2KSB7CiAgdmFyIGdldE9wdGlvbnMgPSBfcmVmMzYuZ2V0T3B0aW9uczsKICB2YXIgbGFzdEFkZGVkSW5kZXggPSBudWxsOwogIHZhciBvcHRpb25zID0gZ2V0T3B0aW9ucygpOwogIHJldHVybiBmdW5jdGlvbiAoX3JlZjM3KSB7CiAgICB2YXIgX3JlZjM3JGRyYWdSZXN1bHQgPSBfcmVmMzcuZHJhZ1Jlc3VsdCwKICAgICAgICBhZGRlZEluZGV4ID0gX3JlZjM3JGRyYWdSZXN1bHQuYWRkZWRJbmRleCwKICAgICAgICByZW1vdmVkSW5kZXggPSBfcmVmMzckZHJhZ1Jlc3VsdC5yZW1vdmVkSW5kZXgsCiAgICAgICAgX3JlZjM3JGRyYWdnYWJsZUluZm8gPSBfcmVmMzcuZHJhZ2dhYmxlSW5mbywKICAgICAgICBwYXlsb2FkID0gX3JlZjM3JGRyYWdnYWJsZUluZm8ucGF5bG9hZCwKICAgICAgICBlbGVtZW50ID0gX3JlZjM3JGRyYWdnYWJsZUluZm8uZWxlbWVudDsKCiAgICBpZiAob3B0aW9ucy5vbkRyb3BSZWFkeSAmJiBhZGRlZEluZGV4ICE9PSBudWxsICYmIGxhc3RBZGRlZEluZGV4ICE9PSBhZGRlZEluZGV4KSB7CiAgICAgIGxhc3RBZGRlZEluZGV4ID0gYWRkZWRJbmRleDsKICAgICAgdmFyIGFkanVzdGVkQWRkZWRJbmRleCA9IGFkZGVkSW5kZXg7CgogICAgICBpZiAocmVtb3ZlZEluZGV4ICE9PSBudWxsICYmIGFkZGVkSW5kZXggPiByZW1vdmVkSW5kZXgpIHsKICAgICAgICBhZGp1c3RlZEFkZGVkSW5kZXgtLTsKICAgICAgfQoKICAgICAgb3B0aW9ucy5vbkRyb3BSZWFkeSh7CiAgICAgICAgYWRkZWRJbmRleDogYWRqdXN0ZWRBZGRlZEluZGV4LAogICAgICAgIHJlbW92ZWRJbmRleDogcmVtb3ZlZEluZGV4LAogICAgICAgIHBheWxvYWQ6IHBheWxvYWQsCiAgICAgICAgZWxlbWVudDogZWxlbWVudCA/IGVsZW1lbnQuZmlyc3RFbGVtZW50Q2hpbGQgOiB1bmRlZmluZWQKICAgICAgfSk7CiAgICB9CiAgfTsKfQoKZnVuY3Rpb24gZ2V0RHJhZ0hhbmRsZXIocGFyYW1zKSB7CiAgaWYgKHBhcmFtcy5nZXRPcHRpb25zKCkuYmVoYXZpb3VyID09PSAnZHJvcC16b25lJykgewogICAgLy8gc29ydGluZyBpcyBkaXNhYmxlZCBpbiBjb250YWluZXIsIGFkZGVkSW5kZXggd2lsbCBhbHdheXMgYmUgMCBpZiBkcm9wcGVkIGluCiAgICByZXR1cm4gY29tcG9zZShwYXJhbXMpKGdldFJlbW92ZWRJdGVtLCBzZXRSZW1vdmVkSXRlbVZpc2liaWx0eSwgZ2V0UG9zaXRpb24sIGdldEVsZW1lbnRTaXplLCBoYW5kbGVUYXJnZXRDb250YWluZXIsIGdldERyYWdJbnNlcnRpb25JbmRleEZvckRyb3Bab25lLCBnZXRTaGFkb3dCZWdpbkVuZEZvckRyb3Bab25lLCBmaXJlRHJhZ0VudGVyTGVhdmVFdmVudHMsIGZpcmVPbkRyb3BSZWFkeSk7CiAgfSBlbHNlIHsKICAgIHJldHVybiBjb21wb3NlKHBhcmFtcykoZ2V0UmVtb3ZlZEl0ZW0sIHNldFJlbW92ZWRJdGVtVmlzaWJpbHR5LCBnZXRQb3NpdGlvbiwgZ2V0RWxlbWVudFNpemUsIGhhbmRsZVRhcmdldENvbnRhaW5lciwgaW52YWxpZGF0ZVNoYWRvd0JlZ2luRW5kSWZOZWVkZWQsIGdldE5leHRBZGRlZEluZGV4LCByZXNldFNoYWRvd0FkanVzdG1lbnQsIGhhbmRsZUluc2VydGlvblNpemVDaGFuZ2UsIGNhbGN1bGF0ZVRyYW5zbGF0aW9ucywgZ2V0U2hhZG93QmVnaW5FbmQsIGRyYXdEcm9wUGxhY2Vob2xkZXIsIGhhbmRsZUZpcnN0SW5zZXJ0U2hhZG93QWRqdXN0bWVudCwgZmlyZURyYWdFbnRlckxlYXZlRXZlbnRzLCBmaXJlT25Ecm9wUmVhZHkpOwogIH0KfQoKZnVuY3Rpb24gZ2V0RGVmYXVsdERyYWdSZXN1bHQoKSB7CiAgcmV0dXJuIHsKICAgIGFkZGVkSW5kZXg6IG51bGwsCiAgICByZW1vdmVkSW5kZXg6IG51bGwsCiAgICBlbGVtZW50U2l6ZTogbnVsbCwKICAgIHBvczogbnVsbCwKICAgIHNoYWRvd0JlZ2luRW5kOiBudWxsCiAgfTsKfQoKZnVuY3Rpb24gY29tcG9zZShwYXJhbXMpIHsKICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgZm9yICh2YXIgX2xlbiA9IGFyZ3VtZW50cy5sZW5ndGgsIGZ1bmN0aW9ucyA9IG5ldyBBcnJheShfbGVuKSwgX2tleSA9IDA7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHsKICAgICAgZnVuY3Rpb25zW19rZXldID0gYXJndW1lbnRzW19rZXldOwogICAgfQoKICAgIHZhciBoeWRyYXRlZEZ1bmN0aW9ucyA9IGZ1bmN0aW9ucy5tYXAoZnVuY3Rpb24gKHApIHsKICAgICAgcmV0dXJuIHAocGFyYW1zKTsKICAgIH0pOwogICAgdmFyIHJlc3VsdCA9IG51bGw7CiAgICByZXR1cm4gZnVuY3Rpb24gKGRyYWdnYWJsZUluZm8pIHsKICAgICAgcmVzdWx0ID0gaHlkcmF0ZWRGdW5jdGlvbnMucmVkdWNlKGZ1bmN0aW9uIChkcmFnUmVzdWx0LCBmbikgewogICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKGRyYWdSZXN1bHQsIGZuKHsKICAgICAgICAgIGRyYWdnYWJsZUluZm86IGRyYWdnYWJsZUluZm8sCiAgICAgICAgICBkcmFnUmVzdWx0OiBkcmFnUmVzdWx0CiAgICAgICAgfSkpOwogICAgICB9LCByZXN1bHQgfHwgZ2V0RGVmYXVsdERyYWdSZXN1bHQoKSk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9OwogIH07Cn0gLy8gQ29udGFpbmVyIGRlZmluaXRpb24gYmVnaW4KCgpmdW5jdGlvbiBDb250YWluZXIoZWxlbWVudCkgewogIHJldHVybiBmdW5jdGlvbiAob3B0aW9ucykgewogICAgdmFyIGNvbnRhaW5lck9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0T3B0aW9ucywgb3B0aW9ucyk7CiAgICB2YXIgZHJhZ1Jlc3VsdCA9IG51bGw7CiAgICB2YXIgbGFzdERyYWdnYWJsZUluZm8gPSBudWxsOwogICAgdmFyIHByb3BzID0gZ2V0Q29udGFpbmVyUHJvcHMoZWxlbWVudCwgZ2V0T3B0aW9ucyk7CiAgICB2YXIgZHJhZ0hhbmRsZXIgPSBnZXREcmFnSGFuZGxlcihwcm9wcyk7CiAgICB2YXIgZHJvcEhhbmRsZXIgPSBoYW5kbGVEcm9wKHByb3BzKTsKICAgIHZhciBzY3JvbGxMaXN0ZW5lciA9IGxpc3RlblNjcm9sbFBhcmVudChlbGVtZW50LCBvblNjcm9sbCk7CgogICAgZnVuY3Rpb24gcHJvY2Vzc0xhc3REcmFnZ2FibGVJbmZvKCkgewogICAgICBpZiAobGFzdERyYWdnYWJsZUluZm8gIT09IG51bGwpIHsKICAgICAgICBsYXN0RHJhZ2dhYmxlSW5mby5pbnZhbGlkYXRlU2hhZG93ID0gdHJ1ZTsKICAgICAgICBkcmFnUmVzdWx0ID0gZHJhZ0hhbmRsZXIobGFzdERyYWdnYWJsZUluZm8pOwogICAgICAgIGxhc3REcmFnZ2FibGVJbmZvLmludmFsaWRhdGVTaGFkb3cgPSBmYWxzZTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIF9zZXREcmFnZ2FibGVzKGRyYWdnYWJsZXMsIGVsZW1lbnQpIHsKICAgICAgdmFyIG5ld0RyYWdnYWJsZXMgPSB3cmFwQ2hpbGRyZW4oZWxlbWVudCk7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5ld0RyYWdnYWJsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBkcmFnZ2FibGVzW2ldID0gbmV3RHJhZ2dhYmxlc1tpXTsKICAgICAgfQoKICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGRyYWdnYWJsZXMubGVuZ3RoIC0gbmV3RHJhZ2dhYmxlcy5sZW5ndGg7IF9pKyspIHsKICAgICAgICBkcmFnZ2FibGVzLnBvcCgpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcHJlcGFyZURyYWcoY29udGFpbmVyLCByZWxldmFudENvbnRhaW5lcnMpIHsKICAgICAgdmFyIGVsZW1lbnQgPSBjb250YWluZXIuZWxlbWVudDsKICAgICAgdmFyIGRyYWdnYWJsZXMgPSBwcm9wcy5kcmFnZ2FibGVzOwoKICAgICAgX3NldERyYWdnYWJsZXMoZHJhZ2dhYmxlcywgZWxlbWVudCk7CgogICAgICBjb250YWluZXIubGF5b3V0LmludmFsaWRhdGVSZWN0cygpOwogICAgICBkcmFnZ2FibGVzLmZvckVhY2goZnVuY3Rpb24gKHApIHsKICAgICAgICByZXR1cm4gc2V0QW5pbWF0aW9uKHAsIHRydWUsIGdldE9wdGlvbnMoKS5hbmltYXRpb25EdXJhdGlvbik7CiAgICAgIH0pOwogICAgICBzY3JvbGxMaXN0ZW5lci5zdGFydCgpOwogICAgfQoKICAgIGZ1bmN0aW9uIG9uU2Nyb2xsKCkgewogICAgICBwcm9wcy5sYXlvdXQuaW52YWxpZGF0ZVJlY3RzKCk7CiAgICAgIHByb2Nlc3NMYXN0RHJhZ2dhYmxlSW5mbygpOwogICAgfQoKICAgIGZ1bmN0aW9uIGRpc3Bvc2UoY29udGFpbmVyKSB7CiAgICAgIHNjcm9sbExpc3RlbmVyLmRpc3Bvc2UoKTsKICAgICAgdW53cmFwQ2hpbGRyZW4oY29udGFpbmVyLmVsZW1lbnQpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldE9wdGlvbnMob3B0aW9ucykgewogICAgICB2YXIgbWVyZ2UgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHRydWU7CgogICAgICBpZiAobWVyZ2UgPT09IGZhbHNlKSB7CiAgICAgICAgY29udGFpbmVyT3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIGRlZmF1bHRPcHRpb25zLCBvcHRpb25zKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb250YWluZXJPcHRpb25zID0gT2JqZWN0LmFzc2lnbih7fSwgZGVmYXVsdE9wdGlvbnMsIGNvbnRhaW5lck9wdGlvbnMsIG9wdGlvbnMpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0T3B0aW9ucygpIHsKICAgICAgcmV0dXJuIGNvbnRhaW5lck9wdGlvbnM7CiAgICB9CgogICAgdmFyIGNvbnRhaW5lciA9IHsKICAgICAgZWxlbWVudDogZWxlbWVudCwKICAgICAgZHJhZ2dhYmxlczogcHJvcHMuZHJhZ2dhYmxlcywKICAgICAgaXNEcmFnUmVsZXZhbnQ6IGlzRHJhZ1JlbGV2YW50KHByb3BzKSwKICAgICAgbGF5b3V0OiBwcm9wcy5sYXlvdXQsCiAgICAgIGRpc3Bvc2U6IGRpc3Bvc2UsCiAgICAgIHByZXBhcmVEcmFnOiBwcmVwYXJlRHJhZywKICAgICAgaGFuZGxlRHJhZzogZnVuY3Rpb24gaGFuZGxlRHJhZyhkcmFnZ2FibGVJbmZvKSB7CiAgICAgICAgbGFzdERyYWdnYWJsZUluZm8gPSBkcmFnZ2FibGVJbmZvOwogICAgICAgIGRyYWdSZXN1bHQgPSBkcmFnSGFuZGxlcihkcmFnZ2FibGVJbmZvKTsKICAgICAgICByZXR1cm4gZHJhZ1Jlc3VsdDsKICAgICAgfSwKICAgICAgaGFuZGxlRHJvcDogZnVuY3Rpb24gaGFuZGxlRHJvcChkcmFnZ2FibGVJbmZvKSB7CiAgICAgICAgc2Nyb2xsTGlzdGVuZXIuc3RvcCgpOwoKICAgICAgICBpZiAoZHJhZ1Jlc3VsdCAmJiBkcmFnUmVzdWx0LmRyb3BQbGFjZWhvbGRlckNvbnRhaW5lcikgewogICAgICAgICAgZWxlbWVudC5yZW1vdmVDaGlsZChkcmFnUmVzdWx0LmRyb3BQbGFjZWhvbGRlckNvbnRhaW5lcik7CiAgICAgICAgfQoKICAgICAgICBsYXN0RHJhZ2dhYmxlSW5mbyA9IG51bGw7CiAgICAgICAgZHJhZ0hhbmRsZXIgPSBnZXREcmFnSGFuZGxlcihwcm9wcyk7CiAgICAgICAgZHJvcEhhbmRsZXIoZHJhZ2dhYmxlSW5mbywgZHJhZ1Jlc3VsdCk7CiAgICAgICAgZHJhZ1Jlc3VsdCA9IG51bGw7CiAgICAgIH0sCiAgICAgIGZpcmVSZW1vdmVFbGVtZW50OiBmdW5jdGlvbiBmaXJlUmVtb3ZlRWxlbWVudCgpIHsKICAgICAgICAvLyB3aWxsIGJlIGNhbGxlZCB3aGVuIGNvbnRhaW5lciBpcyBkaXNwb3NlZCB3aGlsZSBkcmFnZ2luZyBzbyBpZ25vcmUgYWRkZWRJbmRleAogICAgICAgIGRyb3BIYW5kbGVyKGxhc3REcmFnZ2FibGVJbmZvLCBPYmplY3QuYXNzaWduKHt9LCBkcmFnUmVzdWx0LCB7CiAgICAgICAgICBhZGRlZEluZGV4OiBudWxsCiAgICAgICAgfSksIHRydWUpOwogICAgICAgIGRyYWdSZXN1bHQgPSBudWxsOwogICAgICB9LAogICAgICBnZXREcmFnUmVzdWx0OiBmdW5jdGlvbiBnZXREcmFnUmVzdWx0KCkgewogICAgICAgIHJldHVybiBkcmFnUmVzdWx0OwogICAgICB9LAogICAgICBnZXRUcmFuc2xhdGVDYWxjdWxhdG9yOiBmdW5jdGlvbiBnZXRUcmFuc2xhdGVDYWxjdWxhdG9yKGRyYWdyZXN1bHQpIHsKICAgICAgICByZXR1cm4gY2FsY3VsYXRlVHJhbnNsYXRpb25zKHByb3BzKShkcmFncmVzdWx0KTsKICAgICAgfSwKICAgICAgb25UcmFuc2xhdGVkOiBmdW5jdGlvbiBvblRyYW5zbGF0ZWQoKSB7CiAgICAgICAgcHJvY2Vzc0xhc3REcmFnZ2FibGVJbmZvKCk7CiAgICAgIH0sCiAgICAgIHNldERyYWdnYWJsZXM6IGZ1bmN0aW9uIHNldERyYWdnYWJsZXMoKSB7CiAgICAgICAgX3NldERyYWdnYWJsZXMocHJvcHMuZHJhZ2dhYmxlcywgZWxlbWVudCk7CiAgICAgIH0sCiAgICAgIGdldFNjcm9sbE1heFNwZWVkOiBmdW5jdGlvbiBnZXRTY3JvbGxNYXhTcGVlZCgpIHsKICAgICAgICByZXR1cm4gc21vb3RoRG5ELm1heFNjcm9sbFNwZWVkOwogICAgICB9LAogICAgICBzaG91bGRVc2VUcmFuc2Zvcm1Gb3JHaG9zdDogZnVuY3Rpb24gc2hvdWxkVXNlVHJhbnNmb3JtRm9yR2hvc3QoKSB7CiAgICAgICAgcmV0dXJuIHNtb290aERuRC51c2VUcmFuc2Zvcm1Gb3JHaG9zdCA9PT0gdHJ1ZTsKICAgICAgfSwKICAgICAgZ2V0T3B0aW9uczogZ2V0T3B0aW9ucywKICAgICAgc2V0T3B0aW9uczogc2V0T3B0aW9ucwogICAgfTsKICAgIHJldHVybiBjb250YWluZXI7CiAgfTsKfSAvLyBleHBvcnRlZCBwYXJ0IG9mIGNvbnRhaW5lcgoKCnZhciBzbW9vdGhEbkQgPSBmdW5jdGlvbiBzbW9vdGhEbkQoZWxlbWVudCwgb3B0aW9ucykgewogIHZhciBjb250YWluZXJJbml0ZXIgPSBDb250YWluZXIoZWxlbWVudCk7CiAgdmFyIGNvbnRhaW5lciA9IGNvbnRhaW5lckluaXRlcihvcHRpb25zKTsKICBlbGVtZW50W2NvbnRhaW5lckluc3RhbmNlXSA9IGNvbnRhaW5lcjsKICBNZWRpYXRvci5yZWdpc3Rlcihjb250YWluZXIpOwogIHJldHVybiB7CiAgICBkaXNwb3NlOiBmdW5jdGlvbiBkaXNwb3NlKCkgewogICAgICBNZWRpYXRvci51bnJlZ2lzdGVyKGNvbnRhaW5lcik7CiAgICAgIGNvbnRhaW5lci5kaXNwb3NlKGNvbnRhaW5lcik7CiAgICB9LAogICAgc2V0T3B0aW9uczogZnVuY3Rpb24gc2V0T3B0aW9ucyhvcHRpb25zLCBtZXJnZSkgewogICAgICBjb250YWluZXIuc2V0T3B0aW9ucyhvcHRpb25zLCBtZXJnZSk7CiAgICB9CiAgfTsKfTsgLy8gd3JhcCBhbGwgZHJhZ2dhYmxlcyBieSBkZWZhdWx0Ci8vIGluIHJlYWN0LHZ1ZSxhbmd1bGFyIHRoaXMgdmFsdWUgd2lsbCBiZSBzZXQgdG8gZmFsc2UKCgpzbW9vdGhEbkQud3JhcENoaWxkID0gdHJ1ZTsKCnNtb290aERuRC5jYW5jZWxEcmFnID0gZnVuY3Rpb24gKCkgewogIE1lZGlhdG9yLmNhbmNlbERyYWcoKTsKfTsKCnNtb290aERuRC5pc0RyYWdnaW5nID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBNZWRpYXRvci5pc0RyYWdnaW5nKCk7Cn07CgpleHBvcnQgZGVmYXVsdCBzbW9vdGhEbkQ7"},{"version":3,"sources":["/Users/qiushunqun/Desktop/射箭專案/GitHub/17soooo/17soooo/src/utils/container/container.js"],"names":["animationClass","containerClass","containerInstance","dropPlaceholderFlexContainerClass","dropPlaceholderInnerClass","dropPlaceholderWrapperClass","stretcherElementClass","stretcherElementInstance","translationValue","wrapperClass","dropPlaceholderDefaultClass","defaultOptions","domDropHandler","layoutManager","Mediator","addClass","getParent","getParentRelevantContainerElement","hasClass","listenScrollParent","removeClass","setAnimation","element","add","animationDuration","style","transitionDuration","removeProperty","isDragRelevant","getOptions","sourceContainer","payload","options","shouldAcceptDrop","sourceOptions","behaviour","parentWrapper","groupName","wrapChild","child","smoothDnD","div","window","document","createElement","className","parentElement","insertBefore","appendChild","wrapChildren","draggables","Array","prototype","forEach","call","children","nodeType","Node","ELEMENT_NODE","wrapper","push","removeChild","unwrapChildren","firstElementChild","findDraggebleAtPos","layout","find","pos","startIndex","endIndex","withRespectToMiddlePoints","getBeginEnd","begin","end","middleIndex","Math","floor","length","resetDraggables","p","setTranslation","setVisibility","parentNode","setTargetContainer","draggableInfo","set","targetElement","handleDrop","draggablesReset","dropHandler","addedIndex","removedIndex","forDispose","cancelDrop","removeOnDropOut","indexNotNull","index","actualAddIndex","dropHandlerParams","shouldHandleDrop","container","fireRelatedEventsOnly","onDrop","dropNotAllowed","getContainerProps","orientation","getRemovedItem","prevRemovedIndex","elementIndex","setRemovedItemVisibilty","dragResult","getPosition","hitElement","elementFromPoint","position","x","y","relevantContainers","getElementSize","elementSize","getSize","size","handleTargetContainer","getDragInsertionIndex","findDraggable","shadowBeginEnd","beginAdjustment","getDragInsertionIndexForDropZone","getShadowBeginEndForDropZone","prevAddedIndex","getBeginEndOfContainer","rect","getTopLeftOfElementBegin","drawDropPlaceholder","dropPlaceholderContainer","dropPlaceholder","showOnTop","innerElement","flex","undefined","transition","setSize","pointerEvents","dropArea","setBegin","invalidateShadowBeginEndIfNeeded","params","shadowBoundsGetter","getShadowBeginEnd","invalidateShadow","getNextAddedIndex","getIndexForPos","resetShadowAdjustment","lastAddedIndex","handleInsertionSizeChange","strectherElement","containerBeginEnd","hasScrollBar","getScrollSize","containerEnd","getScrollValue","lastDraggableEnd","stretcherSize","containerBoxChanged","toRemove","calculateTranslations","draggable","translate","beforeIndex","Number","MIN_SAFE_INTEGER","dropAreaBegin","dropAreaEnd","afterBounds","beforeBounds","beforeSize","threshold","MAX_SAFE_INTEGER","afterIndex","afterSize","getContainerRectangles","shadowRectTopLeft","handleFirstInsertShadowAdjustment","fireDragEnterLeaveEvents","wasDragIn","isDragIn","onDragEnter","onDragLeave","fireOnDropReady","onDropReady","adjustedAddedIndex","getDragHandler","compose","getDefaultDragResult","functions","hydratedFunctions","map","result","reduce","fn","Object","assign","Container","containerOptions","lastDraggableInfo","props","dragHandler","scrollListener","onScroll","processLastDraggableInfo","setDraggables","newDraggables","i","pop","prepareDrag","invalidateRects","start","dispose","setOptions","merge","handleDrag","stop","fireRemoveElement","getDragResult","getTranslateCalculator","dragresult","onTranslated","getScrollMaxSpeed","maxScrollSpeed","shouldUseTransformForGhost","useTransformForGhost","containerIniter","register","unregister","cancelDrag","isDragging"],"mappings":"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","sourcesContent":["import {\n  animationClass,\n  containerClass,\n  containerInstance,\n  dropPlaceholderFlexContainerClass,\n  dropPlaceholderInnerClass,\n  dropPlaceholderWrapperClass,\n  stretcherElementClass,\n  stretcherElementInstance,\n  translationValue,\n  wrapperClass,\n  dropPlaceholderDefaultClass,\n} from './constants';\nimport { defaultOptions } from './defaults';\nimport { domDropHandler } from './dropHandlers';\nimport layoutManager from './layoutManager';\nimport Mediator from './mediator';\nimport {\n  addClass,\n  getParent,\n  getParentRelevantContainerElement,\n  hasClass,\n  listenScrollParent,\n  removeClass,\n} from './utils';\n\nfunction setAnimation (\n  element,\n  add,\n  animationDuration = defaultOptions.animationDuration\n) {\n  if (add) {\n    addClass(element, animationClass);\n    element.style.transitionDuration = animationDuration + 'ms';\n  } else {\n    removeClass(element, animationClass);\n    element.style.removeProperty('transition-duration');\n  }\n}\n\nfunction isDragRelevant ({ element, getOptions }) {\n  return function (sourceContainer, payload) {\n    const options = getOptions();\n\n    if (options.shouldAcceptDrop) {\n      return options.shouldAcceptDrop(sourceContainer.getOptions(), payload);\n    }\n    const sourceOptions = sourceContainer.getOptions();\n    if (options.behaviour === 'copy') return false;\n\n    const parentWrapper = getParent(element, '.' + wrapperClass);\n    if (parentWrapper === sourceContainer.element) {\n      return false;\n    }\n\n    if (sourceContainer.element === element) return true;\n    if (\n      sourceOptions.groupName &&\n      sourceOptions.groupName === options.groupName\n    ) {\n      return true;\n    }\n\n    return false;\n  };\n}\n\nfunction wrapChild (child) {\n  if (smoothDnD.wrapChild) {\n    const div = window.document.createElement('div');\n    div.className = `${wrapperClass}`;\n    child.parentElement.insertBefore(div, child);\n    div.appendChild(child);\n    return div;\n  }\n\n  return child;\n}\n\nfunction wrapChildren (element) {\n  const draggables = [];\n  Array.prototype.forEach.call(element.children, (child) => {\n    if (child.nodeType === Node.ELEMENT_NODE) {\n      let wrapper = child;\n      if (!hasClass(child, wrapperClass)) {\n        wrapper = wrapChild(child);\n      }\n      wrapper[translationValue] = 0;\n      draggables.push(wrapper);\n    } else {\n      element.removeChild(child);\n    }\n  });\n  return draggables;\n}\n\nfunction unwrapChildren (element) {\n  if (smoothDnD.wrapChild) {\n    Array.prototype.forEach.call(element.children, (child) => {\n      if (child.nodeType === Node.ELEMENT_NODE) {\n        if (hasClass(child, wrapperClass)) {\n          element.insertBefore(child.firstElementChild, child);\n          element.removeChild(child);\n        }\n      }\n    });\n  }\n}\n\nfunction findDraggebleAtPos ({ layout }) {\n  const find = (\n    draggables,\n    pos,\n    startIndex,\n    endIndex,\n    withRespectToMiddlePoints = false\n  ) => {\n    if (endIndex < startIndex) {\n      return startIndex;\n    }\n    // binary serach draggable\n    if (startIndex === endIndex) {\n      const { begin, end } = layout.getBeginEnd(draggables[startIndex]);\n      // mouse pos is inside draggable\n      // now decide which index to return\n      // if (pos > begin && pos <= end) {\n      if (withRespectToMiddlePoints) {\n        return pos < (end + begin) / 2 ? startIndex : startIndex + 1;\n      } else {\n        return startIndex;\n      }\n      // } else {\n      //   return null;\n      // }\n    } else {\n      const middleIndex = Math.floor((endIndex + startIndex) / 2);\n      const { begin, end } = layout.getBeginEnd(draggables[middleIndex]);\n      if (pos < begin) {\n        return find(\n          draggables,\n          pos,\n          startIndex,\n          middleIndex - 1,\n          withRespectToMiddlePoints\n        );\n      } else if (pos > end) {\n        return find(\n          draggables,\n          pos,\n          middleIndex + 1,\n          endIndex,\n          withRespectToMiddlePoints\n        );\n      } else {\n        if (withRespectToMiddlePoints) {\n          return pos < (end + begin) / 2 ? middleIndex : middleIndex + 1;\n        } else {\n          return middleIndex;\n        }\n      }\n    }\n  };\n\n  return (draggables, pos, withRespectToMiddlePoints = false) => {\n    return find(\n      draggables,\n      pos,\n      0,\n      draggables.length - 1,\n      withRespectToMiddlePoints\n    );\n  };\n}\n\nfunction resetDraggables ({ element, draggables, layout }) {\n  return function () {\n    draggables.forEach((p) => {\n      setAnimation(p, false);\n      layout.setTranslation(p, 0);\n      layout.setVisibility(p, true);\n    });\n\n    if (element[stretcherElementInstance]) {\n      element[stretcherElementInstance].parentNode.removeChild(\n        element[stretcherElementInstance]\n      );\n      element[stretcherElementInstance] = null;\n    }\n  };\n}\n\nfunction setTargetContainer (draggableInfo, element, set = true) {\n  if (element && set) {\n    draggableInfo.targetElement = element;\n  } else {\n    if (draggableInfo.targetElement === element) {\n      draggableInfo.targetElement = null;\n    }\n  }\n}\n\nfunction handleDrop ({ element, draggables, layout, getOptions }) {\n  const draggablesReset = resetDraggables({\n    element,\n    draggables,\n    layout,\n    getOptions,\n  });\n  const dropHandler = (smoothDnD.dropHandler || domDropHandler)({\n    element,\n    draggables,\n    layout,\n    getOptions,\n  });\n  return function (\n    draggableInfo,\n    { addedIndex, removedIndex },\n    forDispose = false\n  ) {\n    draggablesReset();\n    // if drop zone is valid => complete drag, else emit dropNotAllowed and everything will be reverted by draggablesReset()\n    if (draggableInfo && !draggableInfo.cancelDrop) {\n      if (\n        draggableInfo.targetElement ||\n        getOptions().removeOnDropOut ||\n        forDispose\n      ) {\n        const indexNotNull = (index) => index !== null;\n\n        const actualAddIndex =\n          indexNotNull(addedIndex)\n            ? indexNotNull(removedIndex) && removedIndex < addedIndex\n              ? addedIndex - 1\n              : addedIndex\n            : null;\n\n        const dropHandlerParams = {\n          removedIndex,\n          addedIndex: actualAddIndex,\n          payload: draggableInfo.payload,\n          // droppedElement: draggableInfo.element.firstElementChild,\n        };\n        const shouldHandleDrop =\n          !draggableInfo.container.getOptions().fireRelatedEventsOnly ||\n          indexNotNull(removedIndex) ||\n          indexNotNull(actualAddIndex);\n        if (shouldHandleDrop) {\n          dropHandler(dropHandlerParams, getOptions().onDrop);\n        }\n      } else if (getOptions().dropNotAllowed) {\n        const { payload, container } = draggableInfo;\n        return getOptions().dropNotAllowed({ payload, container });\n      }\n    }\n  };\n}\n\nfunction getContainerProps (element, getOptions) {\n  const draggables = wrapChildren(element);\n  const options = getOptions();\n  // set flex classes before layout is inited for scroll listener\n  addClass(element, `${containerClass} ${options.orientation}`);\n  const layout = layoutManager(\n    element,\n    options.orientation,\n    options.animationDuration\n  );\n  return {\n    element,\n    draggables,\n    getOptions,\n    layout,\n  };\n}\n\nfunction getRemovedItem ({ element, getOptions }) {\n  let prevRemovedIndex = null;\n  return ({ draggableInfo }) => {\n    let removedIndex = prevRemovedIndex;\n    if (\n      prevRemovedIndex == null &&\n      draggableInfo.container.element === element &&\n      getOptions().behaviour !== 'copy'\n    ) {\n      removedIndex = prevRemovedIndex = draggableInfo.elementIndex;\n    }\n\n    return { removedIndex };\n  };\n}\n\nfunction setRemovedItemVisibilty ({ draggables, layout }) {\n  return ({ dragResult }) => {\n    if (dragResult.removedIndex !== null) {\n      layout.setVisibility(draggables[dragResult.removedIndex], false);\n    }\n  };\n}\n\nfunction getPosition ({ element, layout }) {\n  return ({ draggableInfo }) => {\n    const hitElement = document.elementFromPoint(\n      draggableInfo.position.x,\n      draggableInfo.position.y\n    );\n\n    // TODO: if center is out of bounds use mouse position for hittest\n    // if (!hitElement) {\n    //   hitElement = document.elementFromPoint(draggableInfo.mousePosition.x, draggableInfo.mousePosition.y);\n    // }\n\n    if (hitElement) {\n      const container = getParentRelevantContainerElement(\n        hitElement,\n        draggableInfo.relevantContainers\n      );\n      if (container && container.element === element) {\n        return {\n          pos: layout.getPosition(draggableInfo.position),\n        };\n      }\n    }\n\n    return {\n      pos: null,\n    };\n  };\n}\n\nfunction getElementSize ({ layout }) {\n  let elementSize = null;\n  return ({ draggableInfo, dragResult }) => {\n    if (dragResult.pos === null) {\n      return (elementSize = null);\n    } else {\n      elementSize = elementSize || layout.getSize(draggableInfo.size);\n    }\n    return { elementSize };\n  };\n}\n\nfunction handleTargetContainer ({ element }) {\n  return ({ draggableInfo, dragResult }) => {\n    setTargetContainer(draggableInfo, element, !!dragResult.pos);\n  };\n}\n\nfunction getDragInsertionIndex ({ draggables, layout }) {\n  const findDraggable = findDraggebleAtPos({ layout });\n  return ({ dragResult: { shadowBeginEnd, pos } }) => {\n    if (!shadowBeginEnd) {\n      const index = findDraggable(draggables, pos, true);\n      return index !== null ? index : draggables.length;\n    } else {\n      if (\n        shadowBeginEnd.begin + shadowBeginEnd.beginAdjustment <= pos &&\n        shadowBeginEnd.end >= pos\n      ) {\n        // position inside ghost\n        return null;\n      }\n    }\n\n    if (pos < shadowBeginEnd.begin + shadowBeginEnd.beginAdjustment) {\n      return findDraggable(draggables, pos);\n    } else if (pos > shadowBeginEnd.end) {\n      return findDraggable(draggables, pos) + 1;\n    } else {\n      return draggables.length;\n    }\n  };\n}\n\nfunction getDragInsertionIndexForDropZone () {\n  return ({ dragResult: { pos } }) => {\n    return pos !== null ? { addedIndex: 0 } : { addedIndex: null };\n  };\n}\n\nfunction getShadowBeginEndForDropZone ({ layout }) {\n  let prevAddedIndex = null;\n  return ({ dragResult: { addedIndex } }) => {\n    if (addedIndex !== prevAddedIndex) {\n      prevAddedIndex = addedIndex;\n      const { begin } = layout.getBeginEndOfContainer();\n      return {\n        shadowBeginEnd: {\n          rect: layout.getTopLeftOfElementBegin(begin),\n        },\n      };\n    }\n\n    return null;\n  };\n}\n\nfunction drawDropPlaceholder ({ layout, element, getOptions }) {\n  let prevAddedIndex = null;\n  return ({\n    dragResult: {\n      elementSize,\n      shadowBeginEnd,\n      addedIndex,\n      dropPlaceholderContainer,\n    },\n  }) => {\n    const options = getOptions();\n    if (options.dropPlaceholder) {\n      const { animationDuration, className, showOnTop } =\n        typeof options.dropPlaceholder === 'boolean'\n          ? {}\n          : options.dropPlaceholder;\n      if (addedIndex !== null) {\n        if (!dropPlaceholderContainer) {\n          const innerElement = document.createElement('div');\n          const flex = document.createElement('div');\n          flex.className = dropPlaceholderFlexContainerClass;\n          innerElement.className = `${dropPlaceholderInnerClass} ${\n            className || dropPlaceholderDefaultClass\n          }`;\n          dropPlaceholderContainer = document.createElement('div');\n          dropPlaceholderContainer.className = `${dropPlaceholderWrapperClass}`;\n          dropPlaceholderContainer.style.position = 'absolute';\n\n          if (animationDuration !== undefined) {\n            dropPlaceholderContainer.style.transition = `all ${animationDuration}ms ease`;\n          }\n\n          dropPlaceholderContainer.appendChild(flex);\n          flex.appendChild(innerElement);\n          layout.setSize(dropPlaceholderContainer.style, elementSize + 'px');\n\n          dropPlaceholderContainer.style.pointerEvents = 'none';\n\n          if (showOnTop) {\n            element.appendChild(dropPlaceholderContainer);\n          } else {\n            element.insertBefore(\n              dropPlaceholderContainer,\n              element.firstElementChild\n            );\n          }\n        }\n\n        if (prevAddedIndex !== addedIndex && shadowBeginEnd.dropArea) {\n          layout.setBegin(\n            dropPlaceholderContainer.style,\n            shadowBeginEnd.dropArea.begin -\n              layout.getBeginEndOfContainer().begin +\n              'px'\n          );\n        }\n        prevAddedIndex = addedIndex;\n\n        return {\n          dropPlaceholderContainer,\n        };\n      } else {\n        if (dropPlaceholderContainer && prevAddedIndex !== null) {\n          element.removeChild(dropPlaceholderContainer);\n        }\n        prevAddedIndex = null;\n\n        return {\n          dropPlaceholderContainer: undefined,\n        };\n      }\n    }\n\n    return null;\n  };\n}\n\nfunction invalidateShadowBeginEndIfNeeded (params) {\n  const shadowBoundsGetter = getShadowBeginEnd(params);\n  return ({ draggableInfo, dragResult }) => {\n    if (draggableInfo.invalidateShadow) {\n      return shadowBoundsGetter({ draggableInfo, dragResult });\n    }\n    return null;\n  };\n}\n\nfunction getNextAddedIndex (params) {\n  const getIndexForPos = getDragInsertionIndex(params);\n  return ({ dragResult }) => {\n    let index = null;\n    if (dragResult.pos !== null) {\n      index = getIndexForPos({ dragResult });\n      if (index === null) {\n        index = dragResult.addedIndex;\n      }\n    }\n    return {\n      addedIndex: index,\n    };\n  };\n}\n\nfunction resetShadowAdjustment () {\n  let lastAddedIndex = null;\n  return ({ dragResult: { addedIndex, shadowBeginEnd } }) => {\n    if (\n      addedIndex !== lastAddedIndex &&\n      lastAddedIndex !== null &&\n      shadowBeginEnd\n    ) {\n      shadowBeginEnd.beginAdjustment = 0;\n    }\n    lastAddedIndex = addedIndex;\n  };\n}\n\nfunction handleInsertionSizeChange ({\n  element,\n  draggables,\n  layout,\n  getOptions,\n}) {\n  let strectherElement = null;\n  return function ({ dragResult: { addedIndex, removedIndex, elementSize } }) {\n    if (removedIndex === null) {\n      if (addedIndex !== null) {\n        if (!strectherElement) {\n          const containerBeginEnd = layout.getBeginEndOfContainer();\n          containerBeginEnd.end =\n            containerBeginEnd.begin + layout.getSize(element);\n          const hasScrollBar =\n            layout.getScrollSize(element) > layout.getSize(element);\n          const containerEnd = hasScrollBar\n            ? containerBeginEnd.begin +\n              layout.getScrollSize(element) -\n              layout.getScrollValue(element)\n            : containerBeginEnd.end;\n          const lastDraggableEnd =\n            draggables.length > 0\n              ? layout.getBeginEnd(draggables[draggables.length - 1]).end -\n                draggables[draggables.length - 1][translationValue]\n              : containerBeginEnd.begin;\n          if (lastDraggableEnd + elementSize > containerEnd) {\n            strectherElement = window.document.createElement('div');\n            strectherElement.className =\n              stretcherElementClass + ' ' + getOptions().orientation;\n            const stretcherSize =\n              draggables.length > 0\n                ? elementSize + lastDraggableEnd - containerEnd\n                : elementSize;\n            layout.setSize(strectherElement.style, `${stretcherSize}px`);\n            element.appendChild(strectherElement);\n            element[stretcherElementInstance] = strectherElement;\n            return {\n              containerBoxChanged: true,\n            };\n          }\n        }\n      } else {\n        if (strectherElement) {\n          layout.setTranslation(strectherElement, 0);\n          const toRemove = strectherElement;\n          strectherElement = null;\n          element.removeChild(toRemove);\n          element[stretcherElementInstance] = null;\n          return {\n            containerBoxChanged: true,\n          };\n        }\n      }\n    }\n\n    return undefined;\n  };\n}\n\nfunction calculateTranslations ({ draggables, layout }) {\n  let prevAddedIndex = null;\n  let prevRemovedIndex = null;\n  return function ({ dragResult: { addedIndex, removedIndex, elementSize } }) {\n    if (addedIndex !== prevAddedIndex || removedIndex !== prevRemovedIndex) {\n      for (let index = 0; index < draggables.length; index++) {\n        if (index !== removedIndex) {\n          const draggable = draggables[index];\n          let translate = 0;\n          if (removedIndex !== null && removedIndex < index) {\n            translate -= elementSize;\n          }\n          if (addedIndex !== null && addedIndex <= index) {\n            translate += elementSize;\n          }\n          layout.setTranslation(draggable, translate);\n        }\n      }\n\n      prevAddedIndex = addedIndex;\n      prevRemovedIndex = removedIndex;\n\n      return { addedIndex, removedIndex };\n    }\n\n    return undefined;\n  };\n}\n\nfunction getShadowBeginEnd ({ draggables, layout }) {\n  let prevAddedIndex = null;\n  return ({ draggableInfo, dragResult }) => {\n    const { addedIndex, removedIndex, elementSize, pos, shadowBeginEnd } =\n      dragResult;\n    if (pos !== null) {\n      if (\n        addedIndex !== null &&\n        (draggableInfo.invalidateShadow || addedIndex !== prevAddedIndex)\n      ) {\n        // if (prevAddedIndex) prevAddedIndex = addedIndex;\n        let beforeIndex = addedIndex - 1;\n        let begin = Number.MIN_SAFE_INTEGER;\n        let dropAreaBegin = 0;\n        let dropAreaEnd = 0;\n        let afterBounds = null;\n        let beforeBounds = null;\n        if (beforeIndex === removedIndex) {\n          beforeIndex--;\n        }\n        if (beforeIndex > -1) {\n          const beforeSize = layout.getSize(draggables[beforeIndex]);\n          beforeBounds = layout.getBeginEnd(draggables[beforeIndex]);\n          if (elementSize < beforeSize) {\n            const threshold = (beforeSize - elementSize) / 2;\n            begin = beforeBounds.end - threshold;\n          } else {\n            begin = beforeBounds.end;\n          }\n          dropAreaBegin = beforeBounds.end;\n        } else {\n          beforeBounds = { end: layout.getBeginEndOfContainer().begin };\n          dropAreaBegin = layout.getBeginEndOfContainer().begin;\n        }\n\n        let end = Number.MAX_SAFE_INTEGER;\n        let afterIndex = addedIndex;\n        if (afterIndex === removedIndex) {\n          afterIndex++;\n        }\n        if (afterIndex < draggables.length) {\n          const afterSize = layout.getSize(draggables[afterIndex]);\n          afterBounds = layout.getBeginEnd(draggables[afterIndex]);\n\n          if (elementSize < afterSize) {\n            const threshold = (afterSize - elementSize) / 2;\n            end = afterBounds.begin + threshold;\n          } else {\n            end = afterBounds.begin;\n          }\n          dropAreaEnd = afterBounds.begin;\n        } else {\n          afterBounds = { begin: layout.getContainerRectangles().rect.end };\n          dropAreaEnd =\n            layout.getContainerRectangles().rect.end -\n            layout.getContainerRectangles().rect.begin;\n        }\n\n        const shadowRectTopLeft =\n          beforeBounds && afterBounds\n            ? layout.getTopLeftOfElementBegin(beforeBounds.end)\n            : null;\n\n        prevAddedIndex = addedIndex;\n        return {\n          shadowBeginEnd: {\n            dropArea: {\n              begin: dropAreaBegin,\n              end: dropAreaEnd,\n            },\n            begin,\n            end,\n            rect: shadowRectTopLeft,\n            beginAdjustment: shadowBeginEnd\n              ? shadowBeginEnd.beginAdjustment\n              : 0,\n          },\n        };\n      } else {\n        return null;\n      }\n    } else {\n      prevAddedIndex = null;\n      return {\n        shadowBeginEnd: null,\n      };\n    }\n  };\n}\n\nfunction handleFirstInsertShadowAdjustment () {\n  let lastAddedIndex = null;\n  return ({ dragResult: { pos, addedIndex, shadowBeginEnd } }) => {\n    if (pos !== null) {\n      if (addedIndex != null && lastAddedIndex === null) {\n        if (pos < shadowBeginEnd.begin) {\n          const beginAdjustment = pos - shadowBeginEnd.begin - 5;\n          shadowBeginEnd.beginAdjustment = beginAdjustment;\n        }\n        lastAddedIndex = addedIndex;\n      }\n    } else {\n      lastAddedIndex = null;\n    }\n  };\n}\n\nfunction fireDragEnterLeaveEvents ({ getOptions }) {\n  let wasDragIn = false;\n  const options = getOptions();\n  return ({ dragResult: { pos } }) => {\n    const isDragIn = !!pos;\n    if (isDragIn !== wasDragIn) {\n      wasDragIn = isDragIn;\n      if (isDragIn) {\n        options.onDragEnter && options.onDragEnter();\n      } else {\n        options.onDragLeave && options.onDragLeave();\n      }\n    }\n\n    return undefined;\n  };\n}\n\nfunction fireOnDropReady ({ getOptions }) {\n  let lastAddedIndex = null;\n  const options = getOptions();\n  return ({\n    dragResult: { addedIndex, removedIndex },\n    draggableInfo: { payload, element },\n  }) => {\n    if (\n      options.onDropReady &&\n      addedIndex !== null &&\n      lastAddedIndex !== addedIndex\n    ) {\n      lastAddedIndex = addedIndex;\n      let adjustedAddedIndex = addedIndex;\n\n      if (removedIndex !== null && addedIndex > removedIndex) {\n        adjustedAddedIndex--;\n      }\n\n      options.onDropReady({\n        addedIndex: adjustedAddedIndex,\n        removedIndex,\n        payload,\n        element: element ? element.firstElementChild : undefined,\n      });\n    }\n  };\n}\n\nfunction getDragHandler (params) {\n  if (params.getOptions().behaviour === 'drop-zone') {\n    // sorting is disabled in container, addedIndex will always be 0 if dropped in\n    return compose(params)(\n      getRemovedItem,\n      setRemovedItemVisibilty,\n      getPosition,\n      getElementSize,\n      handleTargetContainer,\n      getDragInsertionIndexForDropZone,\n      getShadowBeginEndForDropZone,\n      fireDragEnterLeaveEvents,\n      fireOnDropReady\n    );\n  } else {\n    return compose(params)(\n      getRemovedItem,\n      setRemovedItemVisibilty,\n      getPosition,\n      getElementSize,\n      handleTargetContainer,\n      invalidateShadowBeginEndIfNeeded,\n      getNextAddedIndex,\n      resetShadowAdjustment,\n      handleInsertionSizeChange,\n      calculateTranslations,\n      getShadowBeginEnd,\n      drawDropPlaceholder,\n      handleFirstInsertShadowAdjustment,\n      fireDragEnterLeaveEvents,\n      fireOnDropReady\n    );\n  }\n}\n\nfunction getDefaultDragResult () {\n  return {\n    addedIndex: null,\n    removedIndex: null,\n    elementSize: null,\n    pos: null,\n    shadowBeginEnd: null,\n  };\n}\n\nfunction compose (params) {\n  return (...functions) => {\n    const hydratedFunctions = functions.map((p) => p(params));\n    let result = null;\n    return (draggableInfo) => {\n      result = hydratedFunctions.reduce((dragResult, fn) => {\n        return Object.assign(dragResult, fn({ draggableInfo, dragResult }));\n      }, result || getDefaultDragResult());\n      return result;\n    };\n  };\n}\n\n// Container definition begin\nfunction Container (element) {\n  return function (options) {\n    let containerOptions = Object.assign({}, defaultOptions, options);\n    let dragResult = null;\n    let lastDraggableInfo = null;\n    const props = getContainerProps(element, getOptions);\n    let dragHandler = getDragHandler(props);\n    const dropHandler = handleDrop(props);\n    const scrollListener = listenScrollParent(element, onScroll);\n\n    function processLastDraggableInfo () {\n      if (lastDraggableInfo !== null) {\n        lastDraggableInfo.invalidateShadow = true;\n        dragResult = dragHandler(lastDraggableInfo);\n        lastDraggableInfo.invalidateShadow = false;\n      }\n    }\n\n    function setDraggables (draggables, element) {\n      const newDraggables = wrapChildren(element);\n      for (let i = 0; i < newDraggables.length; i++) {\n        draggables[i] = newDraggables[i];\n      }\n\n      for (let i = 0; i < draggables.length - newDraggables.length; i++) {\n        draggables.pop();\n      }\n    }\n\n    function prepareDrag (container, relevantContainers) {\n      const element = container.element;\n      const draggables = props.draggables;\n      setDraggables(draggables, element);\n      container.layout.invalidateRects();\n      draggables.forEach((p) =>\n        setAnimation(p, true, getOptions().animationDuration)\n      );\n      scrollListener.start();\n    }\n\n    function onScroll () {\n      props.layout.invalidateRects();\n      processLastDraggableInfo();\n    }\n\n    function dispose (container) {\n      scrollListener.dispose();\n      unwrapChildren(container.element);\n    }\n\n    function setOptions (options, merge = true) {\n      if (merge === false) {\n        containerOptions = Object.assign({}, defaultOptions, options);\n      } else {\n        containerOptions = Object.assign(\n          {},\n          defaultOptions,\n          containerOptions,\n          options\n        );\n      }\n    }\n\n    function getOptions () {\n      return containerOptions;\n    }\n\n    const container = {\n      element,\n      draggables: props.draggables,\n      isDragRelevant: isDragRelevant(props),\n      layout: props.layout,\n      dispose,\n      prepareDrag,\n      handleDrag (draggableInfo) {\n        lastDraggableInfo = draggableInfo;\n        dragResult = dragHandler(draggableInfo);\n        return dragResult;\n      },\n      handleDrop (draggableInfo) {\n        scrollListener.stop();\n        if (dragResult && dragResult.dropPlaceholderContainer) {\n          element.removeChild(dragResult.dropPlaceholderContainer);\n        }\n        lastDraggableInfo = null;\n        dragHandler = getDragHandler(props);\n        dropHandler(draggableInfo, dragResult);\n        dragResult = null;\n      },\n      fireRemoveElement () {\n        // will be called when container is disposed while dragging so ignore addedIndex\n        dropHandler(\n          lastDraggableInfo,\n          Object.assign({}, dragResult, { addedIndex: null }),\n          true\n        );\n        dragResult = null;\n      },\n      getDragResult () {\n        return dragResult;\n      },\n      getTranslateCalculator (dragresult) {\n        return calculateTranslations(props)(dragresult);\n      },\n      onTranslated: () => {\n        processLastDraggableInfo();\n      },\n      setDraggables: () => {\n        setDraggables(props.draggables, element);\n      },\n      getScrollMaxSpeed () {\n        return smoothDnD.maxScrollSpeed;\n      },\n      shouldUseTransformForGhost () {\n        return smoothDnD.useTransformForGhost === true;\n      },\n      getOptions,\n      setOptions,\n    };\n\n    return container;\n  };\n}\n\n// exported part of container\nconst smoothDnD = function (element, options) {\n  const containerIniter = Container(element);\n  const container = containerIniter(options);\n  element[containerInstance] = container;\n  Mediator.register(container);\n  return {\n    dispose () {\n      Mediator.unregister(container);\n      container.dispose(container);\n    },\n    setOptions (options, merge) {\n      container.setOptions(options, merge);\n    },\n  };\n};\n\n// wrap all draggables by default\n// in react,vue,angular this value will be set to false\nsmoothDnD.wrapChild = true;\nsmoothDnD.cancelDrag = function () {\n  Mediator.cancelDrag();\n};\n\nsmoothDnD.isDragging = function () {\n  return Mediator.isDragging();\n};\n\nexport default smoothDnD;\n"]}]}